<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fancy 2048</title>
    <style>/* Root variables */
        :root {
          --size: 4;
          --gap: 10px;
          --tile-size: calc((100vmin - var(--gap) * (var(--size) + 1)) / var(--size));
          --game-size: calc(
            var(--tile-size) * (var(--size)) + var(--gap) * (var(--size) + 2)
          );
          --primary-color: #1a1a1a;
          --secondary-color: #f2f2f2;
          --light-background: #f0f0f0;
          --light-text: #000000;
          --dark-background: #1a1a1a;
          --dark-text: #f2f2f2;
          --highlight-color: #ffcc00;
          --button-background: #001047;
          --button-hover-background: #242f57;
          --button-light-background: #ffcc00;
          --button-light-hover-background: #ff9900;
          --reset-button-background: #ff7f50;
          --reset-button-hover-background: #ff4500;
          --overlay-dark: rgba(0, 16, 71, 0.8);
          --overlay-light: rgba(255, 255, 255, 0.8);
          --overlay-light-end: rgba(240, 240, 240, 1);
        }
        
        body {
          font-family: Arial, sans-serif;
          background-color: var(--dark-background);
          color: var(--dark-text);
          margin: 0;
          padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: space-between;
          min-height: 100vh;
          touch-action: none;
          overflow: hidden;
          max-width: 100vw;
          height: 100vh;
          box-sizing: border-box; /* Ensure padding is included in the total width and height */
        }
        
        body.light-mode {
          background-color: var(--light-background);
          color: var(--light-text);
          border-color: transparent;
        }
        
        body.inverted {
          background-color: var(--secondary-color);
          color: #333;
        }
        
        .overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: radial-gradient(circle at center, var(--overlay-dark) 0%, rgb(0, 0, 0) 150%); /* Increase radius of gradient */
          z-index: -1; /* Changed to be under the elements */
          pointer-events: none;
        }
        
        .overlay.light-mode {
          background: radial-gradient(circle at center, var(--overlay-light) 0%, var(--overlay-light-end) 100%); /* Better light mode overlay color */
        }
        
        header {
          margin: 0;
          padding: 10px;
          text-align: left;
          position: absolute;
          top: 10px;
          left: 10px;
          z-index: 5;
        }
        
        header h1 {
          margin: 0;
          padding: 0.2rem 0.4rem; /* Further reduce padding for smaller box size */
          font-size: 1rem; /* Further adjust font size */
          width: auto; /* Adjust width to fit content */
          box-sizing: border-box; /* Ensure padding is included in the total width */
          color: hsl(var(--hue-value), 70%, 50%); /* Text color based on hue value */
          background-color: rgba(50, 50, 50, 0.8);
          border-radius: 10px;
          text-align: center;
          z-index: 6;
        }
        
        header.light-mode h1 {
          background-color: #ffffff; /* White background for better contrast */
          color: hsl(var(--hue-value), 70%, 50%); /* Text color based on hue value */
          border-color: transparent;
        }
        
        header.inverted h1 {
          background-color: rgba(255, 255, 255, 0.8);
          color: #333;
        }
        
        #invert-button {
          margin-top: 15px; /* Adjust margin */
          margin-left: 15px;
          padding: 0.6rem 1.2rem; /* Better padding */
          color: var(--secondary-color);
          font-size: 3rem; /* Adjust font size */
          background-color: var(--button-background);
          border-radius: 50%;
          border: none;
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Static drop shadow */
          text-align: center;
          width: 50px; /* Adjust width */
          height: 50px; /* Adjust height */
          z-index: 6;
          display: inline-block;
          display: flex;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
        }
        
        #invert-button.light-mode {
          background-color: var(--button-light-background); /* Bright yellow for light mode */
          color: #333333; /* Darker text color for contrast */
        }
        
        #invert-button:hover {
          background-color: var(--button-hover-background); /* Darker shade for hover */
          color: #ffffff; /* Ensure text contrast */
        }
        
        #invert-button.light-mode:hover {
          background-color: var(--button-light-hover-background); /* Darker yellow for hover in light mode */
          color: #333333; /* Ensure text contrast */
        }
        
        #invert-button.inverted {
          background-color: rgba(255, 255, 255, 0.8);
          color: #333;
        }
        
        main {
          display: flex;
          flex-direction: column;
          align-items: center;
          width: 100%;
          max-width: 100%;
          margin: 20px 0; /* Apply 20px margin for top and bottom */
          padding: 10px;
          box-sizing: border-box;
          height: 100%;
          flex: 1;
          justify-content: center;
          overflow: hidden;
          color: var(--secondary-color);
          position: relative;
          z-index: 4;
        }
        
        main.inverted {
          background-color: var(--secondary-color);
          color: #333;
        }
        
        #score-container {
          position: absolute;
          top: 10px;
          right: 10px;
          padding: 0.5rem 20px; /* Add 20px padding left and right */
          color: var(--secondary-color);
          font-size: 1rem;
          background-color: rgba(50, 50, 50, 0.5); /* Glass effect background */
          border-radius: 10px;
          text-align: center;
          width: auto;
          max-width: 90%;
          z-index: 7;
          margin-bottom: 20px; /* Added more space under the score box */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        #score-container.light-mode {
          background-color: rgba(255, 255, 255, 0.5); /* Glass effect background for light mode */
          color: #333333; /* Darker text color */
          border-color: transparent;
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        #score-container.inverted {
          background-color: rgba(255, 255, 255, 0.8);
          color: #333;
        }
        
        #reset-button {
          position: absolute;
          top: 100px; /* Adjust position */
          right: 10px;
          background-color: var(--reset-button-background); /* Lighter background color */
          border: none;
          padding: 0.8rem 1.2rem; /* Adjust padding for better mobile experience */
          color: #ffffff; /* White text color */
          font-size: 1rem; /* Adjust font size */
          border-radius: 20px; /* Increase border radius */
          text-align: center;
          width: auto;
          max-width: 90%;
          margin-top: 20px; /* Added even space */
          z-index: 7;
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Static drop shadow */
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Add text glow */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
        }
        
        #reset-button.light-mode {
          background-color: rgba(224, 224, 224, 0.5); /* Updated background color */
          color: #333333; /* Darker text color */
          border: none; /* Remove border */
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Match reset button box shadow */
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Match reset button text glow */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
        }
        
        #reset-button.inverted {
          background-color: #ffa07a; /* Even lighter color for inverted mode */
          color: #000000; /* Black text color */
        }
        
        #reset-button:hover {
          background-color: var(--reset-button-hover-background); /* Darker shade for hover */
          color: #ffffff; /* Ensure text contrast */
          transform: scale(1.05); /* Slightly increase size on hover */
        }
        
        #reset-button.light-mode:hover {
          background-color: var(--reset-button-hover-background); /* Darker shade for hover */
          color: #ffffff; /* Ensure text contrast */
        }
        
        #reset-button:active {
          transform: scale(0.95); /* Slightly decrease size on active */
        }
        
        /* Remove back button styles */
        #back-button {
          display: none; /* Ensure the button is not visible */
        }
        
        #invert-button {
          position: absolute;
          top: 100px; /* Adjust as needed */
          left: 50px;
          transform: translateX(-50%);
          z-index: 7;
        }
        
        #invert-button.inverted {
          background-color: rgba(255, 255, 255, 0.8);
          color: #333;
        }
        
        #score,
        #best-score {
          font-size: 1.2rem;
          font-weight: bold;
          color: var(--secondary-color);
        }
        
        #score {
          color: var(--highlight-color); /* Pop more the current value color */
          font-size: 1.5rem;
          text-shadow: none; /* Remove text shadow */
        }
        
        #score.inverted,
        #best-score.inverted {
          color: #333;
        }
        
        #best-score.light-mode {
          color: #000000; /* Ensure text contrast in light mode */
        }
        
        #board-container {
          display: grid;
          grid-template-columns: repeat(var(--size), 1fr);
          gap: var(--gap); /* Ensure gap between tiles */
          width: 100%;
          height: 100%;
          max-width: 100%;
          max-height: 100%;
          background-color: rgba(50, 50, 50, 0.8);
          margin: 20px;
          border: none; /* Remove black solid border */
          border-radius: 15px;
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
            0 0 20px rgba(255, 255, 255, 0.5), 0 0 30px rgba(255, 255, 255, 0.5);
          box-sizing: border-box;
          margin: auto;
          position: relative;
          padding: 0; /* Remove padding from the container */
          margin-top: 120px; /* CHECK THIS */
          z-index: 3;
          overflow: hidden; /* Remove scroll option */
          padding-right: var(--gap); /* Adjust right padding */
          padding-bottom: var(--gap); /* Adjust bottom padding */
        }
        
        #board-container.light-mode {
          background-color: #ffffff; /* White background for better contrast */
          border: 2px solid #cccccc;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1), 0 0 20px rgba(0, 0, 0, 0.1),
            0 0 30px rgba(0, 0, 0, 0.1);
          padding-right: var(--gap); /* Adjust right padding */
          padding-bottom: var(--gap); /* Adjust bottom padding */
        }
        
        #board-container.inverted {
          background-color: rgba(255, 255, 255, 0.8);
          border: 2px solid rgba(0, 0, 0, 0.2);
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.2), 0 0 20px rgba(0, 0, 0, 0.2),
            0 0 30px rgba(0, 0, 0, 0.2);
        }
        
        .tile {
          background-color: transparent; /* Remove background color */
          color: inherit; /* Remove color */
          font-weight: bold;
          display: flex;
          align-items: center;
          justify-content: center;
          aspect-ratio: 1 / 1;
          border-radius: 15px;
          font-size: calc(var(--tile-size) * 0.9); /* Increase font size */
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
            0 0 20px rgba(255, 255, 255, 0.5), 0 0 30px rgba(255, 255, 255, 0.5),
            0 0 40px rgba(255, 255, 255, 0.5);
          transition: transform 0.05s ease-in-out, opacity 0.05s ease-in-out,
            box-shadow 0.05s ease-in-out; /* Faster transition */
          overflow: hidden;
          margin: 0; /* Remove margin from tiles */
          width: calc((100% - var(--gap) * (var(--size) - 1)) / var(--size));
          height: calc((100% - var(--gap) * (var(--size) - 1)) / var(--size));
        }
        
        .tile[data-value="2"] {
          background-color: #e0f7fa; /* Very light blue color for value 2 */
          color: #776e65; /* Darker color for better contrast */
        }
        
        .tile[data-value="4"] {
          background-color: #add8e6; /* Light blue color for value 4 */
          color: #776e65; /* Darker color for better contrast */
        }
        
        .tile[data-value="8"] {
          background-color: #f2b179;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="16"] {
          background-color: #f59563;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="32"] {
          background-color: #f67c5f;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="64"] {
          background-color: #f65e3b;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="128"] {
          background-color: #edcf72;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="256"] {
          background-color: #edcc61;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="512"] {
          background-color: #edc850;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="1024"] {
          background-color: #edc53f;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="2048"] {
          background-color: #edc22e;
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        .tile[data-value="4096"],
        .tile[data-value="8192"],
        .tile[data-value="16384"],
        .tile[data-value="32768"],
        .tile[data-value="65536"] {
          background-color: #3c3a32; /* Dark color for higher values */
          color: #f9f6f2; /* Light color for better contrast */
        }
        
        /* Remove specific tile color rules */
        .tile[data-value="2"],
        .tile[data-value="4"],
        .tile[data-value="8"],
        .tile[data-value="16"],
        .tile[data-value="32"],
        .tile[data-value="64"],
        .tile[data-value="128"],
        .tile[data-value="256"],
        .tile[data-value="512"],
        .tile[data-value="1024"],
        .tile[data-value="2048"],
        .tile[data-value="4096"],
        .tile[data-value="8192"],
        .tile[data-value="16384"],
        .tile[data-value="32768"],
        .tile[data-value="65536"] {
          background-color: transparent;
          color: inherit;
        }
        
        /* Light mode specific tile color rules */
        .tile.light-mode[data-value="2"] {
          background-color: #e0f7fa; /* Very light blue color for value 2 in light mode */
          color: #776e65; /* Darker color for better contrast */
        }
        
        .tile.light-mode[data-value="4"] {
          background-color: #add8e6; /* Light blue color for value 4 in light mode */
          color: #776e65; /* Darker color for better contrast */
        }
        
        .tile.light-mode[data-value="8"],
        .tile.light-mode[data-value="16"],
        .tile.light-mode[data-value="32"],
        .tile.light-mode[data-value="64"],
        .tile.light-mode[data-value="128"],
        .tile.light-mode[data-value="256"],
        .tile.light-mode[data-value="512"],
        .tile.light-mode[data-value="1024"],
        .tile.light-mode[data-value="2048"],
        .tile.light-mode[data-value="4096"],
        .tile.light-mode[data-value="8192"],
        .tile.light-mode[data-value="16384"],
        .tile.light-mode[data-value="32768"],
        .tile.light-mode[data-value="65536"] {
          background-color: transparent;
          color: inherit;
        }
        
        .tile.light-mode {
          background-color: #f9f9f9; /* Light grey background for better contrast */
          color: #333333; /* Darker text color for better visibility */
          border: 2px solid #dddddd; /* Light grey border for better contrast */
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1), 0 0 20px rgba(0, 0, 0, 0.1),
            0 0 30px rgba(0, 0, 0, 0.1);
          font-size: calc(var(--tile-size) * 0.9); /* Increase font size */
        }
        
        .tile:hover {
          transform: scale(1.05);
          box-shadow: 0 0 15px rgba(255, 255, 255, 0.7),
            0 0 25px rgba(255, 255, 255, 0.7), 0 0 35px rgba(255, 255, 255, 0.7),
            0 0 45px rgba(255, 255, 255, 0.7);
        }
        
        #game-over {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: rgba(0, 0, 0, 0.5);
          color: white;
          font-size: 2rem;
          z-index: 8;
          padding: 20px;
          border-radius: 10px;
        }
        
        .hidden {
          display: none;
        }
        
        .inverted {
          filter: invert(100%);
        }
        
        .inverted .tile {
          filter: invert(100%);
        }
        
        .inverted .tile * {
          filter: invert(100%);
        }
        
        .inverted #score-container,
        .inverted #invert-button,
        .inverted #reset-button,
        .inverted #back-button {
          filter: invert(100%);
        }
        
        .inverted body {
          background-color: var(--secondary-color);
          color: #333;
        }
        
        .inverted header h1 {
          background-color: rgba(255, 255, 255, 0.8);
          color: #333;
        }
        
        .inverted #board-container {
          background-color: rgba(255, 255, 255, 0.8);
          border: 2px solid rgba(0, 0, 0, 0.2);
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.2), 0 0 20px rgba(0, 0, 0, 0.2),
            0 0 30px rgba(0, 0, 0, 0.2);
        }
        
        .inverted .tile {
          background-color: #fff;
          color: #333;
        }
        
        .inverted .tile[data-value="2"] {
          background-color: #eee4da;
          color: #776e65;
        }
        
        .inverted .tile[data-value="4"] {
          background-color: #ede0c8;
          color: #776e65;
        }
        
        .inverted .tile[data-value="8"] {
          background-color: #f2b179;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="16"] {
          background-color: #f59563;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="32"] {
          background-color: #f67c5f;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="64"] {
          background-color: #f65e3b;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="128"] {
          background-color: #edcf72;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="256"] {
          background-color: #edcc61;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="512"] {
          background-color: #edc850;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="1024"] {
          background-color: #edc53f;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="2048"] {
          background-color: #edc22e;
          color: #f9f6f2;
        }
        
        .inverted .tile[data-value="4096"],
        .inverted .tile[data-value="8192"],
        .inverted .tile[data-value="16384"],
        .inverted .tile[data-value="32768"],
        .inverted .tile[data-value="65536"] {
          background-color: #3c3a32;
          color: #f9f6f2;
        }
        
        .inverted .tile:hover {
          transform: scale(1.05);
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.7), 0 0 25px rgba(0, 0, 0, 0.7),
            0 0 35px rgba(0, 0, 0, 0.7), 0 0 45px rgba(0, 0, 0, 0.7);
        }
        
        /* Media queries for mobile optimization */
        @media (max-width: 600px) {
          body {
            overflow: hidden;
            padding: 5px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
          }
        
          header h1 {
            font-size: 1.2rem;
          }
        
          #score-container {
            font-size: 0.8rem;
            padding: 0.2rem;
          }
        
          #board-container {
            width: 100%;
            height: 100%;
            max-width: 85vmin;
            max-height: 85vmin;
            margin-bottom: 5px;
          }
        
          .tile {
            font-size: 0.8rem;
          }
        
          button {
            font-size: 0.7rem;
            padding: 5px 10px;
          }
        
          #game-over {
            font-size: 1.2rem;
          }
        
          main {
            padding: 5px;
            height: 100%;
          }
        
          #invert-button {
            width: 35px; /* Further adjust width for smaller screens */
            height: 35px; /* Further adjust height for smaller screens */
            font-size: 0.7rem; /* Further adjust font size for smaller screens */
          }
        
          #reset-button {
            padding: 0.6rem 1rem; /* Further adjust padding for smaller screens */
            font-size: 0.9rem; /* Further adjust font size for smaller screens */
          }
        
          #hue-slider {
            height: 15px; /* Further adjust height for smaller screens */
            width: 70%; /* Further adjust width for smaller screens */
            max-width: 250px; /* Further adjust max-width for smaller screens */
          }
        }
        
        /* Media queries for tablet optimization */
        @media (min-width: 600px) and (max-width: 1024px) {
          body {
            padding: 10px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
          }
        
          header h1 {
            font-size: 1.5rem; /* Adjust font size for tablets */
          }
        
          #score-container {
            font-size: 1rem; /* Adjust font size for tablets */
            padding: 0.5rem;
          }
        
          #board-container {
            width: 100%;
            height: 100%;
            max-width: 90vmin;
            max-height: 90vmin;
            margin-bottom: 10px;
          }
        
          .tile {
            font-size: 1rem; /* Adjust font size for tablets */
          }
        
          button {
            font-size: 1rem; /* Adjust font size for tablets */
            padding: 10px 20px;
          }
        
          #game-over {
            font-size: 1.5rem; /* Adjust font size for tablets */
          }
        
          main {
            padding: 10px;
            height: 100%;
          }
        
          #invert-button {
            width: 50px; /* Adjust width for tablets */
            height: 50px; /* Adjust height for tablets */
            font-size: 1rem; /* Adjust font size for tablets */
          }
        
          #reset-button {
            padding: 1rem 1.5rem; /* Adjust padding for tablets */
            font-size: 1rem; /* Adjust font size for tablets */
          }
        
          #hue-slider {
            height: 20px; /* Adjust height for tablets */
            width: 80%; /* Adjust width for tablets */
            max-width: 300px; /* Adjust max-width for tablets */
          }
        }
        
        /* Force vertical layout and prevent rotation for tablets */
        @media (min-width: 600px) and (max-width: 1024px) and (orientation: landscape) {
          body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: row; /* Adjust to row for landscape */
          }
        
          main {
            max-width: 90vh;
            max-height: 90vh;
            flex: 1; /* Ensure main takes up available space */
          }
        
          header {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #score-container {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #reset-button {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #invert-button {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        }
        
        /* Force vertical layout and prevent rotation for all devices */
        @media (orientation: landscape) {
          body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column; /* Adjust to column for landscape */
          }
        
          main {
            max-width: 90vh;
            max-height: 90vh;
            flex: 1; /* Ensure main takes up available space */
          }
        
          header {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #score-container {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #reset-button {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        
          #invert-button {
            position: static; /* Remove absolute positioning */
            margin: 0 20px; /* Add margin for spacing */
          }
        }
        
        /* Specific styles for iPhone */
        @media only screen and (max-device-width: 812px) and (-webkit-min-device-pixel-ratio: 2) {
          body {
            padding: 5px;
          }
        
          header h1 {
            font-size: 1.4rem;
          }
        
          #score-container {
            font-size: 0.9rem;
            padding: 0.2rem;
          }
        
          #board-container {
            width: 100%;
            height: 100%;
            max-width: 85vmin;
            max-height: 85vmin;
            margin-bottom: 5px;
          }
        
          .tile {
            font-size: 0.9rem;
          }
        
          button {
            font-size: 0.7rem;
            padding: 5px 10px;
          }
        
          #game-over {
            font-size: 1.4rem;
          }
        
          main {
            padding: 0 5px;
            height: 100%;
          }
        }
        
        #controls-container {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 10px; /* Adjust margin */
          padding: 5px; /* Adjust padding for better mobile experience */
          width: 100%; /* Ensure it spans the full width */
          box-sizing: border-box;
        }
        
        #hue-slider-container {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 10px; /* Adjust margin */
          padding: 5px; /* Adjust padding for better mobile experience */
          width: 100%; /* Ensure it spans the full width */
          box-sizing: border-box;
        }
        
        #hue-slider {
          width: 80%; /* Adjust width for better mobile experience */
          max-width: 300px; /* Adjust max-width for better mobile experience */
          height: 20px; /* Adjust height for better mobile experience */
          -webkit-appearance: none; /* Remove default styling */
          appearance: none; /* Remove default styling */
          background: #c6c9d67d; /* Background color */
          border-radius: 5px; /* Rounded corners */
          outline: none; /* Remove outline */
          opacity: 0.7; /* Slightly transparent */
          transition: opacity 0.2s; /* Smooth transition */
        }
        
        #hue-slider:hover {
          opacity: 1; /* Fully opaque on hover */
        }
        
        #hue-slider::-webkit-slider-thumb {
          -webkit-appearance: none; /* Remove default styling */
          appearance: none; /* Remove default styling */
          width: 25px; /* Thumb width */
          height: 25px; /* Thumb height */
          background: var(--button-background); /* Thumb color */
          border-radius: 50%; /* Rounded thumb */
          cursor: pointer; /* Pointer cursor */
        }
        
        #hue-slider::-moz-range-thumb {
          width: 25px; /* Thumb width */
          height: 25px; /* Thumb height */
          background: var(--button-background); /* Thumb color */
          border-radius: 50%; /* Rounded thumb */
          cursor: pointer; /* Pointer cursor */
        }
        
        /* Adjust hue for game-section */
        .game-section {
          transition: filter 0.3s ease;
          display: flex;
          justify-content: center;
          align-items: center;
          width: 100%;
          height: 100%;
          padding: var(--gap);
          box-sizing: border-box;
          position: relative;
          margin-top: 20px; /* Adjust as needed to match tiles position */
        }
        
        #invert-button,
        #reset-button,
        #back-button {
          background-color: rgba(0, 16, 71, 0.4); /* Glass effect background */
          color: var(--secondary-color); /* Ensure text contrast */
          border: none;
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
          transition: background-color 0.2s, color 0.2s; /* Faster transition */
        }
        
        #invert-button:hover,
        #reset-button:hover,
        #back-button:hover {
          background-color: rgba(36, 47, 87, 0.7); /* Darker shade for hover */
          color: #ffffff; /* Ensure text contrast */
        }
        
        #invert-button.light-mode,
        #reset-button.light-mode,
        #back-button.light-mode,
        #changeColor-button.light-mode {
          background-color: rgba(224, 224, 224, 0.5); /* Updated background color */
          color: #000000; /* Darker text color */
          border-color: transparent; /* Match reset button border color */
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Match reset button box shadow */
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Match reset button text glow */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
        }
        
        #invert-button.light-mode:hover,
        #reset-button.light-mode:hover,
        #back-button.light-mode:hover {
          background-color: rgba(192, 192, 192, 0.7); /* Darker shade for hover in light mode */
          color: #000000; /* Ensure text contrast */
        }
        
        #changeColor-button {
          background-color: transparent; /* Transparent background */
          border: none; /* Remove border */
          padding: 0.5rem 1rem; /* Smaller padding */
          color: #ffffff; /* White text color */
          font-size: 1rem; /* Increase font size */
          border-radius: 20px; /* Increase border radius */
          text-align: center;
          width: auto;
          max-width: 90%;
          white-space: nowrap; /* Ensure text fits in one line */
          margin-top: 10px; /* Adjust margin */
          z-index: 7;
          box-shadow: inset 0 0 5px #ffffff; /* Subtle inner border glow */
          text-shadow: none; /* Remove text glow */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
          display: flex;
          align-items: center;
          justify-content: center;
          filter: brightness(85%); /* Add brightness effect */
          background-color: rgba(0, 16, 71, 0.4); /* Glass effect background */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08); /* Static drop shadow */
        }
        
        #changeColor-button.light-mode {
          background-color: rgba(224, 224, 224, 0.5); /* Updated background color */
          color: #333333; /* Match reset button light mode text color */
          border: none; /* Remove border */
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Match reset button box shadow */
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Match reset button text glow */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
        }
        
        #changeColor-button.inverted {
          color: hsl(var(--hue-value), 70%, 50%); /* Text color based on hue value */
        }
        
        #changeColor-button:hover {
          background-color: rgba(255, 255, 255, 0.1); /* Slightly visible background on hover */
          transform: scale(1.05); /* Slightly increase size on hover */
        }
        
        #changeColor-button.light-mode:hover {
          background-color: var(--reset-button-hover-background); /* Match reset button hover background color */
          color: #ffffff; /* Match reset button hover text color */
          transform: scale(1.05); /* Slightly increase size on hover */
        }
        
        #changeColor-button:active {
          transform: scale(0.95); /* Slightly decrease size on active */
        }
        
        #changeColor-button,
        #reset-button,
        #invert-button,
        #back-button {
          border: none; /* Remove border */
        }
        
        #changeColor-button.light-mode,
        #reset-button.light-mode,
        #invert-button.light-mode,
        #back-button.light-mode {
          background-color: rgba(224, 224, 224, 0.5); /* Updated background color */
          color: #333333; /* Darker text color */
          border: none; /* Remove border */
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Match reset button box shadow */
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Match reset button text glow */
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
        }
        
        #changeColor-button:hover,
        #reset-button:hover,
        #invert-button:hover,
        #back-button:hover {
          background-color: rgba(36, 47, 87, 0.7); /* Darker shade for hover */
          color: #ffffff; /* Ensure text contrast */
        }
        
        #changeColor-button.light-mode:hover,
        #reset-button.light-mode:hover,
        #invert-button.light-mode:hover,
        #back-button.light-mode:hover {
          background-color: rgba(192, 192, 192, 0.7); /* Darker shade for hover in light mode */
          color: #000000; /* Ensure text contrast */
        }
        
        #changeColor-button:active,
        #reset-button:active,
        #invert-button:active,
        #back-button:active {
          transform: scale(0.95); /* Slightly decrease size on active */
        }
        
        #changeColor-button,
        #reset-button,
        #invert-button,
        #back-button {
          background-color: rgba(0, 16, 71, 0.4); /* Glass effect background with alpha 0.4 */
          color: var(--secondary-color); /* Ensure text contrast */
          border: none;
          -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
          backdrop-filter: blur(10px); /* Glass effect */
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
          transition: background-color 0.2s, color 0.2s; /* Faster transition */
        }
        </style>
  </head>
  <body>
    <!-- Header section -->
    <header>
      <h1>Fancy 2048</h1>
      <div id="controls-container">
        <button type="button" id="changeColor-button">Change Color</button>
        <button type="button" id="invert-button">ðŸŒ™</button>
      </div>
    </header>

    <!-- Main content section -->
    <main>
      <div class="overlay"></div>
      <section class="game-section">
        <div class="board-container" id="board-container"></div>
        <div id="game-over" class="hidden">Game Over!</div>
      </section>
      <aside id="score-container">
        <p>Score: <span id="score">0</span></p>
        <p>Best Score: <span id="best-score">0</span></p>
      </aside>
      <button type="button" id="reset-button">Reset Game</button>
    </main>

    <!-- JavaScript file -->
    <script>class Game {
        constructor(size) {
          this.size = size;
          this.board = this.createEmptyBoard();
          this.score = 0;
          this.bestScore = localStorage.getItem('bestScore') || 0;
          this.isLightMode = localStorage.getItem('isLightMode') === 'true';
          this.previousBoard = null;
          this.hueValue = 0; // Initialize hue value
          this.addEventListeners();
          this.reset();
          window.addEventListener('resize', () => this.refreshLayout());
          this.applyTheme();
          this.updateHue(); // Ensure hue is applied on initialization
          this.applyButtonStyles(); // Ensure button styles are applied on initialization
        }
      
        addEventListeners() {
          document.getElementById('invert-button').addEventListener('click', this.toggleTheme.bind(this));
          document.getElementById('reset-button').addEventListener('click', this.reset.bind(this));
          window.addEventListener('keydown', this.handleKeyPress.bind(this));
          const boardContainer = document.querySelector('.board-container');
          boardContainer.addEventListener('touchstart', this.handleTouchStart.bind(this), false);
          boardContainer.addEventListener('touchend', this.handleTouchEnd.bind(this), false);
          document.getElementById('changeColor-button').addEventListener('click', this.changeHue.bind(this));
        }
      
        refreshLayout() {
          this.updateTileSize();
          this.updateUI();
        }
      
        toggleTheme() {
          this.isLightMode = !this.isLightMode;
          localStorage.setItem('isLightMode', this.isLightMode);
          this.applyTheme();
        }
      
        applyTheme() {
          const elementsToToggle = [
            
            document.body,
            document.querySelector('.overlay'),
            document.querySelector('.board-container'),
            document.getElementById('score-container'),
            document.getElementById('invert-button'),
            document.getElementById('reset-button'),
            document.getElementById('best-score') // Ensure best score is toggled
          ];
      
          elementsToToggle.forEach(element => {
            if (element) {
              element.classList.toggle('light-mode', this.isLightMode);
            }
          });
      
          document.querySelectorAll('.tile').forEach(tile => {
            tile.classList.toggle('light-mode', this.isLightMode);
            this.invertTileDigits(tile);
          });
      
          const invertButton = document.getElementById('invert-button');
          invertButton.textContent = this.isLightMode ? 'â˜€ï¸' : 'ðŸŒ™'; // Change emoji based on theme
      
          this.updateUI(); // Ensure UI is updated with the correct theme
          this.updateHue(); // Ensure hue is applied
          this.applyButtonStyles(); // Ensure button styles are applied
        }
      
        invertTileDigits(tile) {
          tile.style.color = this.isLightMode ? '#000000' : '#f9f6f2';
        }
      
        handleKeyPress(event) {
          if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {
            this.move(event.key);
            this.updateUI();
            setTimeout(() => {
              if (this.isGameOver()) {
                document.getElementById('game-over').classList.remove('hidden');
              }
            }, 0);
          }
        }
      
        handleTouchStart(e) {
          this.touchStartX = e.touches[0].clientX;
          this.touchStartY = e.touches[0].clientY;
        }
      
        handleTouchEnd(e) {
          const touchEndX = e.changedTouches[0].clientX;
          const touchEndY = e.changedTouches[0].clientY;
          const dx = touchEndX - this.touchStartX;
          const dy = touchEndY - this.touchStartY;
          const absDx = Math.abs(dx);
          const absDy = Math.abs(dy);
      
          let direction = '';
          if (absDx > absDy) {
            direction = dx > 0 ? 'ArrowRight' : 'ArrowLeft';
          } else {
            direction = dy > 0 ? 'ArrowDown' : 'ArrowUp';
          }
      
          if (Math.max(absDx, absDy) > 50) {
            this.move(direction);
            this.updateUI();
            setTimeout(() => {
              if (this.isGameOver()) {
                document.getElementById('game-over').classList.remove('hidden');
              }
            }, 0);
          }
        }
      
        createEmptyBoard() {
          return Array.from({ length: this.size }, () => Array(this.size).fill(''));
        }
      
        updateTileSize() {
          const boardContainer = document.querySelector('.board-container');
          const containerSize = Math.min(boardContainer.clientWidth, boardContainer.clientHeight);
          const gap = parseInt(getComputedStyle(boardContainer).getPropertyValue('gap'));
          const tileSize = (containerSize - (this.size - 1) * gap) / this.size;
      
          document.querySelectorAll('.tile').forEach((tile, index) => {
            tile.style.width = `${tileSize}px`;
            tile.style.height = `${tileSize}px`;
            tile.style.fontSize = `${tileSize * 0.4}px`;
            if (tile.textContent.length > 3) {
              tile.style.fontSize = `${tileSize * 0.3}px`;
            }
            tile.style.msGridRow = Math.floor(index / this.size) + 1; // IE 10+ grid row
            tile.style.msGridColumn = (index % this.size) + 1; // IE 10+ grid column
          });
      
          boardContainer.style.gridTemplateColumns = `repeat(${this.size}, ${tileSize}px)`;
          boardContainer.style.gridTemplateRows = `repeat(${this.size}, ${tileSize}px)`;
        }
      
        calculateTileSize() {
          const viewportSize = Math.min(window.innerWidth, window.innerHeight);
          const boardPadding = 20;
          const maxBoardSize = viewportSize - boardPadding * 2;
          return maxBoardSize / this.size;
        }
      
        addRandomTile() {
          const emptySpots = this.board.flatMap((row, x) => row.map((cell, y) => (cell === '' ? { x, y } : null)).filter(Boolean));
          const spot = emptySpots[Math.floor(Math.random() * emptySpots.length)];
          this.board[spot.x][spot.y] = Math.random() < 0.9 ? 2 : 4;
        }
      
        updateBestScore() {
          if (this.score > this.bestScore) {
            this.bestScore = this.score;
            localStorage.setItem('bestScore', this.bestScore);
          }
        }
      
        reset() {
          this.board = this.createEmptyBoard();
          this.addRandomTile();
          this.addRandomTile();
          this.score = 0;
          this.updateUI();
          document.getElementById('game-over').classList.add('hidden');
          this.applyTheme(); // Ensure theme is applied on reset
          this.updateHue(); // Ensure hue is applied on reset
          this.applyButtonStyles(); // Ensure button styles are applied on reset
        }
      
        slideAndCombine(row) {
          let newRow = Array(this.size).fill('');
          let index = 0;
          for (let i = 0; i < this.size; i++) {
            if (row[i] !== '') {
              if (row[i] === newRow[index - 1]) {
                newRow[index - 1] *= 2;
                this.score += newRow[index - 1];
              } else {
                newRow[index] = row[i];
                index++;
              }
            }
          }
          return newRow;
        }
      
        isGameOver() {
          for (let i = 0; i < this.size; i++) {
            for (let j = 0; j < this.size; j++) {
              if (this.board[i][j] === '') return false;
              if (j < this.size - 1 && this.board[i][j] === this.board[i][j + 1]) return false;
              if (i < this.size - 1 && this.board[i][j] === this.board[i + 1][j]) return false;
            }
          }
          return true;
        }
      
        move(direction) {
          this.previousBoard = this.board.map(row => [...row]);
          let hasChanged = false;
      
          if (['ArrowUp', 'ArrowDown'].includes(direction)) {
            this.board = this.transpose(this.board);
          }
          if (['ArrowDown', 'ArrowRight'].includes(direction)) {
            this.board = this.board.map(row => row.reverse());
          }
      
          this.board = this.board.map(row => {
            const newRow = this.slideAndCombine(row);
            if (!hasChanged && JSON.stringify(newRow) !== JSON.stringify(row)) {
              hasChanged = true;
            }
            return newRow;
          });
      
          if (['ArrowDown', 'ArrowRight'].includes(direction)) {
            this.board = this.board.map(row => row.reverse());
          }
          if (['ArrowUp', 'ArrowDown'].includes(direction)) {
            this.board = this.transpose(this.board);
          }
      
          if (hasChanged) {
            this.addRandomTile();
            this.updateBestScore();
          }
      
          this.updateUI();
        }
      
        transpose(matrix) {
          return matrix[0].map((_, i) => matrix.map(row => row[i]));
        }
      
        updateUI() {
          const boardContainer = document.querySelector('.board-container');
          boardContainer.innerHTML = '';
          let highestValue = 0;
          this.board.forEach(row => {
            row.forEach(value => {
              const tile = document.createElement('div');
              tile.classList.add('tile');
              tile.textContent = value !== '' ? value : '';
              tile.style.backgroundColor = this.getTileColor(value);
              tile.style.color = this.getTextColor(value);
              if (value) {
                tile.setAttribute('data-value', value);
                highestValue = Math.max(highestValue, value);
              }
              if (this.isLightMode) {
                tile.classList.add('light-mode');
                this.invertTileDigits(tile);
              }
              boardContainer.appendChild(tile);
            });
          });
          document.getElementById('score').textContent = this.score;
          document.getElementById('score').style.color = this.getScoreColor(this.score);
          document.getElementById('best-score').textContent = this.bestScore;
          this.updateTileSize();
          this.updateHeaderBackground(highestValue);
          this.updateHue(); // Ensure hue is applied
        }
      
        getScoreColor(score) {
          if (score < 100) return '#ffcc00';
          if (score < 500) return '#ff9900';
          if (score < 1000) return '#ff6600';
          if (score < 2000) return '#ff3300';
          return '#ff0000';
        }
      
        updateHeaderBackground(highestValue) {
          const header = document.querySelector('header h1');
          const backgroundColor = this.getTileColor(highestValue);
          header.style.backgroundColor = backgroundColor;
          header.style.color = this.getTextColor(highestValue);
        }
      
        getTextColor(value) {
          if (value === 2) return '#776e65'; // Darker color for better contrast
          if (value === 4) return '#776e65'; // Darker color for better contrast
          return value >= 8 ? '#f9f6f2' : '#776e65'; // Fix number value contrast ratio
        }
      
        getTileColor(value) {
          if (value === '') return 'transparent';
      
          if (value === 2) return '#e0f7fa'; // Very light blue color for value 2
          if (value === 4) return '#add8e6'; // Light blue color for value 4
      
          const baseHue = 200; // Starting hue for the color '8'
          const hueStep = 30; // Step to rotate the hue for each value
      
          const hue = baseHue + (Math.log2(value) - 3) * hueStep;
          return `hsl(${hue}, 70%, 50%)`;
        }
      
        changeHue() {
          this.hueValue = (this.hueValue + 15) % 360; // Increment hue by 15 steps
          this.updateHue();
        }
      
        updateHue() {
          const hueValue = this.hueValue;
          const hueRotation = this.isLightMode ? -hueValue : hueValue; // Invert hue in light mode
          document.documentElement.style.setProperty('--hue-value', hueValue); // Set hue value as CSS variable
          document.querySelector('.game-section').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.querySelector('.overlay').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.querySelector('.board-container').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.querySelector('header h1').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.getElementById('score-container').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.getElementById('score').style.filter = `hue-rotate(${hueRotation}deg)`;
          document.getElementById('best-score').style.filter = `hue-rotate(${hueRotation}deg)`;
          const buttons = [document.getElementById('changeColor-button'), document.getElementById('reset-button'), document.getElementById('invert-button')];
          buttons.forEach(button => {
            if (!this.isLightMode) {
              button.style.filter = `hue-rotate(${hueRotation}deg)`; // Apply hue rotation to buttons in dark mode
            } else {
              button.style.filter = 'none'; // Remove hue rotation in light mode
            }
          });
        }
      
        applyButtonStyles() {
          const buttons = [document.getElementById('changeColor-button'), document.getElementById('reset-button'), document.getElementById('invert-button')];
          buttons.forEach(button => {
            if (this.isLightMode) {
              button.style.backgroundColor = 'rgba(224, 224, 224, 0.5)'; // Updated background color
              button.style.color = '#333333'; // Darker text color
              button.style.borderColor = 'transparent'; // Match reset button border color
              button.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5)'; // Match reset button box shadow
              button.style.textShadow = '0 0 5px rgba(255, 255, 255, 0.7)'; // Match reset button text glow
              button.style.webkitBackdropFilter = 'blur(10px)'; // Glass effect for Safari
              button.style.backdropFilter = 'blur(10px)'; // Glass effect
              button.style.transition = 'background-color 0.2s, color 0.2s, transform 0.1s'; // Faster transition
            } else {
              button.style.backgroundColor = 'rgba(0, 16, 71, 0.4)'; // Glass effect background with alpha 0.4
              button.style.color = '#ffffff'; // White text color
              button.style.borderColor = '#ffffff'; // White border color
              button.style.boxShadow = 'inset 0 0 5px #ffffff'; // Subtle inner border glow
              button.style.textShadow = 'none'; // Remove text glow
            }
            button.style.filter = 'brightness(85%)'; // Add brightness effect
            button.style.webkitBackdropFilter = 'blur(10px)'; // Glass effect for Safari
            button.style.backdropFilter = 'blur(10px)'; // Glass effect
            button.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)'; // Static drop shadow
          });
        }
      }
      
      // Instantiate the game
      document.addEventListener('DOMContentLoaded', () => {
        const game = new Game(4);
        game.refreshLayout();
        game.applyTheme();
        game.updateHue(); // Ensure hue is applied on page load
      });</script>
  </body>
</html>