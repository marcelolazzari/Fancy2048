<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fancy 2048</title>
    <style>
      /* Root variables */
      :root {
        --size: 4;
        --gap: 10px;
        --tile-size: calc((100vmin - var(--gap) * (var(--size) + 1)) / var(--size));
        --game-size: calc(
          var(--tile-size) * (var(--size)) + var(--gap) * (var(--size) + 2)
        );
        --primary-color: #1a1a1a;
        --secondary-color: #f2f2f2;
        --light-background: #f0f0f0;
        --light-text: #000000;
        --dark-background: #1a1a1a;
        --dark-text: #f2f2f2;
        --highlight-color: #ffcc00;
        --button-background: #001047;
        --button-hover-background: #242f57;
        --button-light-background: #ffcc00;
        --button-light-hover-background: #ff9900;
        --reset-button-background: #ff7f50;
        --reset-button-hover-background: #ff4500;
        --overlay-dark: rgba(0, 16, 71, 0.8);
        --overlay-light: rgba(255, 255, 255, 0.8);
        --overlay-light-end: rgba(240, 240, 240, 1);
      }

      body {
        font-family: Arial, sans-serif;
        background-color: var(--dark-background);
        color: var(--dark-text);
        margin: 0;
        padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        min-height: 100vh;
        touch-action: none;
        overflow: hidden;
        max-width: 100vw;
        height: 100vh;
        box-sizing: border-box; /* Ensure padding is included in the total width and height */
      }

      body.light-mode {
        background-color: var(--light-background);
        color: var(--light-text);
        border-color: transparent;
      }

      body.inverted {
        background-color: var(--secondary-color);
        color: #333;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at center, var(--overlay-dark) 0%, rgb(0, 0, 0) 150%); /* Increase radius of gradient */
        z-index: -1; /* Changed to be under the elements */
        pointer-events: none;
      }

      .overlay.light-mode {
        background: radial-gradient(circle at center, var(--overlay-light) 0%, var(--overlay-light-end) 100%); /* Better light mode overlay color */
      }

      header {
        margin: 0;
        padding: 10px;
        text-align: left;
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 5;
      }

      header h1 {
        margin: 0;
        padding: 0.2rem 0.4rem; /* Further reduce padding for smaller box size */
        font-size: 1rem; /* Further adjust font size */
        width: auto; /* Adjust width to fit content */
        box-sizing: border-box; /* Ensure padding is included in the total width */
        color: hsl(var(--hue-value), 70%, 50%); /* Text color based on hue value */
        background-color: rgba(50, 50, 50, 0.8);
        border-radius: 10px;
        text-align: center;
        z-index: 6;
      }

      header.light-mode h1 {
        background-color: #ffffff; /* White background for better contrast */
        color: hsl(var(--hue-value), 70%, 50%); /* Text color based on hue value */
        border-color: transparent;
      }

      header.inverted h1 {
        background-color: rgba(255, 255, 255, 0.8);
        color: #333;
      }

      #invert-button {
        margin-top: 15px; /* Adjust margin */
        margin-left: 15px;
        padding: 0.6rem 1.2rem; /* Better padding */
        color: var(--secondary-color);
        font-size: 3rem; /* Adjust font size */
        background-color: var(--button-background);
        border-radius: 50%;
        border: none;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Static drop shadow */
        text-align: center;
        width: 50px; /* Adjust width */
        height: 50px; /* Adjust height */
        z-index: 6;
        display: inline-block;
        display: flex;
        align-items: center;
        justify-content: center;
        box-sizing: border-box;
      }

      #invert-button.light-mode {
        background-color: var(--button-light-background); /* Bright yellow for light mode */
        color: #333333; /* Darker text color for contrast */
      }

      #invert-button:hover {
        background-color: var(--button-hover-background); /* Darker shade for hover */
        color: #ffffff; /* Ensure text contrast */
      }

      #invert-button.light-mode:hover {
        background-color: var(--button-light-hover-background); /* Darker yellow for hover in light mode */
        color: #333333; /* Ensure text contrast */
      }

      #invert-button.inverted {
        background-color: rgba(255, 255, 255, 0.8);
        color: #333;
      }

      main {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 100%;
        margin: 20px 0; /* Apply 20px margin for top and bottom */
        padding: 10px;
        box-sizing: border-box;
        height: 100%;
        flex: 1;
        justify-content: center;
        overflow: hidden;
        color: var(--secondary-color);
        position: relative;
        z-index: 4;
      }

      main.inverted {
        background-color: var(--secondary-color);
        color: #333;
      }

      #score-container {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 0.5rem 20px; /* Add 20px padding left and right */
        color: var(--secondary-color);
        font-size: 1rem;
        background-color: rgba(50, 50, 50, 0.5); /* Glass effect background */
        border-radius: 10px;
        text-align: center;
        width: auto;
        max-width: 90%;
        z-index: 7;
        margin-bottom: 20px; /* Added more space under the score box */
        -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
        backdrop-filter: blur(10px); /* Glass effect */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      #score-container.light-mode {
        background-color: rgba(255, 255, 255, 0.5); /* Glass effect background for light mode */
        color: #333333; /* Darker text color */
        border-color: transparent;
        -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
        backdrop-filter: blur(10px); /* Glass effect */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      #score-container.inverted {
        background-color: rgba(255, 255, 255, 0.8);
        color: #333;
      }

      #reset-button {
        position: absolute;
        top: 100px; /* Adjust position */
        right: 10px;
        background-color: var(--reset-button-background); /* Lighter background color */
        border: none;
        padding: 0.8rem 1.2rem; /* Adjust padding for better mobile experience */
        color: #ffffff; /* White text color */
        font-size: 1rem; /* Adjust font size */
        border-radius: 20px; /* Increase border radius */
        text-align: center;
        width: auto;
        max-width: 90%;
        margin-top: 20px; /* Added even space */
        z-index: 7;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Static drop shadow */
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Add text glow */
        transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
      }

      #reset-button.light-mode {
        background-color: rgba(224, 224, 224, 0.5); /* Updated background color */
        color: #333333; /* Darker text color */
        border: none; /* Remove border */
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.5); /* Match reset button box shadow */
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.7); /* Match reset button text glow */
        -webkit-backdrop-filter: blur(10px); /* Glass effect for Safari */
        backdrop-filter: blur(10px); /* Glass effect */
        transition: background-color 0.2s, color 0.2s, transform 0.1s; /* Faster transition */
      }

      #reset-button.inverted {
        background-color: #ffa07a; /* Even lighter color for inverted mode */
        color: #000000; /* Black text color */
      }

      #reset-button:hover {
        background-color: var(--reset-button-hover-background); /* Darker shade for hover */
        color: #ffffff; /* Ensure text contrast */
        transform: scale(1.05); /* Slightly increase size on hover */
      }

      #reset-button.light-mode:hover {
        background-color: var(--reset-button-hover-background); /* Darker shade for hover */
        color: #ffffff; /* Ensure text contrast */
      }

      #reset-button:active {
        transform: scale(0.95); /* Slightly decrease size on active */
      }

      /* Remove back button styles */
      #back-button {
        display: none; /* Ensure the button is not visible */
      }

      #invert-button {
        position: absolute;
        top: 100px; /* Adjust as needed */
        left: 50px;
        transform: translateX(-50%);
        z-index: 7;
      }

      #invert-button.inverted {
        background-color: rgba(255, 255, 255, 0.8);
        color: #333;
      }

      #score,
      #best-score {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--secondary-color);
      }

      #score {
        color: var(--highlight-color); /* Pop more the current value color */
        font-size: 1.5rem;
        text-shadow: none; /* Remove text shadow */
      }

      #score.inverted,
      #best-score.inverted {
        color: #333;
      }

      #best-score.light-mode {
        color: #000000; /* Ensure text contrast in light mode */
      }

      #board-container {
        display: grid;
        grid-template-columns: repeat(var(--size), 1fr);
        gap: var(--gap); /* Ensure gap between tiles */
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        background-color: rgba(50, 50, 50, 0.8);
        margin: 20px;
        border: none; /* Remove black solid border */
        border-radius: 15px;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
          0 0 20px rgba(255, 255, 255, 0.5), 0 0 30px rgba(255, 255, 255, 0.5);
        box-sizing: border-box;
        margin: auto;
        position: relative;
        padding: 0; /* Remove padding from the container */
        margin-top: 120px; /* CHECK THIS */
        z-index: 3;
        overflow: hidden; /* Remove scroll option */
        padding-right: var(--gap); /* Adjust right padding */
        padding-bottom: var(--gap); /* Adjust bottom padding */
      }

      #board-container.light-mode {
        background-color: #ffffff; /* White background for better contrast */
        border: 2px solid #cccccc;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1), 0 0 20px rgba(0, 0, 0, 0.1),
          0 0 30px rgba(0, 0, 0, 0.1);
        padding-right: var(--gap); /* Adjust right padding */
        padding-bottom: var(--gap); /* Adjust bottom padding */
      }

      #board-container.inverted {
        background-color: rgba(255, 255, 255, 0.8);
        border: 2px solid rgba(0, 0, 0, 0.2);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2), 0 0 20px rgba(0, 0, 0, 0.2),
          0 0 30px rgba(0, 0, 0, 0.2);
      }

      .tile {
        background-color: transparent; /* Remove background color */
        color: inherit; /* Remove color */
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        aspect-ratio: 1 / 1;
        border-radius: 15px;
        font-size: calc(var(--tile-size) * 0.9); /* Increase font size */
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5),
          0 0 20px rgba(255, 255, 255, 0.5), 0 0 30px rgba(255, 255, 255, 0.5),
          0 0 40px rgba(255, 255, 255, 0.5);
        transition: transform 0.05s ease-in-out, opacity 0.05s ease-in-out,
          box-shadow 0.05s ease-in-out; /* Faster transition */
        overflow: hidden;
        margin: 0; /* Remove margin from tiles */
        width: calc((100% - var(--gap) * (var(--size) - 1)) / var(--size));
        height: calc((100% - var(--gap) * (var(--size) - 1)) / var(--size));
      }

      .tile[data-value="2"] {
        background-color: #e0f7fa; /* Very light blue color for value 2 */
        color: #776e65; /* Darker color for better contrast */
      }

      .tile[data-value="4"] {
        background-color: #add8e6; /* Light blue color for value 4 */
        color: #776e65; /* Darker color for better contrast */
      }

      .tile[data-value="8"] {
        background-color: #f2b179;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="16"] {
        background-color: #f59563;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="32"] {
        background-color: #f67c5f;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="64"] {
        background-color: #f65e3b;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="128"] {
        background-color: #edcf72;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="256"] {
        background-color: #edcc61;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="512"] {
        background-color: #edc850;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="1024"] {
        background-color: #edc53f;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="2048"] {
        background-color: #edc22e;
        color: #f9f6f2; /* Light color for better contrast */
      }

      .tile[data-value="4096"],
      .tile[data-value="8192"],
      .tile[data-value="16384"],
      .tile[data-value="32768"],
      .tile[data-value="65536"] {
        background-color: #3c3a32; /* Dark color for higher values */
        color: #f9f6f2; /* Light color for better contrast */
      }
    </style>
  </head>
  <body>
    <div class="overlay"></div>
    <header>
      <h1>Fancy 2048</h1>
      <button id="invert-button">🌓</button>
    </header>
    <main>
      <div id="score-container">
        <div id="score">0</div>
        <div id="best-score">0</div>
      </div>
      <button id="reset-button">Reset</button>
      <div id="board-container"></div>
    </main>
    <script>
      const gameBoard = document.getElementById("board-container");
      const scoreContainer = document.getElementById("score-container");
      const scoreDisplay = document.getElementById("score");
      const bestScoreDisplay = document.getElementById("best-score");
      const resetButton = document.getElementById("reset-button");
      const invertButton = document.getElementById("invert-button");
      const overlay = document.querySelector(".overlay");

      let score = 0;
      let bestScore = 0;
      let board = [];
      let size = 4;

      function createBoard() {
        board = [];
        for (let i = 0; i < size; i++) {
          board.push(new Array(size).fill(0));
        }
        addRandomTile();
        addRandomTile();
        updateBoard();
      }

      function addRandomTile() {
        let emptyTiles = [];
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            if (board[i][j] === 0) {
              emptyTiles.push({ x: i, y: j });
            }
          }
        }
        if (emptyTiles.length > 0) {
          let { x, y } = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
          board[x][y] = Math.random() < 0.9 ? 2 : 4;
        }
      }

      function updateBoard() {
        gameBoard.innerHTML = "";
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            let tile = document.createElement("div");
            tile.classList.add("tile");
            tile.dataset.value = board[i][j];
            if (board[i][j] !== 0) {
              tile.textContent = board[i][j];
            }
            gameBoard.appendChild(tile);
          }
        }
        scoreDisplay.textContent = score;
        bestScoreDisplay.textContent = bestScore;
      }

      function move(direction) {
        let moved = false;
        if (direction === "up" || direction === "down") {
          for (let j = 0; j < size; j++) {
            let column = [];
            for (let i = 0; i < size; i++) {
              column.push(board[i][j]);
            }
            let newColumn = merge(column, direction === "down");
            for (let i = 0; i < size; i++) {
              if (board[i][j] !== newColumn[i]) {
                moved = true;
              }
              board[i][j] = newColumn[i];
            }
          }
        } else if (direction === "left" || direction === "right") {
          for (let i = 0; i < size; i++) {
            let row = board[i];
            let newRow = merge(row, direction === "right");
            if (board[i].toString() !== newRow.toString()) {
              moved = true;
            }
            board[i] = newRow;
          }
        }
        if (moved) {
          addRandomTile();
          updateBoard();
          if (isGameOver()) {
            alert("Game Over!");
          }
        }
      }

      function merge(line, reverse) {
        if (reverse) {
          line.reverse();
        }
        let newLine = line.filter((value) => value !== 0);
        for (let i = 0; i < newLine.length - 1; i++) {
          if (newLine[i] === newLine[i + 1]) {
            newLine[i] *= 2;
            score += newLine[i];
            newLine.splice(i + 1, 1);
            newLine.push(0);
          }
        }
        while (newLine.length < size) {
          newLine.push(0);
        }
        if (reverse) {
          newLine.reverse();
        }
        return newLine;
      }

      function isGameOver() {
        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            if (board[i][j] === 0) {
              return false;
            }
            if (i > 0 && board[i][j] === board[i - 1][j]) {
              return false;
            }
            if (i < size - 1 && board[i][j] === board[i + 1][j]) {
              return false;
            }
            if (j > 0 && board[i][j] === board[i][j - 1]) {
              return false;
            }
            if (j < size - 1 && board[i][j] === board[i][j + 1]) {
              return false;
            }
          }
        }
        return true;
      }

      function resetGame() {
        score = 0;
        createBoard();
      }

      function invertColors() {
        document.body.classList.toggle("light-mode");
        overlay.classList.toggle("light-mode");
        scoreContainer.classList.toggle("light-mode");
        resetButton.classList.toggle("light-mode");
        invertButton.classList.toggle("light-mode");
        gameBoard.classList.toggle("light-mode");
      }

      document.addEventListener("keydown", (event) => {
        switch (event.key) {
          case "ArrowUp":
            move("up");
            break;
          case "ArrowDown":
            move("down");
            break;
          case "ArrowLeft":
            move("left");
            break;
          case "ArrowRight":
            move("right");
            break;
        }
      });

      resetButton.addEventListener("click", resetGame);
      invertButton.addEventListener("click", invertColors);

      createBoard();
    </script>
  </body>
</html>
