<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Game Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #f2f2f2;
            padding: 20px;
            text-align: center;
        }
        .status {
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            border-radius: 10px;
            border-left: 4px solid #ffcc00;
            background: #2a2a2a;
        }
        .pass { border-left-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
        .fail { border-left-color: #f44336; background: rgba(244, 67, 54, 0.1); }
        .test-result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            background: #333;
            text-align: left;
        }
        button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            font-size: 16px;
        }
        button:hover { background: #e6b800; }
        .game-link {
            background: #4CAF50;
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            display: inline-block;
            border-radius: 8px;
            font-weight: bold;
            margin: 20px;
        }
        #board-container {
            width: 300px;
            height: 300px;
            background: #333;
            border-radius: 12px;
            padding: 12px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            position: relative;
        }
        .grid-cell {
            background: #666;
            border-radius: 8px;
        }
        .tile {
            position: absolute;
            background: linear-gradient(135deg, #ffcc00 0%, #ffb300 100%);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 8px;
            font-size: 24px;
            transition: all 0.15s ease;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        #score-container {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin: 20px auto;
            max-width: 400px;
        }
        #score-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        #score-container li {
            font-weight: bold;
            font-size: 16px;
            text-align: center;
        }
        #score-container span {
            color: #ffcc00;
            font-size: 1.3em;
            display: block;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>üîß Fancy2048 Fixed Game Test</h1>
    
    <div id="test-status" class="status">
        Running comprehensive test...
    </div>
    
    <div id="test-results"></div>
    
    <button onclick="runTest()">üß™ Run Full Test</button>
    <button onclick="testGameManually()">üéÆ Test Game Manually</button>
    <button onclick="window.open('pages/index.html', '_blank')" class="game-link">
        üöÄ Open Fixed Game
    </button>

    <!-- Minimal game UI for testing -->
    <div id="score-container">
        <ul>
            <li>Score<span id="score">0</span></li>
            <li>Best<span id="best-score">0</span></li>
            <li>Moves<span id="moves">0</span></li>
            <li>Time<span id="time">00:00</span></li>
        </ul>
    </div>

    <div id="board-container"></div>

    <div style="text-align: center; margin: 20px;">
        <button onclick="testMove('up')">‚¨ÜÔ∏è Up</button>
        <button onclick="testMove('down')">‚¨áÔ∏è Down</button>
        <button onclick="testMove('left')">‚¨ÖÔ∏è Left</button>
        <button onclick="testMove('right')">‚û°Ô∏è Right</button>
        <button onclick="testAI()">ü§ñ AI Move</button>
        <button onclick="testReset()">üîÑ Reset</button>
    </div>

    <script>
        let testGame = null;
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('test-status');
            status.textContent = message;
            status.className = 'status';
            if (type !== 'info') status.classList.add(type);
        }
        
        function addResult(message, type = 'pass') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = 'test-result';
            div.innerHTML = `<strong>[${type.toUpperCase()}]</strong> ${message}`;
            if (type === 'pass') div.style.borderLeft = '4px solid #4CAF50';
            else if (type === 'fail') div.style.borderLeft = '4px solid #f44336';
            else div.style.borderLeft = '4px solid #ff9800';
            results.appendChild(div);
        }
        
        async function runTest() {
            document.getElementById('test-results').innerHTML = '';
            updateStatus('Starting comprehensive test...', 'info');
            
            try {
                // Test 1: Check DOM elements
                addResult('Testing DOM structure...', 'info');
                const requiredElements = ['board-container', 'score', 'best-score', 'moves', 'time'];
                const missing = requiredElements.filter(id => !document.getElementById(id));
                
                if (missing.length === 0) {
                    addResult('‚úÖ All required DOM elements found', 'pass');
                } else {
                    addResult(`‚ùå Missing DOM elements: ${missing.join(', ')}`, 'fail');
                    return;
                }
                
                // Test 2: Load scripts
                addResult('Loading game scripts...', 'info');
                
                const scripts = [
                    { src: 'scripts/ai_learning_system.js', name: 'AI Learning System' },
                    { src: 'scripts/advanced_ai_solver.js', name: 'Advanced AI Solver' },
                    { src: 'scripts/enhanced_ai.js', name: 'Enhanced AI' },
                    { src: 'scripts/game.js', name: 'Game Engine' }
                ];
                
                for (const script of scripts) {
                    try {
                        await loadScript(script.src, script.name);
                        addResult(`‚úÖ Loaded ${script.name}`, 'pass');
                    } catch (error) {
                        addResult(`‚ùå Failed to load ${script.name}: ${error.message}`, 'fail');
                        return;
                    }
                }
                
                // Wait a bit for initialization
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // Test 3: Check classes are available
                addResult('Checking class availability...', 'info');
                
                if (typeof Game !== 'undefined') {
                    addResult('‚úÖ Game class is available', 'pass');
                } else {
                    addResult('‚ùå Game class not found', 'fail');
                    return;
                }
                
                if (typeof Enhanced2048AI !== 'undefined') {
                    addResult('‚úÖ Enhanced2048AI class is available', 'pass');
                } else {
                    addResult('‚ö†Ô∏è Enhanced2048AI class not found', 'warn');
                }
                
                if (typeof AILearningSystem !== 'undefined') {
                    addResult('‚úÖ AILearningSystem class is available', 'pass');
                } else {
                    addResult('‚ö†Ô∏è AILearningSystem class not found', 'warn');
                }
                
                // Test 4: Create game instance
                addResult('Creating game instance...', 'info');
                
                try {
                    testGame = new Game(4);
                    if (testGame) {
                        addResult('‚úÖ Game instance created successfully', 'pass');
                        window.testGame = testGame; // Make globally available
                    } else {
                        addResult('‚ùå Game instance is null', 'fail');
                        return;
                    }
                } catch (error) {
                    addResult(`‚ùå Game creation failed: ${error.message}`, 'fail');
                    console.error('Game creation error:', error);
                    return;
                }
                
                // Test 5: Test basic game functions
                addResult('Testing basic game functions...', 'info');
                
                try {
                    const initialBoard = testGame.board;
                    if (initialBoard && Array.isArray(initialBoard)) {
                        addResult(`‚úÖ Board initialized (${initialBoard.length}x${initialBoard[0].length})`, 'pass');
                    } else {
                        addResult('‚ùå Board not properly initialized', 'fail');
                    }
                    
                    if (typeof testGame.score === 'number') {
                        addResult(`‚úÖ Score initialized: ${testGame.score}`, 'pass');
                    } else {
                        addResult('‚ùå Score not properly initialized', 'fail');
                    }
                    
                } catch (error) {
                    addResult(`‚ùå Basic function test failed: ${error.message}`, 'fail');
                }
                
                updateStatus('All tests completed! Game should be working.', 'pass');
                
            } catch (error) {
                addResult(`‚ùå Test suite failed: ${error.message}`, 'fail');
                updateStatus('Test failed. Check results above.', 'fail');
                console.error('Test error:', error);
            }
        }
        
        async function loadScript(src, name) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error(`Failed to load ${name}`));
                document.head.appendChild(script);
            });
        }
        
        function testGameManually() {
            if (!testGame) {
                updateStatus('Game not loaded. Run full test first.', 'fail');
                return;
            }
            updateStatus('Manual game testing enabled. Use buttons above to test.', 'pass');
        }
        
        function testMove(direction) {
            if (!testGame) {
                alert('Game not loaded. Run full test first.');
                return;
            }
            
            try {
                const result = testGame.move(direction);
                addResult(`Move ${direction}: ${result ? 'Success' : 'No move possible'}`, result ? 'pass' : 'warn');
            } catch (error) {
                addResult(`Move ${direction} failed: ${error.message}`, 'fail');
            }
        }
        
        function testAI() {
            if (!testGame) {
                alert('Game not loaded. Run full test first.');
                return;
            }
            
            try {
                if (testGame.enhancedAI) {
                    const move = testGame.enhancedAI.getBestMove();
                    if (move) {
                        testGame.move(move);
                        addResult(`AI suggested move: ${move}`, 'pass');
                    } else {
                        addResult('AI could not find a move', 'warn');
                    }
                } else {
                    addResult('AI system not available', 'warn');
                }
            } catch (error) {
                addResult(`AI test failed: ${error.message}`, 'fail');
            }
        }
        
        function testReset() {
            if (!testGame) {
                alert('Game not loaded. Run full test first.');
                return;
            }
            
            try {
                testGame.resetGame();
                addResult('Game reset successfully', 'pass');
            } catch (error) {
                addResult(`Reset failed: ${error.message}`, 'fail');
            }
        }
        
        // Auto-run test on load
        window.addEventListener('load', () => {
            setTimeout(runTest, 1000);
        });
    </script>
</body>
</html>
