<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
  
  <!-- Enhanced PWA mobile support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Fancy2048">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#2c3e50">
  
  <!-- Prevent zoom on form focus (iOS) -->
  <meta name="format-detection" content="telephone=no">
  
  <title>Fancy2048 - Mobile Viewport Test</title>
  <link rel="stylesheet" href="styles/unified_styles_fixed.css">
  
  <style>
    /* Test-specific styles */
    .test-section {
      margin: 20px 10px;
      padding: 15px;
      border: 2px solid #34495e;
      border-radius: 8px;
      background: rgba(52, 73, 94, 0.1);
    }
    
    .test-info {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 10px;
    }
    
    .touch-test {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 10px;
      margin: 10px 0;
    }
    
    .touch-button {
      padding: 12px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      min-height: 44px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .touch-button:active {
      transform: scale(0.95);
      background: #2980b9;
    }
    
    .viewport-info {
      background: #2c3e50;
      color: white;
      padding: 10px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 12px;
      line-height: 1.4;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>Mobile Viewport Test</h1>
    <nav>
      <a href="pages/index.html">← Back to Game</a>
    </nav>
  </header>

  <main>
    <div class="test-section">
      <div class="test-info">Viewport Information (Updates in real-time)</div>
      <div class="viewport-info" id="viewport-info">Loading viewport info...</div>
    </div>

    <div class="test-section">
      <div class="test-info">Touch Target Test (Buttons should be minimum 44px)</div>
      <div class="touch-test">
        <button class="touch-button" onclick="showFeedback(this, 'Button 1')">Touch 1</button>
        <button class="touch-button" onclick="showFeedback(this, 'Button 2')">Touch 2</button>
        <button class="touch-button" onclick="showFeedback(this, 'Button 3')">Touch 3</button>
        <button class="touch-button" onclick="showFeedback(this, 'Button 4')">Touch 4</button>
      </div>
      <div id="touch-feedback" style="margin-top: 10px; color: #27ae60; font-weight: bold;"></div>
    </div>

    <div class="test-section">
      <div class="test-info">Game Board Preview (Should fit properly on screen)</div>
      <div class="board-container" style="max-width: 300px; margin: 0 auto;">
        <div class="game-board" data-size="4">
          <div class="tile" data-value="2" style="grid-area: 1/1">2</div>
          <div class="tile" data-value="4" style="grid-area: 1/2">4</div>
          <div class="tile" data-value="8" style="grid-area: 2/1">8</div>
          <div class="tile" data-value="16" style="grid-area: 2/2">16</div>
          <div class="tile" data-value="32" style="grid-area: 3/1">32</div>
          <div class="tile" data-value="64" style="grid-area: 3/2">64</div>
          <div class="tile" data-value="128" style="grid-area: 4/1">128</div>
          <div class="tile" data-value="256" style="grid-area: 4/2">256</div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-info">Safe Area and Notch Test</div>
      <div style="background: #e74c3c; color: white; padding: 10px; border-radius: 6px;">
        <div>Top Safe Area: <span id="safe-area-top">0px</span></div>
        <div>Bottom Safe Area: <span id="safe-area-bottom">0px</span></div>
        <div>Left Safe Area: <span id="safe-area-left">0px</span></div>
        <div>Right Safe Area: <span id="safe-area-right">0px</span></div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-info">Touch Device Detection</div>
      <div id="touch-detection">Detecting device capabilities...</div>
    </div>
  </main>

  <script>
    // Update viewport information
    function updateViewportInfo() {
      const info = document.getElementById('viewport-info');
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
      const screenW = screen.width;
      const screenH = screen.height;
      const dpr = window.devicePixelRatio || 1;
      const orientation = screen.orientation ? screen.orientation.angle : 'unknown';
      
      info.innerHTML = `
Window: ${vw} × ${vh}px
Screen: ${screenW} × ${screenH}px  
DPR: ${dpr}x
Orientation: ${orientation}°
User Agent: ${navigator.userAgent.substring(0, 60)}...
      `.trim();
    }

    // Update safe area information
    function updateSafeArea() {
      const computedStyle = getComputedStyle(document.documentElement);
      document.getElementById('safe-area-top').textContent = 
        computedStyle.getPropertyValue('env(safe-area-inset-top)') || '0px';
      document.getElementById('safe-area-bottom').textContent = 
        computedStyle.getPropertyValue('env(safe-area-inset-bottom)') || '0px';
      document.getElementById('safe-area-left').textContent = 
        computedStyle.getPropertyValue('env(safe-area-inset-left)') || '0px';
      document.getElementById('safe-area-right').textContent = 
        computedStyle.getPropertyValue('env(safe-area-inset-right)') || '0px';
    }

    // Touch device detection
    function detectTouchCapabilities() {
      const detection = document.getElementById('touch-detection');
      const hasTouch = 'ontouchstart' in window;
      const hasPointer = 'onpointerdown' in window;
      const maxTouchPoints = navigator.maxTouchPoints || 0;
      const hover = window.matchMedia('(hover: hover)').matches;
      const coarsePointer = window.matchMedia('(pointer: coarse)').matches;
      
      detection.innerHTML = `
        <div>Touch Support: ${hasTouch ? '✅' : '❌'}</div>
        <div>Pointer Events: ${hasPointer ? '✅' : '❌'}</div>
        <div>Max Touch Points: ${maxTouchPoints}</div>
        <div>Hover Capability: ${hover ? '✅' : '❌'}</div>
        <div>Coarse Pointer: ${coarsePointer ? '✅' : '❌'}</div>
        <div>Likely Touch Device: ${(!hover && coarsePointer) ? '✅' : '❌'}</div>
      `;
    }

    // Touch button feedback
    function showFeedback(button, label) {
      const feedback = document.getElementById('touch-feedback');
      feedback.textContent = `${label} pressed! Touch working correctly.`;
      
      // Clear feedback after 2 seconds
      setTimeout(() => {
        feedback.textContent = '';
      }, 2000);
    }

    // Initialize and set up event listeners
    document.addEventListener('DOMContentLoaded', () => {
      updateViewportInfo();
      updateSafeArea();
      detectTouchCapabilities();
    });

    // Update on resize/orientation change
    window.addEventListener('resize', () => {
      setTimeout(() => {
        updateViewportInfo();
        updateSafeArea();
      }, 100);
    });

    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        updateViewportInfo();
        updateSafeArea();
      }, 500);
    });

    // Initialize CSS custom properties for board size 4
    document.documentElement.style.setProperty('--size', '4');
  </script>
</body>
</html>
