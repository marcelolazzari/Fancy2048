<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy2048 - Initialization Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #f2f2f2;
        }
        
        .test-info {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .success {
            background: #2d5a2d;
            color: #4CAF50;
        }
        
        .error {
            background: #5a2d2d;
            color: #f44336;
        }
        
        .warning {
            background: #5a522d;
            color: #FF9800;
        }
        
        .info {
            background: #2d4a5a;
            color: #2196F3;
        }
        
        button {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #e6c200;
        }
        
        iframe {
            width: 100%;
            height: 800px;
            border: 2px solid #444;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <h1>üéÆ Fancy2048 Initialization Test</h1>
        <p>This test verifies that the game initializes properly after fixing code duplications and logic issues.</p>
        
        <div id="status-container"></div>
        
        <div>
            <button onclick="runInitializationTest()">üîß Run Initialization Test</button>
            <button onclick="testGameLogic()">üß™ Test Game Logic</button>
            <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
        </div>
        
        <div id="log" class="log">Initialization test ready...\n</div>
    </div>

    <div class="test-info">
        <h2>üé≤ Live Game Test</h2>
        <p>The game should load properly below with all functionality working:</p>
        <iframe src="pages/index.html" title="Fancy2048 Game"></iframe>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let statusContainer = document.getElementById('status-container');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusContainer.appendChild(statusDiv);
        }

        function clearLog() {
            logElement.textContent = 'Log cleared...\n';
            statusContainer.innerHTML = '';
        }

        function runInitializationTest() {
            clearLog();
            log('üöÄ Starting initialization test...');
            
            // Test 1: Script loading
            log('üìù Testing script availability...');
            
            const scriptTests = [
                { name: 'Game Class', test: typeof Game !== 'undefined' },
                { name: 'AdvancedAI2048Solver', test: typeof AdvancedAI2048Solver !== 'undefined' },
                { name: 'Enhanced2048AI', test: typeof Enhanced2048AI !== 'undefined' }
            ];
            
            scriptTests.forEach(({ name, test }) => {
                if (test) {
                    log(`‚úÖ ${name}: Available`);
                    showStatus(`${name}: Available`, 'success');
                } else {
                    log(`‚ùå ${name}: Not available`);
                    showStatus(`${name}: Not available`, 'error');
                }
            });
            
            // Test 2: HTML Elements
            log('üîç Testing required HTML elements...');
            
            const requiredElements = [
                'board-container', 'score', 'best-score', 'moves', 'time',
                'reset-button', 'autoplay-button', 'speed-button'
            ];
            
            const iframe = document.querySelector('iframe');
            if (iframe && iframe.contentWindow && iframe.contentDocument) {
                requiredElements.forEach(id => {
                    const element = iframe.contentDocument.getElementById(id);
                    if (element) {
                        log(`‚úÖ Element #${id}: Found`);
                    } else {
                        log(`‚ùå Element #${id}: Missing`);
                        showStatus(`Missing element: ${id}`, 'error');
                    }
                });
            } else {
                log('‚ö†Ô∏è Cannot access iframe content for element testing');
                showStatus('Cannot test iframe elements', 'warning');
            }
            
            // Test 3: Game instantiation
            log('üéÆ Testing game instantiation...');
            
            try {
                const testGame = new Game(3);
                if (testGame && typeof testGame.board !== 'undefined') {
                    log('‚úÖ Game instantiation: Success');
                    showStatus('Game instantiation: Success', 'success');
                    
                    // Test basic methods
                    log('üß™ Testing basic methods...');
                    const methodTests = [
                        { name: 'createEmptyBoard', method: () => testGame.createEmptyBoard() },
                        { name: 'addRandomTile', method: () => testGame.addRandomTile() },
                        { name: 'updateUI', method: () => testGame.updateUI() },
                        { name: 'canMove', method: () => testGame.canMove('up') }
                    ];
                    
                    methodTests.forEach(({ name, method }) => {
                        try {
                            method();
                            log(`‚úÖ Method ${name}: Working`);
                        } catch (error) {
                            log(`‚ùå Method ${name}: Error - ${error.message}`);
                            showStatus(`Method ${name}: Error`, 'error');
                        }
                    });
                    
                } else {
                    log('‚ùå Game instantiation: Failed - Invalid game object');
                    showStatus('Game instantiation: Failed', 'error');
                }
            } catch (error) {
                log(`‚ùå Game instantiation: Error - ${error.message}`);
                showStatus(`Game instantiation: Error - ${error.message}`, 'error');
            }
            
            log('üèÅ Initialization test completed');
        }

        function testGameLogic() {
            clearLog();
            log('üß™ Starting game logic test...');
            
            try {
                const testGame = new Game(4);
                
                // Test board creation
                log('üìã Testing board creation...');
                if (testGame.board && testGame.board.length === 4) {
                    log('‚úÖ Board creation: Success');
                } else {
                    log('‚ùå Board creation: Failed');
                }
                
                // Test tile addition
                log('üé≤ Testing tile addition...');
                const initialEmpty = testGame.countEmptyCells();
                testGame.addRandomTile();
                const afterAdd = testGame.countEmptyCells();
                
                if (afterAdd < initialEmpty) {
                    log('‚úÖ Tile addition: Success');
                } else {
                    log('‚ùå Tile addition: Failed');
                }
                
                // Test movement logic
                log('‚ÜóÔ∏è Testing movement logic...');
                const canMoveUp = testGame.canMove('up');
                const canMoveDown = testGame.canMove('down');
                const canMoveLeft = testGame.canMove('left');
                const canMoveRight = testGame.canMove('right');
                
                log(`Move possibilities - Up: ${canMoveUp}, Down: ${canMoveDown}, Left: ${canMoveLeft}, Right: ${canMoveRight}`);
                
                // Test AI functionality
                log('ü§ñ Testing AI functionality...');
                const aiMove = testGame.getBestMove();
                if (aiMove && ['up', 'down', 'left', 'right'].includes(aiMove)) {
                    log(`‚úÖ AI move suggestion: ${aiMove}`);
                } else {
                    log('‚ùå AI move suggestion: Invalid or failed');
                }
                
                log('üèÅ Game logic test completed');
                
            } catch (error) {
                log(`‚ùå Game logic test error: ${error.message}`);
                showStatus(`Game logic test error: ${error.message}`, 'error');
            }
        }

        // Capture iframe messages
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'gameInit') {
                log(`üì® Received message from game: ${event.data.message}`);
            }
        });

        // Auto-run basic test after page load
        setTimeout(() => {
            log('üîÑ Auto-running initialization test...');
            runInitializationTest();
        }, 2000);
    </script>
</body>
</html>
