<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Fancy 2048</title>
  <meta name="description" content="Play Fancy 2048, a modern twist on the classic puzzle game. Track your stats and compete on the leaderboard!" />
  <link rel="stylesheet" href="../styles/unified_styles_fixed.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Fallback styles to ensure basic layout if CSS fails to load -->
  <style>
    :root {
      --size: 4;
      --tile-size: 1fr;
      --gap: 10px;
      --board-bg: #333;
      --tile-bg: #666;
    }
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    #board-container {
      display: grid !important;
      grid-gap: 10px !important;
      margin: 20px auto !important;
      background: #333 !important;
      padding: 20px !important;
      border-radius: 10px !important;
      aspect-ratio: 1 !important;
      max-width: min(90vw, 90vh, 500px) !important;
      grid-template-columns: repeat(4, 1fr) !important;
      grid-template-rows: repeat(4, 1fr) !important;
    }
    .tile {
      background: #666 !important;
      color: white !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-weight: bold !important;
      border-radius: 5px !important;
      font-size: 1.5rem !important;
      min-height: 60px !important;
    }
    button { background: #ffcc00; color: #000; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
    #score-container { text-align: center; margin: 20px; }
    #score-container ul { list-style: none; padding: 0; display: flex; justify-content: center; gap: 20px; }
    header { text-align: center; padding: 20px; }
    header h1 { color: #ffcc00; margin: 0; }
  </style>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header section -->
    <header>
      <div class="container">
        <h1 class="game-title" tabindex="0">Fancy 2048</h1>
        <nav aria-label="Game controls">
          <ul id="controls-container" class="controls" role="menubar">
            <li role="none">
              <button type="button" id="changeColor-button" aria-label="Change Color" tabindex="0" role="menuitem" data-tooltip="Change game colors">
                <i class="fas fa-palette" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="leaderboard-button" aria-label="View Statistics" onclick="window.location.href='leaderboard.html'" tabindex="0" role="menuitem" data-tooltip="View statistics and leaderboard">
                <i class="fas fa-chart-line" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="back-button" aria-label="Undo Move" tabindex="0" role="menuitem" data-tooltip="Undo last move">
                <i class="fas fa-undo" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="pause-button" aria-label="Pause Game" tabindex="0" role="menuitem" data-tooltip="Pause/Resume game">
                <i class="fas fa-pause" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="board-size-button" aria-label="Change Board Size" tabindex="0" role="menuitem" data-tooltip="Change board size">
                <i class="fas fa-th" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="theme-toggle-button" aria-label="Toggle Theme" tabindex="0" role="menuitem" data-tooltip="Toggle light/dark theme">
                <i class="fas fa-adjust" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="autoplay-button" aria-label="Auto Play" tabindex="0" role="menuitem" data-tooltip="Start/Stop auto play">
                <i class="fas fa-play" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="speed-button" aria-label="Autoplay Speed" tabindex="0" role="menuitem" data-tooltip="Change autoplay speed">
                <span class="speed-text">1x</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="reset-button" aria-label="Reset Game" tabindex="0" role="menuitem" data-tooltip="Start a new game">
                <i class="fas fa-redo" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="ai-difficulty-button" aria-label="Change AI Difficulty" tabindex="0" role="menuitem" data-tooltip="Change AI difficulty level">
                <i class="fas fa-brain" aria-hidden="true"></i>
                <span class="button-text">Normal</span>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main content section -->
    <main id="main-content">
      <div class="overlay" aria-hidden="true"></div>
      <section class="game-section">
  <div id="board-container" class="board-container" role="grid" aria-label="Game Board" tabindex="0"></div>
  <div id="game-over" class="hidden" role="alert" aria-live="assertive">Game Over!</div>
      </section>

      <aside id="score-container" aria-labelledby="score-title">
        <h2 id="score-title" class="visually-hidden">Score Information</h2>
        <ul>
          <li>Score: <span id="score">0</span></li>
          <li>Best: <span id="best-score">0</span></li>
          <li>Moves: <span id="moves">0</span></li>
          <li>Time: <span id="time">00:00</span></li>
        </ul>
      </aside>
    </main>

    <!-- Footer section -->
    <footer>
      <div class="container">
        <!-- Reset button moved to navigation menu -->
      </div>
    </footer>

    <!-- JavaScript files - loaded in specific order for proper initialization -->
    <script>
      // Pre-initialization debugging
      console.log('üöÄ Starting Fancy2048 script loading...');
      console.log('Document ready state:', document.readyState);
      console.log('DOM elements check:', {
        boardContainer: !!document.getElementById('board-container'),
        scoreContainer: !!document.getElementById('score-container'),
        score: !!document.getElementById('score'),
        bestScore: !!document.getElementById('best-score')
      });
      
      // Global error handler
      window.addEventListener('error', (event) => {
        console.error('üö® Global error:', event.error);
        console.error('File:', event.filename, 'Line:', event.lineno, 'Column:', event.colno);
      });
      
      // Unhandled promise rejection handler
      window.addEventListener('unhandledrejection', (event) => {
        console.error('üö® Unhandled promise rejection:', event.reason);
      });
    </script>
    <script src="../scripts/advanced_ai_solver.js" onerror="console.error('‚ùå Failed to load advanced_ai_solver.js')"></script>
    <script src="../scripts/enhanced_ai.js" onerror="console.error('‚ùå Failed to load enhanced_ai.js')"></script>
    <script src="../scripts/game.js" onerror="console.error('‚ùå Failed to load game.js')"></script>
    <script>
      // Post-loading verification
      console.log('üîç Script loading verification:', {
        AdvancedAI: typeof AdvancedAI2048Solver !== 'undefined',
        EnhancedAI: typeof Enhanced2048AI !== 'undefined', 
        Game: typeof Game !== 'undefined'
      });
      
      // Additional initialization check
      if (typeof Game === 'undefined') {
        console.error('‚ùå Game class not loaded!');
        document.body.innerHTML += `
          <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); color: #ff6b6b; display: flex; align-items: center; justify-content: center; z-index: 10000; text-align: center; font-family: Arial;">
            <div>
              <h2>üö® Game Loading Error</h2>
              <p>Failed to load game scripts. Please refresh the page.</p>
              <button onclick="location.reload()" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">Refresh Page</button>
            </div>
          </div>
        `;
      }
      
      // Final backup initialization - will run after 3 seconds if game not initialized
      setTimeout(() => {
        if (!window.game && typeof Game !== 'undefined') {
          console.warn('üÜò Running backup initialization...');
          try {
            window.game = new Game(4);
            console.log('‚úÖ Backup initialization successful!');
          } catch (backupError) {
            console.error('‚ùå Backup initialization also failed:', backupError);
            
            // Ultra-minimal fallback
            document.getElementById('board-container').innerHTML = `
              <div style="grid-column: 1/-1; grid-row: 1/-1; display: flex; align-items: center; justify-content: center; text-align: center; color: #ffcc00;">
                <div>
                  <h3>üéÆ Game Initialization Issue</h3>
                  <p>Please refresh the page to try again.</p>
                  <button onclick="location.reload()" style="padding: 10px 20px; background: #ffcc00; color: #000; border: none; border-radius: 5px; cursor: pointer;">Refresh</button>
                </div>
              </div>
            `;
          }
        } else if (window.game) {
          console.log('‚úÖ Game already initialized successfully');
        }
      }, 3000);
    </script>
  </body>
</html>