<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#1a1a1a" />
  <meta name="apple-mobile-web-app-title" content="Fancy2048" />
  <title>Fancy 2048</title>
  <meta name="description" content="Play Fancy 2048, a modern twist on the classic puzzle game. Track your stats and compete on the leaderboard!" />
  <!-- Primary CSS -->
  <link rel="stylesheet" href="../styles/main.css" />
  <!-- Fallback CSS for GitHub Pages -->
  <link rel="stylesheet" href="/Fancy2048/styles/main.css" onerror="this.onerror=null;this.href='styles/main.css';" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Fallback styles to ensure basic layout if CSS fails to load -->
  <style>
    :root {
      --size: 4;
      --tile-size: 1fr;
      --gap: 10px;
      --board-bg: #333;
      --tile-bg: #666;
    }
    /* Remove problematic inline styles - use main.css responsive system instead */
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    
    /* Let the responsive CSS system handle board sizing */
    #board-container {
      margin: 20px auto !important;
    }
    
    /* Basic button styling */
    button { 
      background: #ffcc00; 
      color: #000; 
      border: none; 
      padding: 10px 15px; 
      margin: 5px; 
      border-radius: 5px; 
      cursor: pointer; 
    }
    
    /* Score container styling */
    #score-container { 
      text-align: center; 
      margin: 20px; 
    }
    
    #score-container ul { 
      list-style: none; 
      padding: 0; 
      display: flex; 
      justify-content: center; 
      gap: 20px; 
    }
    
    /* Header styling */
    header { 
      text-align: center; 
      padding: 20px; 
    }
    header h1 { color: #ffcc00; margin: 0; }
  </style>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header section -->
    <header>
      <div class="container">
        <h1 class="game-title" tabindex="0">Fancy 2048</h1>
        <nav aria-label="Game controls">
          <ul id="controls-container" class="controls" role="menubar">
            <li role="none">
              <button type="button" id="changeColor-button" aria-label="Change Color" tabindex="0" role="menuitem" data-tooltip="Change game colors">
                <i class="fas fa-palette" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="leaderboard-button" aria-label="View Statistics" onclick="window.location.href='leaderboard.html'" tabindex="0" role="menuitem" data-tooltip="View statistics and leaderboard">
                <i class="fas fa-chart-line" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="back-button" aria-label="Undo Move" tabindex="0" role="menuitem" data-tooltip="Undo last move">
                <i class="fas fa-undo" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="pause-button" aria-label="Pause Game" tabindex="0" role="menuitem" data-tooltip="Pause/Resume game">
                <i class="fas fa-pause" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="board-size-button" aria-label="Change Board Size" tabindex="0" role="menuitem" data-tooltip="Change board size">
                <i class="fas fa-th" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="theme-toggle-button" aria-label="Toggle Theme" tabindex="0" role="menuitem" data-tooltip="Toggle light/dark theme">
                <i class="fas fa-adjust" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="autoplay-button" aria-label="Auto Play" tabindex="0" role="menuitem" data-tooltip="Start/Stop auto play">
                <i class="fas fa-play" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="speed-button" aria-label="Autoplay Speed" tabindex="0" role="menuitem" data-tooltip="Change autoplay speed">
                <span class="speed-text">1x</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="reset-button" aria-label="Reset Game" tabindex="0" role="menuitem" data-tooltip="Start a new game">
                <i class="fas fa-redo" aria-hidden="true"></i>
              </button>
            </li>
            <li role="none">
              <button type="button" id="ai-difficulty-button" aria-label="Change AI Difficulty" tabindex="0" role="menuitem" data-tooltip="Change AI difficulty level">
                <i class="fas fa-brain" aria-hidden="true"></i>
                <span class="button-text">Normal</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="ai-learning-button" aria-label="AI Learning Controls" tabindex="0" role="menuitem" data-tooltip="AI Learning statistics and controls">
                <i class="fas fa-graduation-cap" aria-hidden="true"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main content section -->
    <main id="main-content">
      <div class="overlay" aria-hidden="true"></div>
      <section class="game-section">
  <div id="board-container" class="board-container" role="grid" aria-label="Game Board" tabindex="0"></div>
  <div id="game-over" class="hidden" role="alert" aria-live="assertive">Game Over!</div>
      </section>

      <aside id="score-container" aria-labelledby="score-title">
        <h2 id="score-title" class="visually-hidden">Score Information</h2>
        <ul>
          <li>Score: <span id="score">0</span></li>
          <li>Best: <span id="best-score">0</span></li>
          <li>Moves: <span id="moves">0</span></li>
          <li>Time: <span id="time">00:00</span></li>
        </ul>
      </aside>

      <!-- AI Learning Panel -->
      <div id="ai-learning-panel" class="ai-learning-panel hidden" role="dialog" aria-labelledby="ai-learning-title">
        <div class="panel-content">
          <div class="panel-header">
            <h3 id="ai-learning-title">üß† AI Learning System</h3>
            <button type="button" class="close-button" onclick="document.getElementById('ai-learning-panel').classList.add('hidden')" aria-label="Close AI Learning Panel">
              <i class="fas fa-times"></i>
            </button>
          </div>
          
          <div class="panel-body">
            <div class="learning-stats">
              <h4>üìä Learning Statistics</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">Games Played:</span>
                  <span id="ai-total-games" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Average Score:</span>
                  <span id="ai-avg-score" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Win Rate:</span>
                  <span id="ai-win-rate" class="stat-value">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Best Score:</span>
                  <span id="ai-best-score" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Patterns Learned:</span>
                  <span id="ai-patterns-learned" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Recent Improvement:</span>
                  <span id="ai-recent-improvement" class="stat-value">0%</span>
                </div>
              </div>
            </div>
            
            <div class="learning-controls">
              <h4>‚öôÔ∏è Learning Controls</h4>
              <div class="controls-grid">
                <button type="button" id="toggle-learning-button" class="control-button" data-tooltip="Enable/disable AI learning">
                  <i class="fas fa-toggle-on"></i>
                  <span>Learning: On</span>
                </button>
                <button type="button" id="export-learning-button" class="control-button" data-tooltip="Export learning data">
                  <i class="fas fa-download"></i>
                  <span>Export Data</span>
                </button>
                <button type="button" id="import-learning-button" class="control-button" data-tooltip="Import learning data">
                  <i class="fas fa-upload"></i>
                  <span>Import Data</span>
                </button>
                <button type="button" id="clear-learning-button" class="control-button warning" data-tooltip="Clear all learning data">
                  <i class="fas fa-trash"></i>
                  <span>Clear Data</span>
                </button>
              </div>
            </div>
            
            <div class="learning-insights">
              <h4>üí° AI Insights</h4>
              <div id="ai-insights-content" class="insights-content">
                <p>AI learning system will analyze your gameplay and provide insights here.</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Hidden file input for import -->
        <input type="file" id="learning-file-input" accept=".json,.2048brain" style="display: none;">
      </div>
    </main>

    <!-- Footer section -->
    <footer>
      <div class="container">
        <!-- Reset button moved to navigation menu -->
      </div>
    </footer>

    <!-- JavaScript files - loaded in specific order for proper initialization -->
    <script>
      // Pre-initialization debugging
      console.log('üöÄ Starting Fancy2048 script loading...');
      console.log('Document ready state:', document.readyState);
      console.log('Current URL:', window.location.href);
      console.log('Base URL:', window.location.origin);
      console.log('DOM elements check:', {
        boardContainer: !!document.getElementById('board-container'),
        scoreContainer: !!document.getElementById('score-container'),
        score: !!document.getElementById('score'),
        bestScore: !!document.getElementById('best-score')
      });
      
      // Global error handler
      window.addEventListener('error', (event) => {
        console.error('üö® Global error:', event.error);
        console.error('File:', event.filename, 'Line:', event.lineno, 'Column:', event.colno);
      });
      
      // Unhandled promise rejection handler
      window.addEventListener('unhandledrejection', (event) => {
        console.error('üö® Unhandled promise rejection:', event.reason);
      });
      
      // Function to load script with fallback paths
      function loadScript(primarySrc, fallbackSrc, name) {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = primarySrc;
          script.onerror = () => {
            console.warn(`‚ö†Ô∏è Failed to load ${name} from ${primarySrc}, trying fallback...`);
            if (fallbackSrc) {
              const fallbackScript = document.createElement('script');
              fallbackScript.src = fallbackSrc;
              fallbackScript.onload = () => {
                console.log(`‚úÖ Loaded ${name} from fallback: ${fallbackSrc}`);
                resolve();
              };
              fallbackScript.onerror = () => {
                console.error(`‚ùå Failed to load ${name} from both paths`);
                reject(new Error(`Failed to load ${name}`));
              };
              document.head.appendChild(fallbackScript);
            } else {
              console.error(`‚ùå Failed to load ${name}`);
              reject(new Error(`Failed to load ${name}`));
            }
          };
          script.onload = () => {
            console.log(`‚úÖ Loaded ${name} from: ${primarySrc}`);
            resolve();
          };
          document.head.appendChild(script);
        });
      }
      
      // Load scripts sequentially with fallback support
      async function loadAllScripts() {
        try {
          await loadScript('../scripts/ai_learning_system.js', '/Fancy2048/scripts/ai_learning_system.js', 'ai_learning_system.js');
          await loadScript('../scripts/advanced_ai_solver.js', '/Fancy2048/scripts/advanced_ai_solver.js', 'advanced_ai_solver.js');
          await loadScript('../scripts/enhanced_ai.js', '/Fancy2048/scripts/enhanced_ai.js', 'enhanced_ai.js');
          await loadScript('../scripts/game.js', '/Fancy2048/scripts/game.js', 'game.js');
          console.log('‚úÖ All scripts loaded successfully');
        } catch (error) {
          console.error('‚ùå Script loading failed:', error);
          // Show user-friendly error
          document.body.innerHTML += `
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); color: #ff6b6b; display: flex; align-items: center; justify-content: center; z-index: 10000; text-align: center; font-family: Arial;">
              <div>
                <h2>üö® Game Loading Error</h2>
                <p>Failed to load game scripts. Please refresh the page.</p>
                <button onclick="location.reload()" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">Refresh Page</button>
              </div>
            </div>
          `;
        }
      }
      
      // Start loading scripts
      loadAllScripts();
    </script>
  </body>
</html>