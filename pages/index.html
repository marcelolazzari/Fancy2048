<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#1a1a1a" />
  <meta name="apple-mobile-web-app-title" content="Fancy2048" />
  <title>Fancy 2048</title>
  <meta name="description" content="Play Fancy 2048, a modern twist on the classic puzzle game. Track your stats and compete on the leaderboard!" />
  <!-- Primary CSS -->
  <link rel="stylesheet" href="../styles/main.css" />
  <!-- Fallback CSS for GitHub Pages -->
  <link rel="stylesheet" href="/Fancy2048/styles/main.css" onerror="this.onerror=null;this.href='styles/main.css';" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Fallback styles to ensure basic layout if CSS fails to load -->
  <style>
    :root {
      --size: 4;
      --tile-size: 1fr;
      --gap: 10px;
      --board-bg: #333;
      --tile-bg: #666;
    }
    /* Remove problematic inline styles - use main.css responsive system instead */
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    
    /* Let the responsive CSS system handle board sizing */
    #board-container {
      margin: 20px auto !important;
    }
    
    /* Basic button styling */
    button { 
      background: #ffcc00; 
      color: #000; 
      border: none; 
      padding: 10px 15px; 
      margin: 5px; 
      border-radius: 5px; 
      cursor: pointer; 
    }
    
    /* Score container styling */
    #score-container { 
      text-align: center; 
      margin: 20px; 
    }
    
    #score-container ul { 
      list-style: none; 
      padding: 0; 
      display: flex; 
      justify-content: center; 
      gap: 20px; 
    }
    
    /* Header styling */
    header { 
      text-align: center; 
      padding: 20px; 
    }
    header h1 { color: #ffcc00; margin: 0; }
  </style>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header section -->
    <header>
      <div class="container">
        <h1 class="game-title" tabindex="0">Fancy 2048</h1>
        
        <!-- Navigation for all screen sizes -->
        <nav aria-label="Game controls" class="main-nav">
          <ul id="controls-container" class="controls" role="menubar">
            <li role="none">
              <button type="button" id="changeColor-button" aria-label="Change Color" tabindex="0" role="menuitem" data-tooltip="Change game colors">
                <i class="fas fa-palette" aria-hidden="true"></i>
                <span class="button-label">Colors</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="leaderboard-button" aria-label="View Statistics" onclick="window.location.href='leaderboard.html'" tabindex="0" role="menuitem" data-tooltip="View statistics and leaderboard">
                <i class="fas fa-chart-line" aria-hidden="true"></i>
                <span class="button-label">Stats</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="export-stats-button" aria-label="Export Statistics" tabindex="0" role="menuitem" data-tooltip="Export game statistics to JSON">
                <i class="fas fa-download" aria-hidden="true"></i>
                <span class="button-label">Export</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="back-button" aria-label="Undo Move" tabindex="0" role="menuitem" data-tooltip="Undo last move">
                <i class="fas fa-undo" aria-hidden="true"></i>
                <span class="button-label">Undo</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="pause-button" aria-label="Pause Game" tabindex="0" role="menuitem" data-tooltip="Pause/Resume game">
                <i class="fas fa-pause" aria-hidden="true"></i>
                <span class="button-label">Pause</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="board-size-button" aria-label="Change Board Size" tabindex="0" role="menuitem" data-tooltip="Change board size">
                <i class="fas fa-th" aria-hidden="true"></i>
                <span class="button-label">Size</span>
              </button>
            </li>
          </ul>
          
          <ul class="controls secondary-controls" role="menubar">
            <li role="none">
              <button type="button" id="theme-toggle-button" aria-label="Toggle Theme" tabindex="0" role="menuitem" data-tooltip="Toggle light/dark theme">
                <i class="fas fa-adjust" aria-hidden="true"></i>
                <span class="button-label">Theme</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="autoplay-button" aria-label="Auto Play" tabindex="0" role="menuitem" data-tooltip="Start/Stop auto play">
                <i class="fas fa-play" aria-hidden="true"></i>
                <span class="button-label">Auto</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="speed-button" aria-label="Autoplay Speed" tabindex="0" role="menuitem" data-tooltip="Change autoplay speed">
                <span class="speed-text">1x</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="reset-button" aria-label="Reset Game" tabindex="0" role="menuitem" data-tooltip="Start a new game">
                <i class="fas fa-redo" aria-hidden="true"></i>
                <span class="button-label">Reset</span>
              </button>
            </li>
            <li role="none">
              <button type="button" id="ai-difficulty-button" aria-label="Change AI Difficulty" tabindex="0" role="menuitem" data-tooltip="Change AI difficulty level">
                <i class="fas fa-brain" aria-hidden="true"></i>
                <span class="button-text">Normal</span>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main content section -->
    <main id="main-content">
      <div class="overlay" aria-hidden="true"></div>
      
      <!-- Unified score display - responsive for mobile/desktop -->
      <aside id="score-container" class="score-container" aria-labelledby="score-title">
        <h2 id="score-title" class="visually-hidden">Game Statistics</h2>
        <div class="score-grid">
          <div class="score-item">
            <span class="score-label">Score</span>
            <span id="score" class="score-value">0</span>
          </div>
          <div class="score-item">
            <span class="score-label">Best</span>
            <span id="best-score" class="score-value">0</span>
          </div>
          <div class="score-item">
            <span class="score-label">Moves</span>
            <span id="moves" class="score-value">0</span>
          </div>
          <div class="score-item">
            <span class="score-label">Time</span>
            <span id="time" class="score-value">00:00</span>
          </div>
        </div>
      </aside>
      
      <section class="game-section">
        <div id="board-container" class="board-container" role="grid" aria-label="Game Board" tabindex="0"></div>
        <div id="game-over" class="hidden game-message" role="alert" aria-live="assertive">Game Over!</div>
        <div id="win-message" class="hidden game-message win-message" role="alert" aria-live="assertive">
          <h3>You Win!</h3>
          <p>Congratulations! You reached 2048!</p>
          <button id="continue-button" class="game-action-btn">Continue Playing</button>
          <button id="new-game-button" class="game-action-btn">New Game</button>
        </div>
      </section>
    </main>

    <!-- Footer section -->
    <footer>
      <div class="container">
        <!-- Reset button moved to navigation menu -->
      </div>
    </footer>

    <!-- JavaScript files - loaded in specific order for proper initialization -->
    <script>
      // Pre-initialization debugging
      console.log('ðŸš€ Starting Fancy2048 script loading...');
      console.log('Document ready state:', document.readyState);
      console.log('Current URL:', window.location.href);
      console.log('Base URL:', window.location.origin);
      console.log('DOM elements check:', {
        boardContainer: !!document.getElementById('board-container'),
        scoreContainer: !!document.getElementById('score-container'),
        score: !!document.getElementById('score'),
      });
      
      // Global error handler for script loading
      window.addEventListener('error', (e) => {
        console.error('Script loading error:', e.filename, e.lineno, e.message);
      });
    </script>
    
    <!-- Load Unified Managers First -->
    <script src="../scripts/unified_data_manager.js" onerror="console.error('Failed to load unified_data_manager.js')"></script>
    <script src="../scripts/unified_ui_manager.js" onerror="console.error('Failed to load unified_ui_manager.js')"></script>
    
    <!-- Load AI and Game Logic -->
    <script src="../scripts/ai_learning_system.js" onerror="console.error('Failed to load ai_learning_system.js')"></script>
    <script src="../scripts/enhanced_ai.js" onerror="console.error('Failed to load enhanced_ai.js')"></script>
    <script src="../scripts/advanced_ai_solver.js" onerror="console.error('Failed to load advanced_ai_solver.js')"></script>
    <script src="../scripts/enhanced_ai_core.js" onerror="console.error('Failed to load enhanced_ai_core.js')"></script>
    <script src="../scripts/game_core.js" onerror="console.error('Failed to load game_core.js')"></script>
    <script src="../scripts/game_over_manager.js" onerror="console.error('Failed to load game_over_manager.js')"></script>
    <script src="../scripts/enhanced_game_integration.js" onerror="console.error('Failed to load enhanced_game_integration.js')"></script>
    
    <!-- Load Main Game Last -->
    <script src="../scripts/game.js" onerror="console.error('Failed to load game.js')"></script>
    
    <script>
      // Post-initialization debugging
      setTimeout(() => {
        console.log('ðŸŽ® Script loading completed. Available systems:');
        console.log('- UnifiedDataManager:', !!window.UnifiedDataManager);
        console.log('- UnifiedUIManager:', !!window.UnifiedUIManager);
        console.log('- AILearningSystem:', !!window.AILearningSystem);
        console.log('- Enhanced2048AI:', !!window.Enhanced2048AI);
        console.log('- Game2048Core:', !!window.Game2048Core);
        console.log('- Game:', !!window.Game);
        
        // Initialize game if not already done
        if (typeof initializeFancy2048 === 'function' && !window.gameInstance) {
          console.log('ðŸš€ Initializing game...');
          initializeFancy2048();
        }
      }, 100);
    </script>
  </body>
</html>