/* Fancy2048 - Fixed Unified Styles */

/* Root CSS Variables - Advanced Responsive System with Enhanced Safe Areas */
:root {
  --size: 4;
  
  /* Enhanced Viewport System - Support for all viewport units */
  --viewport-width: 100vw;
  --viewport-height: 100vh;
  --viewport-width-small: 100svw; /* Small viewport width */
  --viewport-height-small: 100svh; /* Small viewport height */
  --viewport-width-large: 100lvw; /* Large viewport width */
  --viewport-height-large: 100lvh; /* Large viewport height */
  --viewport-width-dynamic: 100dvw; /* Dynamic viewport width */
  --viewport-height-dynamic: 100dvh; /* Dynamic viewport height */
  
  /* Effective viewport accounting for safe areas */
  --safe-viewport-width: calc(var(--viewport-width) - var(--safe-area-inset-left) - var(--safe-area-inset-right));
  --safe-viewport-height: calc(var(--viewport-height) - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  
  /* Dynamic Board Sizing - Multi-device responsive optimization */
  --base-board-size-3x3: min(min(82vw, 82svw), min(65vh, 65svh), 420px);
  --base-board-size-4x4: min(min(85vw, 85svw), min(70vh, 70svh), 480px);
  --base-board-size-5x5: min(min(90vw, 90svw), min(75vh, 75svh), 540px);
  --base-board-size-7x7: min(min(92vw, 92svw), min(78vh, 78svh), 580px);
  --base-board-size-9x9: min(min(95vw, 95svw), min(82vh, 82svh), 620px);
  
  /* Current board size (set by JavaScript) */
  --board-max-size: var(--base-board-size-4x4);
  
  /* Advanced Gap System - Responsive and scalable */
  --gap-base: clamp(1px, 1.0vmin, 12px);
  --gap-3x3: calc(var(--gap-base) * 1.8);
  --gap-4x4: calc(var(--gap-base) * 1.2);
  --gap-5x5: calc(var(--gap-base) * 0.8);
  --gap-7x7: calc(var(--gap-base) * 0.5);
  --gap-9x9: calc(var(--gap-base) * 0.3);
  --gap: var(--gap-4x4);
  
  /* Dynamic tile size calculation */
  --tile-size: calc((var(--board-max-size) - (var(--size) + 1) * var(--gap)) / var(--size));
  
  /* Enhanced Font Scaling System with Grid-Specific Optimization - Maximum Size for Optimal Readability */
  --font-scale-3x3-base: clamp(0.75, 0.85, 0.95);
  --font-scale-3x3-large: clamp(0.65, 0.70, 0.75); 
  --font-scale-3x3-mega: clamp(0.50, 0.57, 0.65);
  
  --font-scale-4x4-base: clamp(0.65, 0.75, 0.85);
  --font-scale-4x4-large: clamp(0.55, 0.62, 0.70);
  --font-scale-4x4-mega: clamp(0.45, 0.52, 0.60);
  
  --font-scale-5x5-base: clamp(0.48, 0.55, 0.62);
  --font-scale-5x5-large: clamp(0.40, 0.46, 0.52);
  --font-scale-5x5-mega: clamp(0.33, 0.39, 0.45);
  
  --font-scale-7x7-base: clamp(0.37, 0.42, 0.48);
  --font-scale-7x7-large: clamp(0.31, 0.35, 0.40);
  --font-scale-7x7-mega: clamp(0.27, 0.31, 0.35);
  
  --font-scale-9x9-base: clamp(0.31, 0.35, 0.40);
  --font-scale-9x9-large: clamp(0.27, 0.30, 0.34);
  --font-scale-9x9-mega: clamp(0.23, 0.27, 0.31);
  
  /* Current font scales (set by JavaScript) */
  --font-scale-base: var(--font-scale-4x4-base);
  --font-scale-large: var(--font-scale-4x4-large);
  --font-scale-mega: var(--font-scale-4x4-mega);
  
  /* Enhanced Color System with Better Contrast */
  --primary-color: #1a1a1a;
  --secondary-color: #f2f2f2;
  --highlight-color: #ffcc00;
  --highlight-color-rgb: 255, 204, 0;
  --highlight-hover: hsl(calc(45 + var(--hue-value, 0)), 90%, 65%);
  --text-primary: hsl(30, 25%, 90%);
  --text-secondary: hsl(30, 20%, 75%);
  --text-muted: hsl(30, 15%, 60%);
  
  /* Enhanced Button Colors */
  --button-background: rgba(0, 16, 71, 0.4);
  --button-hover-background: rgba(255, 255, 255, 0.15);
  --button-active-background: rgba(255, 255, 255, 0.25);
  --reset-button-background: #ff7f50;
  --reset-button-hover-background: #ff4500;
  
  /* Advanced Layout Variables */
  --overlay-dark: rgba(0, 12, 48, 0.85);
  --overlay-light: rgba(255, 255, 255, 0.15);
  --transition-fast: 0.15s;
  --transition-medium: 0.3s;
  --transition-slow: 0.6s;
  --transition-duration: var(--transition-medium);
  --hue-transition-duration: var(--transition-slow);
  --tile-border-radius: clamp(6px, 1.5vmin, 14px);
  --button-border-radius: clamp(8px, 2vmin, 16px);
  --hue-value: 0;
  
  /* Enhanced Touch Target Sizing */
  --touch-target-min: 44px; /* WCAG AA minimum */
  --touch-target-comfortable: 48px; /* Comfortable size */
  --mobile-button-size: var(--touch-target-comfortable);
  --mobile-gap: clamp(6px, 1.5vmin, 12px);
  --desktop-gap: clamp(12px, 2vmin, 20px);
  
  /* Advanced Safe Area System */
  --safe-area-inset-top: max(env(safe-area-inset-top, 0px), 0px);
  --safe-area-inset-bottom: max(env(safe-area-inset-bottom, 0px), 0px);
  --safe-area-inset-left: max(env(safe-area-inset-left, 0px), 0px);
  --safe-area-inset-right: max(env(safe-area-inset-right, 0px), 0px);
  
  /* Additional safe area padding for better UX */
  --safe-padding-top: max(var(--safe-area-inset-top), 8px);
  --safe-padding-bottom: max(var(--safe-area-inset-bottom), 8px);
  --safe-padding-left: max(var(--safe-area-inset-left), 8px);
  --safe-padding-right: max(var(--safe-area-inset-right), 8px);
  
  /* Tile Colors with better contrast and visual progression */
  --tile-2-bg: hsl(calc(180 + var(--hue-value)), 50%, 95%);
  --tile-2-text: hsl(30, 20%, 30%);
  --tile-4-bg: hsl(calc(190 + var(--hue-value)), 55%, 90%);
  --tile-4-text: hsl(30, 25%, 25%);
  --tile-8-bg: linear-gradient(135deg, hsl(calc(35 + var(--hue-value)), 85%, 65%) 0%, hsl(calc(45 + var(--hue-value)), 85%, 60%) 100%);
  --tile-8-text: hsl(0, 0%, 100%);
  --tile-16-bg: linear-gradient(135deg, hsl(calc(25 + var(--hue-value)), 85%, 60%) 0%, hsl(calc(35 + var(--hue-value)), 85%, 55%) 100%);
  --tile-16-text: hsl(0, 0%, 100%);
  --tile-32-bg: linear-gradient(135deg, hsl(calc(15 + var(--hue-value)), 90%, 60%) 0%, hsl(calc(25 + var(--hue-value)), 90%, 55%) 100%);
  --tile-32-text: hsl(0, 0%, 100%);
  --tile-64-bg: linear-gradient(135deg, hsl(calc(5 + var(--hue-value)), 90%, 60%) 0%, hsl(calc(15 + var(--hue-value)), 90%, 55%) 100%);
  --tile-64-text: hsl(0, 0%, 100%);
  --tile-128-bg: linear-gradient(135deg, hsl(calc(355 + var(--hue-value)), 95%, 65%) 0%, hsl(calc(5 + var(--hue-value)), 95%, 60%) 100%);
  --tile-128-text: hsl(0, 0%, 100%);
  --tile-256-bg: linear-gradient(135deg, hsl(calc(345 + var(--hue-value)), 95%, 70%) 0%, hsl(calc(355 + var(--hue-value)), 95%, 65%) 100%);
  --tile-256-text: hsl(0, 0%, 100%);
  --tile-512-bg: linear-gradient(135deg, hsl(calc(335 + var(--hue-value)), 95%, 75%) 0%, hsl(calc(345 + var(--hue-value)), 95%, 70%) 100%);
  --tile-512-text: hsl(0, 0%, 100%);
  --tile-1024-bg: linear-gradient(135deg, hsl(calc(325 + var(--hue-value)), 95%, 80%) 0%, hsl(calc(335 + var(--hue-value)), 95%, 75%) 100%);
  --tile-1024-text: hsl(0, 0%, 100%);
  --tile-2048-bg: linear-gradient(135deg, hsl(calc(315 + var(--hue-value)), 100%, 85%) 0%, hsl(calc(325 + var(--hue-value)), 100%, 80%) 100%);
  --tile-2048-text: hsl(0, 0%, 100%);
  
  /* Board and game element colors */
  --board-bg: hsl(calc(210 + var(--hue-value)), 25%, 15%);
  --grid-cell-bg: hsl(calc(210 + var(--hue-value)), 20%, 25%);
  --empty-cell-bg: rgba(255, 255, 255, 0.05);
  
  /* Mobile touch optimization */
  --touch-target-size: 44px; /* Minimum recommended touch target */
  --mobile-spacing: clamp(4px, 1vw, 12px);
}

/* Grid-specific responsive adjustments */
.board-size-3 {
  --board-max-size: var(--base-board-size-3x3);
  --gap: var(--gap-3x3);
  --font-scale-base: var(--font-scale-3x3-base);
  --font-scale-large: var(--font-scale-3x3-large);
  --font-scale-mega: var(--font-scale-3x3-mega);
}

.board-size-4 {
  --board-max-size: var(--base-board-size-4x4);
  --gap: var(--gap-4x4);
  --font-scale-base: var(--font-scale-4x4-base);
  --font-scale-large: var(--font-scale-4x4-large);
  --font-scale-mega: var(--font-scale-4x4-mega);
}

.board-size-5 {
  --board-max-size: var(--base-board-size-5x5);
  --gap: var(--gap-5x5);
  --font-scale-base: var(--font-scale-5x5-base);
  --font-scale-large: var(--font-scale-5x5-large);
  --font-scale-mega: var(--font-scale-5x5-mega);
}

.board-size-7 {
  --board-max-size: var(--base-board-size-7x7);
  --gap: var(--gap-7x7);
  --font-scale-base: var(--font-scale-7x7-base);
  --font-scale-large: var(--font-scale-7x7-large);
  --font-scale-mega: var(--font-scale-7x7-mega);
}

.board-size-9 {
  --board-max-size: var(--base-board-size-9x9);
  --gap: var(--gap-9x9);
  --font-scale-base: var(--font-scale-9x9-base);
  --font-scale-large: var(--font-scale-9x9-large);
  --font-scale-mega: var(--font-scale-9x9-mega);
}

/* Light mode variables */
body.light-mode {
  --primary-color: #f2f2f2;
  --secondary-color: #1a1a1a;
  --button-background: rgba(255, 255, 255, 0.8);
  --button-hover-background: rgba(0, 0, 0, 0.1);
  
  /* Light mode board colors */
  --board-bg: hsl(calc(210 + var(--hue-value)), 15%, 90%);
  --grid-cell-bg: hsl(calc(210 + var(--hue-value)), 10%, 95%);
  --empty-cell-bg: rgba(0, 0, 0, 0.05);
  
  /* Light mode tile adjustments - better contrast for readability */
  --tile-2-bg: hsl(calc(180 + var(--hue-value)), 40%, 85%);
  --tile-2-text: hsl(30, 40%, 20%);
  --tile-4-bg: hsl(calc(190 + var(--hue-value)), 45%, 80%);
  --tile-4-text: hsl(30, 45%, 15%);
}

/* Light mode specific tile border adjustments */
body.light-mode .tile[data-value="2"] {
  border: 1px solid rgba(119, 110, 101, 0.3);
}

body.light-mode .tile[data-value="4"] {
  border: 1px solid rgba(119, 110, 101, 0.4);
}

/* Enhanced Base Body Styles with Advanced Safe Area Support */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
  background: linear-gradient(135deg, var(--primary-color) 0%, #2a2a2a 100%);
  color: var(--secondary-color);
  margin: 0;
  padding: 0;
  
  /* Advanced Viewport Height Support */
  min-height: 100vh;
  min-height: 100dvh; /* Dynamic viewport height for modern browsers */
  min-height: 100svh; /* Small viewport height for mobile browsers */
  height: 100vh;
  height: 100dvh;
  
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  
  /* Enhanced Safe Area Support */
  padding-top: var(--safe-padding-top);
  padding-bottom: var(--safe-padding-bottom);
  padding-left: var(--safe-padding-left);
  padding-right: var(--safe-padding-right);
  
  /* Prevent overflow and bouncing */
  overflow-x: hidden;
  overscroll-behavior: none;
  
  /* Enhanced Performance and UX */
  transition: background var(--transition-duration), color var(--transition-duration);
  box-sizing: border-box;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -webkit-touch-callout: none;
  -webkit-text-size-adjust: none;
  text-size-adjust: none;
  scroll-behavior: smooth;
  
  /* Better font rendering */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  
  /* CSS containment for better performance */
  contain: layout style paint;
}

/* Enhanced Safe Area Support with Environment Variables */
@supports (padding-top: env(safe-area-inset-top)) {
  body {
    padding-top: max(var(--safe-area-inset-top), 12px);
    padding-bottom: max(var(--safe-area-inset-bottom), 12px);
    padding-left: max(var(--safe-area-inset-left), 8px);
    padding-right: max(var(--safe-area-inset-right), 8px);
  }
  
  /* Ensure controls don't get hidden behind notches */
  #controls-container {
    padding-left: max(var(--safe-area-inset-left), 8px);
    padding-right: max(var(--safe-area-inset-right), 8px);
  }
  
  /* Additional safe area support for game board */
  #board-container {
    margin-left: max(var(--safe-area-inset-left), 0);
    margin-right: max(var(--safe-area-inset-right), 0);
  }
}

/* Skip to main content for accessibility */
.skip-link {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--highlight-color);
  color: var(--primary-color);
  padding: 8px;
  text-decoration: none;
  border-radius: 4px;
  z-index: 1000;
}

.skip-link:focus {
  top: 6px;
}

/* Header Styles - New Clean Layout Without Hamburger Menu */
header {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 100%);
  backdrop-filter: blur(15px);
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
  border-bottom: 2px solid rgba(255, 204, 0, 0.2);
  box-sizing: border-box;
  transition: all 0.3s ease;
}

header .container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 1200px;
  gap: 15px;
}

/* Desktop header layout */
@media (min-width: 769px) {
  header {
    padding: 25px 30px;
  }
  
  header .container {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 30px;
  }
  
  header .game-title,
  header h1 {
    margin: 0;
    flex-grow: 0;
    text-align: left;
  }
}

header .game-title,
header h1 {
  font-size: clamp(1.6rem, 4vw, 2.5rem);
  color: var(--highlight-color);
  margin: 0 0 10px 0;
  text-align: center;
  font-weight: 700;
  letter-spacing: 2px;
  text-shadow: 0 3px 15px rgba(255, 204, 0, 0.4);
  transition: all var(--transition-duration);
}

/* Navigation - Clean layout for all screen sizes */
.main-nav {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

@media (min-width: 769px) {
  .main-nav {
    width: auto;
    flex-direction: row;
    gap: 20px;
  }
}

.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  width: 100%;
  flex-wrap: wrap;
  list-style: none;
  margin: 0;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@media (min-width: 769px) {
  .controls {
    width: auto;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 15px;
    padding: 15px;
    gap: 12px;
  }
}

.secondary-controls {
  margin-top: 0;
}

@media (max-width: 768px) {
  .secondary-controls {
    margin-top: 5px;
  }
}

.controls li {
  display: flex;
}

/* Button Styles - Enhanced for Desktop */
button {
  padding: 14px 18px;
  font-size: 16px;
  color: #ffffff;
  border-radius: var(--tile-border-radius);
  border: none;
  background: var(--button-background);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: all var(--transition-duration);
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 48px;
  min-height: 48px;
  position: relative;
  overflow: hidden;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* Enhanced Desktop Button Styles */
@media (min-width: 769px) {
  button {
    padding: 16px 20px;
    font-size: 17px;
    min-width: 52px;
    min-height: 52px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }
  
  button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
  }
}

button:hover {
  background: var(--button-hover-background);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 255, 255, 0.15);
}

button:active {
  transform: translateY(0);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

button i {
  margin-right: 0;
  font-size: 1.1em;
}

/* Button labels - hidden on mobile, shown on desktop */
.button-label {
  display: none;
  margin-left: 8px;
  font-size: 0.9em;
  font-weight: 500;
}

@media (min-width: 769px) {
  button i {
    margin-right: 8px;
  }
  
  .button-label {
    display: inline;
  }
}

@media (max-width: 480px) {
  .button-label {
    display: none;
  }
  
  button {
    min-width: 44px;
    min-height: 44px;
    padding: 10px;
  }
}

button:focus {
  outline: 2px solid var(--highlight-color);
  outline-offset: 2px;
}

/* Special Button Styles */
#reset-button {
  background: var(--reset-button-background);
  color: white;
}

#reset-button:hover {
  background: var(--reset-button-hover-background);
}

#changeColor-button {
  background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
}

#leaderboard-button {
  background: linear-gradient(45deg, #667eea, #764ba2);
}

/* Speed button specific styles */
#speed-button {
  background: linear-gradient(45deg, #ffa726, #fb8c00);
  min-width: 48px;
}

#speed-button .speed-text {
  font-size: 0.9rem;
  font-weight: bold;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

#speed-button:hover {
  background: linear-gradient(45deg, #ffb74d, #ff9800);
}

/* AI Difficulty Button Specific Styles */
#ai-difficulty-button {
  background: linear-gradient(45deg, #9c27b0, #673ab7);
  min-width: 100px;
  position: relative;
  overflow: hidden;
}

#ai-difficulty-button .button-text {
  font-size: 0.85rem;
  font-weight: 600;
  margin-left: 5px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

#ai-difficulty-button:hover {
  background: linear-gradient(45deg, #ad35c5, #7e57c2);
}

/* Difficulty-specific colors */
#ai-difficulty-button[data-difficulty="easy"] {
  background: linear-gradient(45deg, #4caf50, #45a049);
}

#ai-difficulty-button[data-difficulty="normal"] {
  background: linear-gradient(45deg, #2196f3, #1976d2);
}

#ai-difficulty-button[data-difficulty="hard"] {
  background: linear-gradient(45deg, #ff9800, #f57c00);
}

#ai-difficulty-button[data-difficulty="expert"] {
  background: linear-gradient(45deg, #f44336, #d32f2f);
}

/* Button animation on difficulty change */
@keyframes difficultyChange {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

#ai-difficulty-button.changing {
  animation: difficultyChange 0.3s ease;
}

/* Main Content Area - Enhanced Desktop Layout */
main {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: 100%;
  max-width: 100vw;
  flex: 1;
  padding: 20px;
  box-sizing: border-box;
  position: relative;
  gap: 15px;
}

/* Enhanced Desktop Layout */
@media (min-width: 1025px) {
  main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 30px;
    gap: 35px;
    flex-direction: row;
    align-items: flex-start;
    justify-content: center;
  }
}

/* ===========================================
   UNIFIED SCORE CONTAINER SYSTEM
   Responsive score display that works on all devices
   =========================================== */

/* Unified Score Container - Responsive for all devices */
.score-container {
  width: 100%;
  max-width: min(520px, 90vw);
  margin: 0 auto 20px auto;
  background: linear-gradient(135deg, rgba(255, 204, 0, 0.1) 0%, rgba(0, 0, 0, 0.4) 100%);
  border-radius: 15px;
  padding: 15px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 204, 0, 0.2);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  box-sizing: border-box;
}

/* Desktop Layout (>768px) - Beside board */
@media (min-width: 769px) {
  .score-container {
    display: block;
    width: 250px;
    margin: 0 0 0 30px;
    background: linear-gradient(135deg, rgba(255, 204, 0, 0.1) 0%, rgba(0, 0, 0, 0.4) 100%);
    border-radius: 20px;
    padding: 25px;
    align-self: flex-start;
    position: sticky;
    top: 120px;
  }
}

/* Large Desktop (>1024px) - Enhanced styling */
@media (min-width: 1025px) {
  .score-container {
    width: 280px;
    padding: 30px;
    border-radius: 25px;
  }
}

/* Score Grid Layout */
.score-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

/* Mobile Portrait - 2x2 grid */
@media (max-width: 480px) {
  .score-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
}

/* Desktop - Vertical stack */
@media (min-width: 769px) {
  .score-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
}

/* Score Item Styling */
.score-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 8px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
}

/* Desktop score item styling */
@media (min-width: 769px) {
  .score-item {
    flex-direction: row;
    justify-content: space-between;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.08);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0;
    border-left: none;
    border-right: none;
    border-top: none;
  }

  .score-item:last-child {
    border-bottom: none;
  }
}

/* Score Labels */
.score-label {
  font-size: 0.8em;
  color: var(--highlight-color);
  font-weight: 600;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

@media (min-width: 769px) {
  .score-label {
    font-size: 1.1em;
    margin-bottom: 0;
    font-weight: 500;
    color: #ffffff;
  }
}

/* Score Values */
.score-value {
  font-size: 1.1em;
  color: #ffffff;
  font-weight: 700;
  min-height: 1.5em;
  display: flex;
  align-items: center;
  transition: all 0.3s ease;
}

@media (min-width: 769px) {
  .score-value {
    font-size: 1.4em;
    color: var(--highlight-color);
    font-weight: 800;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }
}

/* New best score animation */
.score-value.new-best-score {
  animation: newBestScore 1.5s ease-out;
}

@keyframes newBestScore {
  0% { transform: scale(1); }
  50% { 
    transform: scale(1.2); 
    text-shadow: 0 0 15px currentColor;
  }
  100% { transform: scale(1); }
}

/* Game message styling */
.game-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  z-index: 1000;
  border: 2px solid var(--highlight-color);
  backdrop-filter: blur(10px);
}

.win-message {
  background: linear-gradient(135deg, rgba(255, 204, 0, 0.9), rgba(255, 215, 0, 0.9));
  color: #000;
}

.game-action-btn {
  margin: 10px 5px 0;
  padding: 12px 20px;
  background: var(--highlight-color);
  color: var(--primary-color);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.game-action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Game Section - Enhanced */
.game-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  max-width: min(520px, 90vw);
  margin: 0 auto;
  position: relative;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 20px;
  padding: 25px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

@media (min-width: 1025px) {
  .game-section {
    max-width: 600px;
    padding: 35px;
    border-radius: 25px;
  }
}

/* Score Container - Enhanced */
#score-container {
  width: 100%;
  max-width: min(520px, 90vw);
  margin-bottom: 0;
  background: linear-gradient(135deg, rgba(255, 204, 0, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
  backdrop-filter: blur(15px);
  border-radius: var(--tile-border-radius);
  padding: 20px;
  box-sizing: border-box;
  border: 1px solid rgba(255, 204, 0, 0.2);
  box-shadow: 0 6px 25px rgba(255, 204, 0, 0.1);
}

@media (min-width: 1025px) {
  #score-container {
    max-width: 600px;
    padding: 25px;
    border-radius: 18px;
  }
}

#score-container ul {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 18px;
  list-style: none;
  margin: 0;
  padding: 0;
}

@media (min-width: 1025px) {
  #score-container ul {
    gap: 22px;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }
}

#score-container li {
  text-align: center;
  font-weight: 600;
  color: var(--secondary-color);
  font-size: 1rem;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

@media (min-width: 1025px) {
  #score-container li {
    font-size: 1.1rem;
  }
}

#score-container span {
  display: block;
  font-size: 1.6em;
  font-weight: bold;
  color: var(--highlight-color);
  margin-top: 6px;
  text-shadow: 0 2px 6px rgba(255, 204, 0, 0.3);
}

@media (min-width: 1025px) {
  #score-container span {
    font-size: 1.8em;
    margin-top: 8px;
  }
}

/* Enhanced Board Container with Advanced Touch Handling and Safe Areas */
#board-container {
  display: grid;
  grid-template-columns: repeat(var(--size), 1fr);
  grid-template-rows: repeat(var(--size), 1fr);
  gap: var(--gap);
  width: var(--board-max-size);
  height: var(--board-max-size);
  max-width: calc(100vw - 2 * max(var(--safe-area-inset-left), var(--safe-area-inset-right)));
  max-height: calc(100vh - 2 * max(var(--safe-area-inset-top), var(--safe-area-inset-bottom)));
  aspect-ratio: 1 / 1;
  background: var(--board-bg);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border-radius: var(--tile-border-radius);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.4),
    0 2px 8px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  position: relative;
  padding: var(--gap);
  box-sizing: border-box;
  
  /* Enhanced Touch Handling */
  touch-action: none;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  
  /* Border and Visual Enhancements */
  border: 1px solid rgba(255, 255, 255, 0.15);
  margin: 0 auto;
  overflow: visible;
  
  /* Performance Optimizations */
  will-change: transform, box-shadow;
  contain: layout style paint;
  cursor: pointer;
  
  /* Centering */
  justify-self: center;
  align-self: center;
  
  /* Enhanced Transitions */
  transition: 
    transform var(--transition-fast) ease,
    box-shadow var(--transition-fast) ease,
    border-color var(--transition-fast) ease;
}

#board-container:focus {
  outline: 3px solid var(--highlight-color);
  outline-offset: 3px;
  border-color: var(--highlight-color);
}

#board-container:active {
  transform: scale(0.98);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 1px 4px rgba(0, 0, 0, 0.2);
}

/* Safe Area Adjustments for Board Container */
@supports (padding: max(0px, env(safe-area-inset-left))) {
  #board-container {
    margin-left: max(8px, env(safe-area-inset-left, 0px));
    margin-right: max(8px, env(safe-area-inset-right, 0px));
  }
}

/* Grid Cell Backgrounds */
.grid-cell {
  background: var(--grid-cell-bg);
  border-radius: calc(var(--tile-border-radius) - 2px);
  width: 100%;
  height: 100%;
  aspect-ratio: 1 / 1;
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.05);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  transition: background-color var(--hue-transition-duration) ease-in-out;
}

/* Tile Styles */
.tile {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  aspect-ratio: 1 / 1;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Dynamic font sizing based on actual tile size */
  font-size: calc(var(--tile-size) * var(--font-scale-base));
  font-weight: 800; /* Increased from bold (700) for better accessibility */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Remove default color and background - let specific tile rules handle this */
  border-radius: calc(var(--tile-border-radius) - 2px);
  transition: all 0.15s ease-in-out, background var(--hue-transition-duration) ease-in-out, border-color var(--hue-transition-duration) ease-in-out;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 10;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  overflow: hidden;
  /* Only apply default background to empty tiles (tiles without data-value) */
  background: transparent;
  color: #776e65;
}

/* Individual Tile Colors */
.tile[data-value="2"] {
  background: var(--tile-2-bg, #eee4da) !important;
  color: var(--tile-2-text, #776e65) !important;
  border: 1px solid rgba(238, 228, 218, 0.8);
}

.tile[data-value="4"] {
  background: var(--tile-4-bg, #ede0c8) !important;
  color: var(--tile-4-text, #776e65) !important;
  border: 1px solid rgba(237, 224, 200, 0.8);
}

.tile[data-value="8"] {
  background: var(--tile-8-bg, linear-gradient(135deg, #f2b179 0%, #f59563 100%)) !important;
  color: var(--tile-8-text, #f9f6f2) !important;
  border: 1px solid rgba(242, 177, 121, 0.8);
}

.tile[data-value="16"] {
  background: var(--tile-16-bg, linear-gradient(135deg, #f59563 0%, #f67c5f 100%)) !important;
  color: var(--tile-16-text, #f9f6f2) !important;
  border: 1px solid rgba(245, 149, 99, 0.8);
}

.tile[data-value="32"] {
  background: var(--tile-32-bg, linear-gradient(135deg, #f67c5f 0%, #f65e3b 100%)) !important;
  color: var(--tile-32-text, #f9f6f2) !important;
  border: 1px solid rgba(246, 124, 95, 0.8);
}

.tile[data-value="64"] {
  background: var(--tile-64-bg, linear-gradient(135deg, #f65e3b 0%, #ff4500 100%)) !important;
  color: var(--tile-64-text, #f9f6f2) !important;
  border: 1px solid rgba(246, 94, 59, 0.8);
}

.tile[data-value="128"] {
  background: var(--tile-128-bg, linear-gradient(135deg, #edcf72 0%, #edcc61 100%)) !important;
  color: var(--tile-128-text, #f9f6f2) !important;
  border: 1px solid rgba(237, 207, 114, 0.8);
  font-weight: bold;
}

.tile[data-value="256"] {
  background: var(--tile-256-bg, linear-gradient(135deg, #edcc61 0%, #edc850 100%)) !important;
  color: var(--tile-256-text, #f9f6f2) !important;
  border: 1px solid rgba(237, 204, 97, 0.8);
  font-weight: bold;
}

.tile[data-value="512"] {
  background: var(--tile-512-bg, linear-gradient(135deg, #edc850 0%, #edc53f 100%)) !important;
  color: var(--tile-512-text, #f9f6f2) !important;
  border: 1px solid rgba(237, 200, 80, 0.8);
  font-weight: bold;
}

.tile[data-value="1024"] {
  background: var(--tile-1024-bg, linear-gradient(135deg, #edc53f 0%, #edc22e 100%)) !important;
  color: var(--tile-1024-text, #f9f6f2) !important;
  font-size: calc(var(--tile-size) * var(--font-scale-large));
  border: 1px solid rgba(237, 197, 63, 0.8);
  font-weight: bold;
}

.tile[data-value="2048"] {
  background: var(--tile-2048-bg, linear-gradient(135deg, #edc22e 0%, #ffd700 100%)) !important;
  color: var(--tile-2048-text, #f9f6f2) !important;
  font-size: calc(var(--tile-size) * var(--font-scale-large));
  box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
  border: 2px solid #ffcc00;
  font-weight: bold;
}

/* High-value tiles (4096 and beyond) with distinct colors */
.tile[data-value="4096"] {
  background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
  color: white;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 25px rgba(255, 107, 107, 0.4);
  border: 2px solid #ff6b6b;
  font-weight: bold;
}

.tile[data-value="8192"] {
  background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
  color: white;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 25px rgba(78, 205, 196, 0.4);
  border: 2px solid #4ecdc4;
  font-weight: bold;
}

.tile[data-value="16384"] {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  color: white;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 25px rgba(155, 89, 182, 0.4);
  border: 2px solid #9b59b6;
  font-weight: bold;
}

.tile[data-value="32768"] {
  background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
  color: white;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 25px rgba(243, 156, 18, 0.4);
  border: 2px solid #f39c12;
  font-weight: bold;
}

.tile[data-value="65536"] {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
  color: white;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 30px rgba(231, 76, 60, 0.5);
  border: 2px solid #e74c3c;
  font-weight: bold;
}

/* Even higher values for extreme gameplay */
.tile[data-value="131072"] {
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  color: #ecf0f1;
  font-size: calc(var(--tile-size) * var(--font-scale-mega));
  box-shadow: 0 0 30px rgba(44, 62, 80, 0.5);
  border: 2px solid #2c3e50;
  font-weight: bold;
}

/* Tile Animations */
.tile.new-tile {
  animation: appear 0.3s ease-out;
}

.tile.merged {
  animation: pop 0.3s ease-out;
}

@keyframes appear {
  from {
    opacity: 0;
    transform: scale(0);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes pop {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes shake {
  0%, 100% {
    transform: translateX(0);
  }
  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-4px);
  }
  20%, 40%, 60%, 80% {
    transform: translateX(4px);
  }
}

@keyframes invalidSwipe {
  0%, 100% {
    transform: scale(1) rotate(0deg);
    filter: brightness(1);
  }
  25% {
    transform: scale(0.98) rotate(-1deg);
    filter: brightness(1.1) saturate(1.2);
  }
  50% {
    transform: scale(1.02) rotate(1deg);
    filter: brightness(1.2) saturate(1.4);
  }
  75% {
    transform: scale(0.99) rotate(-0.5deg);
    filter: brightness(1.1) saturate(1.1);
  }
}

/* Enhanced Mobile Optimization Classes */
.mobile-optimized {
  /* Improve touch responsiveness */
  touch-action: pan-x pan-y;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}

.reduced-animations * {
  /* Reduce animations on lower-end devices */
  animation-duration: 0.1s !important;
  transition-duration: 0.1s !important;
}

.low-performance .tile {
  /* Simplified styling for low-performance devices */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) !important;
  background: linear-gradient(135deg, var(--tile-color), var(--tile-color)) !important;
}

.low-performance .board-container {
  /* Reduce visual complexity */
  filter: none !important;
}

/* High contrast accessibility mode */
.high-contrast {
  --tile-color: #000000;
  --text-color: #ffffff;
  --background-color: #ffffff;
  --board-background: #333333;
}

.high-contrast .tile {
  border: 2px solid #ffffff !important;
  color: #ffffff !important;
  font-weight: bold !important;
}

.high-contrast .board-container {
  background: #333333 !important;
  border: 2px solid #000000 !important;
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.05);
    opacity: 0.8;
  }
}

/* Game Over Overlay */
#game-over {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--overlay-dark);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--tile-border-radius);
  font-size: 2rem;
  font-weight: bold;
  color: var(--highlight-color);
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
  z-index: 1000;
  transition: opacity var(--transition-duration);
}

.hidden {
  display: none !important;
}

/* Footer */
footer {
  width: 100%;
  padding: 20px;
  text-align: center;
  background: rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  box-sizing: border-box;
}

footer .container {
  max-width: 800px;
  margin: 0 auto;
}

/* Utility Classes */
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.visually-hidden:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: inherit;
}

/* Responsive Design */
/* Responsive design improvements */
/* Large tablets and small desktops */
@media (max-width: 1024px) {
  :root {
    --board-max-size: min(85vw, 85vh, 450px);
  }
  
  main {
    padding: 20px;
  }
}

/* Tablets */
@media (max-width: 768px) {
  :root {
    --board-max-size: min(90vw, 90vh, 400px);
  }
  
  header {
    padding: 15px;
  }
  
  header h1 {
    font-size: 2rem;
    margin-bottom: 15px;
  }
  
  .controls {
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  button {
    padding: 10px 12px;
    font-size: 14px;
    min-width: var(--mobile-button-size);
    min-height: var(--mobile-button-size);
  }
  
  main {
    padding: 15px;
  }
  
  #score-container {
    margin-bottom: 15px;
    padding: 12px;
  }
  
  #score-container ul {
    gap: 10px;
  }
  
  #score-container span {
    font-size: 1.3em;
  }
  
  .tile {
    /* Significantly increased mobile font size for better accessibility */
    font-size: clamp(1.1rem, calc(var(--tile-size) * 0.55), 3.5rem);
  }
}

/* ============================================
   Mobile Touch and Performance Optimizations  
   ============================================ */

/* Global mobile touch improvements */
@media (hover: none) and (pointer: coarse) {
  /* This targets touch devices specifically */
  * {
    -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
  }
  
  button, .tile, [data-testid] {
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(255, 255, 255, 0.2);
  }
  
  /* Improve scrolling on touch devices */
  body {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  /* Enhanced game board for touch */
  #board-container {
    /* Prevent accidental zoom on double-tap */
    touch-action: none;
  }
}

/* iOS Safari and WebKit specific optimizations */
@supports (-webkit-touch-callout: none) {
  /* iOS-specific improvements */
  body {
    -webkit-text-size-adjust: 100%;
    -webkit-font-smoothing: antialiased;
  }
  
  /* Prevent iOS Safari from adding tap highlights to non-interactive elements */
  .tile, .board-container, .game-board {
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Better button appearance on iOS */
  button {
    -webkit-appearance: none;
    appearance: none;
  }
  
  /* Improve input handling on iOS */
  input {
    -webkit-appearance: none;
    appearance: none;
    border-radius: 0;
  }
}

/* ============================================
   ENHANCED MOBILE RESPONSIVE SYSTEM
   ============================================ */

/* Ultra-small screens (iPhone SE, old Android phones) */
@media (max-width: 375px), (max-height: 667px) and (orientation: portrait) {
  :root {
    /* Ultra-compact board sizes */
    --base-board-size-3x3: min(min(88vw, 88svw), min(58vh, 58svh), 280px);
    --base-board-size-4x4: min(min(90vw, 90svw), min(60vh, 60svh), 300px);
    --base-board-size-5x5: min(min(92vw, 92svw), min(62vh, 62svh), 320px);
    
    /* Ultra-tight gaps */
    --gap-base: clamp(0.5px, 0.6vmin, 4px);
    --mobile-button-size: 40px;
    --touch-target-comfortable: 42px;
  }
  
  header h1 {
    font-size: clamp(1.2rem, 4vw, 1.5rem);
    margin-bottom: 4px;
  }
  
  button {
    padding: 6px 8px;
    font-size: 11px;
    min-width: 40px;
    min-height: 40px;
  }
  
  #score-container {
    font-size: 0.75rem;
    padding: 4px;
    gap: 4px;
  }
}

/* Small mobile phones in portrait - ENHANCED VERTICAL LAYOUT */
@media (max-width: 480px) and (orientation: portrait) {
  :root {
    /* Mobile-optimized board sizes with dynamic viewport-aware scaling */
    --base-board-size-3x3: min(min(90vw, 90svw), min(calc(100dvh - 180px), calc(100svh - 180px)), 320px);
    --base-board-size-4x4: min(min(92vw, 92svw), min(calc(100dvh - 180px), calc(100svh - 180px)), 340px);
    --base-board-size-5x5: min(min(95vw, 95svw), min(calc(100dvh - 180px), calc(100svh - 180px)), 360px);
    
    /* Mobile-optimized gaps with tighter spacing */
    --gap-base: clamp(1px, 0.8vmin, 5px);
    --mobile-button-size: 44px;
    
    /* Dynamic viewport-aware layout variables */
    --mobile-header-height: clamp(50px, 12vh, 70px);
    --mobile-score-height: clamp(50px, 10vh, 60px);
    --mobile-padding: clamp(6px, 2vw, 12px);
    
    /* Enhanced Mobile Font Scaling for Maximum Readability */
    --font-scale-4x4-base: clamp(0.65, 0.75, 0.85);
    --font-scale-4x4-large: clamp(0.55, 0.62, 0.70);
    --font-scale-4x4-mega: clamp(0.45, 0.52, 0.60);
    
    --font-scale-5x5-base: clamp(0.48, 0.55, 0.62);
    --font-scale-5x5-large: clamp(0.40, 0.46, 0.52);
    --font-scale-5x5-mega: clamp(0.33, 0.39, 0.45);
    
    --font-scale-7x7-base: clamp(0.37, 0.42, 0.48);
    --font-scale-7x7-large: clamp(0.31, 0.35, 0.40);
    --font-scale-7x7-mega: clamp(0.27, 0.31, 0.35);
  }
  
  /* Better mobile viewport handling with proper vertical layout */
  body {
    min-height: 100vh;
    min-height: 100dvh; /* Dynamic viewport height */
    min-height: 100svh; /* Small viewport height for mobile browsers */
    height: 100vh;
    height: 100dvh;
    overflow-x: hidden;
    overflow-y: hidden; /* Prevent scroll bounce */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    display: flex;
    flex-direction: column;
    padding: env(safe-area-inset-top, 0px) env(safe-area-inset-right, 0px) env(safe-area-inset-bottom, 0px) env(safe-area-inset-left, 0px);
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
  }
  
  /* Mobile header - dynamic height for optimal space usage */
  header {
    height: var(--mobile-header-height);
    min-height: var(--mobile-header-height);
    padding: var(--mobile-padding);
    display: flex;
    align-items: center;
    flex-shrink: 0;
    border-bottom: 1px solid rgba(255, 204, 0, 0.2);
    background: rgba(26, 26, 26, 0.98);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 10;
  }
  
  header .container {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: none;
  }
  
  header h1 {
    font-size: clamp(1.1rem, 4.5vw, 1.4rem);
    margin: 0;
    flex: 1;
    color: var(--highlight-color);
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }
  
  /* Main content area - optimized for vertical arrangement */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    justify-content: flex-start;
    padding: var(--mobile-padding);
    gap: var(--mobile-padding);
    min-height: 0;
    overflow: hidden;
    height: calc(100dvh - var(--mobile-header-height) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
  }
  
  /* Score container - compact and efficient */
  #score-container {
    width: 100%;
    height: var(--mobile-score-height);
    min-height: var(--mobile-score-height);
    max-height: var(--mobile-score-height);
    font-size: clamp(0.75rem, 2vw, 0.9rem);
    padding: var(--mobile-padding);
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 204, 0, 0.35);
    border-radius: clamp(8px, 2vw, 12px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
    backdrop-filter: blur(8px);
    margin: 0;
    overflow: hidden;
  }
  
  #score-container ul {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(4px, 1vw, 8px);
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
    width: 100%;
  }
  
  #score-container li {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: clamp(0.7rem, 1.8vw, 0.85rem);
    color: rgba(255, 255, 255, 0.85);
    min-width: clamp(50px, 15vw, 70px);
    line-height: 1.1;
  }
  
  #score-container span {
    font-size: clamp(0.9em, 2vw, 1.2em);
    font-weight: 700;
    color: var(--highlight-color);
    margin-top: 1px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  /* Game section - maximizes available space efficiently */
  .game-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 0;
    overflow: hidden;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
    backdrop-filter: none;
  }

  /* Mobile-optimized board sizing with dynamic viewport awareness */
  #board-container {
    width: min(
      calc(100vw - 2 * var(--mobile-padding)), 
      calc(100dvh - var(--mobile-header-height) - var(--mobile-score-height) - 4 * var(--mobile-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      380px
    );
    height: min(
      calc(100vw - 2 * var(--mobile-padding)), 
      calc(100dvh - var(--mobile-header-height) - var(--mobile-score-height) - 4 * var(--mobile-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      380px
    );
    max-width: min(
      calc(100vw - 2 * var(--mobile-padding)), 
      calc(100dvh - var(--mobile-header-height) - var(--mobile-score-height) - 4 * var(--mobile-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      380px
    );
    max-height: min(
      calc(100vw - 2 * var(--mobile-padding)), 
      calc(100dvh - var(--mobile-header-height) - var(--mobile-score-height) - 4 * var(--mobile-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      380px
    );
    margin: 0;
    flex-shrink: 0;
    border-radius: clamp(12px, 3vw, 16px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
  }
}

/* Mobile Landscape - ENHANCED HORIZONTAL LAYOUT for small screens */
@media (max-width: 768px) and (orientation: landscape) and (max-height: 500px) {
  :root {
    /* Landscape-optimized board sizes - prioritize height usage */
    --base-board-size-3x3: min(min(70vh, 70svh), min(60vw, 60svw), 300px);
    --base-board-size-4x4: min(min(75vh, 75svh), min(65vw, 65svw), 330px);
    --base-board-size-5x5: min(min(80vh, 80svh), min(70vw, 70svw), 360px);
    
    --gap-base: clamp(1px, 0.8vmin, 4px);
    
    /* Landscape-specific layout variables - compact for small height */
    --landscape-sidebar-width: clamp(160px, 25vw, 220px);
    --landscape-header-height: clamp(40px, 8vh, 60px);
    --landscape-padding: clamp(4px, 1vh, 8px);
  }
  
  /* Landscape body - horizontal layout for space efficiency */
  body {
    display: flex;
    flex-direction: row;
    height: 100vh;
    height: 100dvh;
    overflow: hidden;
    padding: max(env(safe-area-inset-top), var(--landscape-padding)) max(env(safe-area-inset-right), var(--landscape-padding)) max(env(safe-area-inset-bottom), var(--landscape-padding)) max(env(safe-area-inset-left), var(--landscape-padding));
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
  }
  
  /* Landscape header - sidebar layout */
  header {
    width: var(--landscape-sidebar-width);
    min-width: var(--landscape-sidebar-width);
    height: 100%;
    padding: var(--landscape-padding);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: rgba(26, 26, 26, 0.98);
    border-right: 1px solid rgba(255, 204, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    flex-shrink: 0;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    gap: var(--landscape-padding);
  }
  
  header .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    gap: var(--landscape-padding);
  }
  
  header h1 {
    font-size: clamp(0.9rem, 3vw, 1.2rem);
    margin: 0;
    text-align: center;
    color: var(--highlight-color);
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Controls in header for landscape */
  .controls {
    display: flex;
    flex-direction: column;
    gap: clamp(3px, 1vh, 6px);
    align-items: center;
    width: 100%;
  }
  
  .controls button {
    width: 100%;
    max-width: calc(var(--landscape-sidebar-width) - 2 * var(--landscape-padding));
    padding: clamp(4px, 1vh, 8px) clamp(6px, 1.5vw, 12px);
    font-size: clamp(0.7rem, 2vw, 0.85rem);
    min-height: clamp(32px, 6vh, 40px);
    border-radius: 6px;
    font-weight: 600;
    text-align: center;
  }
  
  /* Main content - game area and score container */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: var(--landscape-padding);
    gap: var(--landscape-padding);
    min-height: 0;
    overflow: hidden;
    height: 100%;
  }
  
  /* Score container - compact horizontal layout */
  #score-container {
    width: 100%;
    height: auto;
    max-width: none;
    font-size: clamp(0.65rem, 2vw, 0.8rem);
    padding: var(--landscape-padding);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 204, 0, 0.3);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin: 0;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
  }
  
  #score-container ul {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: clamp(6px, 2vw, 12px);
    align-items: center;
    justify-content: center;
    margin: 0;
    padding: 0;
    width: 100%;
  }
  
  #score-container li {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: clamp(0.6rem, 2vw, 0.75rem);
    color: rgba(255, 255, 255, 0.85);
    min-width: clamp(40px, 12vw, 60px);
    text-align: center;
  }
  
  #score-container span {
    font-size: clamp(0.8em, 2.2vw, 1em);
    font-weight: 700;
    color: var(--highlight-color);
    margin-top: 2px;
  }
  
  /* Game section - maximizes remaining vertical space */
  .game-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 0;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
    backdrop-filter: none;
  }
  
  /* Landscape board sizing - optimal for available space */
  #board-container {
    width: min(
      calc(100vw - var(--landscape-sidebar-width) - 3 * var(--landscape-padding)),
      calc(100vh - 3 * var(--landscape-padding) - 50px), /* Account for score container height */
      350px
    );
    height: min(
      calc(100vw - var(--landscape-sidebar-width) - 3 * var(--landscape-padding)),
      calc(100vh - 3 * var(--landscape-padding) - 50px), /* Account for score container height */
      350px
    );
    max-width: min(
      calc(100vw - var(--landscape-sidebar-width) - 3 * var(--landscape-padding)),
      calc(100vh - 3 * var(--landscape-padding) - 50px), /* Account for score container height */
      350px
    );
    max-height: min(
      calc(100vw - var(--landscape-sidebar-width) - 3 * var(--landscape-padding)),
      calc(100vh - 3 * var(--landscape-padding) - 50px), /* Account for score container height */
      350px
    );
    margin: 0;
    flex-shrink: 0;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
  }
}

/* Tablet portrait - ENHANCED VERTICAL LAYOUT */
@media (min-width: 481px) and (max-width: 768px) and (orientation: portrait) {
  :root {
    /* Tablet-optimized board sizes with better scaling */
    --base-board-size-3x3: min(min(70vw, 70svw), min(60vh, 60svh), 420px);
    --base-board-size-4x4: min(min(75vw, 75svw), min(65vh, 65svh), 470px);
    --base-board-size-5x5: min(min(80vw, 80svw), min(70vh, 70svh), 520px);
    
    /* Enhanced spacing for tablet interactions */
    --gap-base: clamp(6px, 1.2vmin, 12px);
    --tablet-padding: clamp(16px, 3vw, 24px);
    --tablet-header-height: clamp(70px, 10vh, 90px);
    --tablet-score-height: clamp(70px, 8vh, 85px);
    
    /* Enhanced Font Scaling for Tablets */
    --font-scale-4x4-base: clamp(0.55, 0.65, 0.75);
    --font-scale-4x4-large: clamp(0.45, 0.52, 0.60);
    --font-scale-4x4-mega: clamp(0.35, 0.43, 0.50);
    
    --font-scale-5x5-base: clamp(0.42, 0.48, 0.52);
    --font-scale-5x5-large: clamp(0.34, 0.39, 0.43);
    --font-scale-5x5-mega: clamp(0.27, 0.32, 0.35);
  }
  
  /* Tablet body - optimized vertical layout */
  body {
    min-height: 100vh;
    min-height: 100dvh;
    height: 100vh;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: env(safe-area-inset-top, 0px) env(safe-area-inset-right, 0px) env(safe-area-inset-bottom, 0px) env(safe-area-inset-left, 0px);
  }
  
  /* Tablet header - spacious and touch-friendly */
  header {
    height: var(--tablet-header-height);
    min-height: var(--tablet-header-height);
    padding: var(--tablet-padding);
    display: flex;
    align-items: center;
    flex-shrink: 0;
    background: rgba(26, 26, 26, 0.96);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 2px solid rgba(255, 204, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }
  
  header .container {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: none;
  }

  header h1 {
    font-size: clamp(1.6rem, 4vw, 2rem);
    margin: 0;
    color: var(--highlight-color);
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  /* Tablet controls - better touch targets */
  .controls {
    display: flex;
    gap: clamp(8px, 2vw, 16px);
    align-items: center;
    flex-wrap: wrap;
  }

  button {
    padding: clamp(12px, 2.5vw, 18px) clamp(16px, 3vw, 24px);
    font-size: clamp(13px, 2vw, 16px);
    min-width: clamp(48px, 10vw, 60px);
    min-height: clamp(48px, 10vw, 60px);
    border-radius: 10px;
    transition: all 0.3s ease;
    font-weight: 600;
    border: 2px solid rgba(255, 204, 0, 0.3);
  }

  button:hover, button:active {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 204, 0, 0.25);
    border-color: var(--highlight-color);
  }
  
  /* Main content - efficient vertical space usage */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: var(--tablet-padding);
    gap: var(--tablet-padding);
    min-height: 0;
    overflow: hidden;
  }

  /* Tablet score container - prominent but efficient */
  #score-container {
    width: 100%;
    max-width: min(90vw, 500px);
    height: var(--tablet-score-height);
    min-height: var(--tablet-score-height);
    font-size: clamp(1rem, 2.5vw, 1.2rem);
    padding: var(--tablet-padding);
    background: rgba(255, 255, 255, 0.07);
    border: 2px solid rgba(255, 204, 0, 0.35);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    margin: 0;
  }
  
  #score-container ul {
    display: flex;
    gap: clamp(16px, 4vw, 24px);
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
    width: 100%;
    flex-wrap: wrap;
  }
  
  #score-container li {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: clamp(0.9rem, 2.2vw, 1.1rem);
    color: rgba(255, 255, 255, 0.9);
    min-width: clamp(70px, 15vw, 90px);
    font-weight: 500;
  }

  #score-container span {
    font-size: clamp(1.2em, 3vw, 1.4em);
    font-weight: 800;
    color: var(--highlight-color);
    margin-top: 4px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }
  
  /* Game section - maximizes remaining space */
  .game-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 0;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
    backdrop-filter: none;
  }
  
  /* Tablet board sizing - optimal for portrait orientation */
  #board-container {
    width: min(
      calc(100vw - 2 * var(--tablet-padding)),
      calc(100vh - var(--tablet-header-height) - var(--tablet-score-height) - 3 * var(--tablet-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      480px
    );
    height: min(
      calc(100vw - 2 * var(--tablet-padding)),
      calc(100vh - var(--tablet-header-height) - var(--tablet-score-height) - 3 * var(--tablet-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      480px
    );
    max-width: min(
      calc(100vw - 2 * var(--tablet-padding)),
      calc(100vh - var(--tablet-header-height) - var(--tablet-score-height) - 3 * var(--tablet-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      480px
    );
    max-height: min(
      calc(100vw - 2 * var(--tablet-padding)),
      calc(100vh - var(--tablet-header-height) - var(--tablet-score-height) - 3 * var(--tablet-padding) - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px)),
      480px
    );
    margin: 0;
    flex-shrink: 0;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    border-radius: 16px;
  }
}

/* Tablet landscape and small desktops - ENHANCED LAYOUT TRANSITION */
@media (min-width: 769px) and (max-width: 1024px) {
  :root {
    /* Small desktop-optimized board sizes with better proportions */
    --base-board-size-3x3: min(min(55vw, 55svw), min(70vh, 70svh), 450px);
    --base-board-size-4x4: min(min(60vw, 60svw), min(75vh, 75svh), 520px);
    --base-board-size-5x5: min(min(65vw, 65svw), min(80vh, 80svh), 580px);
    
    --gap-base: clamp(8px, 1.2vmin, 14px);
    
    /* Small desktop layout variables */
    --small-desktop-padding: clamp(20px, 3vw, 30px);
    --small-desktop-header-height: clamp(80px, 8vh, 100px);
    --small-desktop-gap: clamp(16px, 2vh, 24px);
    
    /* Enhanced Font Scaling for Small Desktop/Tablet Landscape */
    --font-scale-4x4-base: clamp(0.58, 0.68, 0.78);
    --font-scale-4x4-large: clamp(0.48, 0.55, 0.63);
    --font-scale-4x4-mega: clamp(0.38, 0.46, 0.53);
    
    --font-scale-5x5-base: clamp(0.45, 0.50, 0.55);
    --font-scale-5x5-large: clamp(0.37, 0.42, 0.46);
    --font-scale-5x5-mega: clamp(0.30, 0.35, 0.38);
    
    --font-scale-7x7-base: clamp(0.32, 0.35, 0.39);
    --font-scale-7x7-large: clamp(0.26, 0.28, 0.32);
    --font-scale-7x7-mega: clamp(0.22, 0.26, 0.28);
  }
  
  /* Small desktop body - vertical layout with better proportions */
  body {
    min-height: 100vh;
    min-height: 100dvh;
    height: 100vh;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  /* Small desktop header - balanced height and spacing */
  header {
    height: var(--small-desktop-header-height);
    min-height: var(--small-desktop-header-height);
    padding: var(--small-desktop-padding);
    display: flex;
    align-items: center;
    flex-shrink: 0;
    background: rgba(26, 26, 26, 0.96);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 2px solid rgba(255, 204, 0, 0.3);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }
  
  header .container {
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    font-size: clamp(1.8rem, 3.5vw, 2.4rem);
    margin: 0;
    color: var(--highlight-color);
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  /* Small desktop navigation - improved interaction */
  .desktop-nav {
    display: block;
  }
  
  .controls {
    display: flex;
    gap: clamp(10px, 2vw, 16px);
    align-items: center;
    flex-wrap: wrap;
  }

  button {
    padding: clamp(14px, 2vw, 18px) clamp(18px, 2.5vw, 24px);
    font-size: clamp(14px, 1.5vw, 16px);
    min-width: clamp(52px, 8vw, 64px);
    min-height: clamp(52px, 8vw, 64px);
    border-radius: 12px;
    transition: all 0.3s ease;
    font-weight: 600;
    border: 2px solid rgba(255, 204, 0, 0.3);
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 204, 0, 0.25);
    border-color: var(--highlight-color);
  }
  
  /* Main content - efficient vertical arrangement */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: var(--small-desktop-padding);
    gap: var(--small-desktop-gap);
    min-height: 0;
    max-width: 900px;
    margin: 0 auto;
    width: 100%;
    overflow: hidden;
  }

  /* Small desktop score container - prominent display */
  #score-container {
    width: 100%;
    max-width: 700px;
    height: auto;
    min-height: clamp(65px, 8vh, 80px);
    font-size: clamp(1rem, 1.8vw, 1.3rem);
    padding: clamp(16px, 2.5vw, 20px);
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 204, 0, 0.4);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    margin: 0;
  }

  #score-container ul {
    display: flex;
    gap: clamp(20px, 4vw, 32px);
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
    width: 100%;
    flex-wrap: wrap;
  }
  
  #score-container li {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: clamp(0.9rem, 1.5vw, 1.1rem);
    color: rgba(255, 255, 255, 0.9);
    min-width: clamp(80px, 12vw, 110px);
    font-weight: 500;
  }

  #score-container span {
    font-size: clamp(1.3em, 2vw, 1.5em);
    font-weight: 800;
    color: var(--highlight-color);
    margin-top: 4px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }
  
  /* Game section - optimal board positioning */
  .game-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 350px;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
    backdrop-filter: none;
  }

  /* Small desktop board sizing - balanced for screen size */
  #board-container {
    width: min(
      calc(100vw - 2 * var(--small-desktop-padding)),
      calc(100vh - var(--small-desktop-header-height) - var(--small-desktop-gap) * 3 - 85px), /* Account for score container */
      520px
    );
    height: min(
      calc(100vw - 2 * var(--small-desktop-padding)),
      calc(100vh - var(--small-desktop-header-height) - var(--small-desktop-gap) * 3 - 85px), /* Account for score container */
      520px
    );
    max-width: min(
      calc(100vw - 2 * var(--small-desktop-padding)),
      calc(100vh - var(--small-desktop-header-height) - var(--small-desktop-gap) * 3 - 85px), /* Account for score container */
      520px
    );
    max-height: min(
      calc(100vw - 2 * var(--small-desktop-padding)),
      calc(100vh - var(--small-desktop-header-height) - var(--small-desktop-gap) * 3 - 85px), /* Account for score container */
      520px
    );
    margin: 0;
    flex-shrink: 0;
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
    border-radius: 16px;
  }
}

/* Large desktops - ENHANCED DESKTOP LAYOUT WITH OPTIMAL SPACE USAGE */
@media (min-width: 1025px) {
  :root {
    /* Desktop-optimized board sizes with better aspect ratio handling */
    --base-board-size-3x3: min(min(45vw, 45svw), min(65vh, 65svh), 500px);
    --base-board-size-4x4: min(min(50vw, 50svw), min(70vh, 70svh), 560px);
    --base-board-size-5x5: min(min(55vw, 55svw), min(75vh, 75svh), 620px);
    
    --gap-base: clamp(10px, 1.5vmin, 16px);
    
    /* Enhanced Font Scaling for Large Desktop - Maximum Readability */
    --font-scale-3x3-base: clamp(0.80, 0.90, 1.00);
    --font-scale-3x3-large: clamp(0.70, 0.75, 0.80);
    --font-scale-3x3-mega: clamp(0.55, 0.62, 0.70);
    
    --font-scale-4x4-base: clamp(0.70, 0.80, 0.90);
    --font-scale-4x4-large: clamp(0.60, 0.67, 0.75);
    --font-scale-4x4-mega: clamp(0.50, 0.58, 0.65);
    
    --font-scale-5x5-base: clamp(0.55, 0.62, 0.68);
    --font-scale-5x5-large: clamp(0.47, 0.52, 0.57);
    --font-scale-5x5-mega: clamp(0.40, 0.46, 0.50);
    
    --font-scale-7x7-base: clamp(0.42, 0.47, 0.52);
    --font-scale-7x7-large: clamp(0.36, 0.40, 0.45);
    --font-scale-7x7-mega: clamp(0.32, 0.36, 0.40);
    
    --font-scale-9x9-base: clamp(0.36, 0.40, 0.45);
    --font-scale-9x9-large: clamp(0.32, 0.35, 0.39);
    --font-scale-9x9-mega: clamp(0.28, 0.32, 0.35);
    
    /* Desktop-specific layout variables for optimal space usage */
    --desktop-header-height: clamp(80px, 8vh, 100px);
    --desktop-score-width: clamp(280px, 25vw, 350px);
    --desktop-content-gap: clamp(20px, 3vw, 40px);
    --desktop-padding: clamp(20px, 3vw, 40px);
  }
  
  /* Desktop body - enhanced horizontal layout capability */
  body {
    min-height: 100vh;
    min-height: 100dvh;
    height: 100vh;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }
  
  /* Desktop header - streamlined and efficient */
  header {
    height: var(--desktop-header-height);
    min-height: var(--desktop-header-height);
    padding: var(--desktop-padding);
    display: flex;
    align-items: center;
    flex-shrink: 0;
    background: rgba(26, 26, 26, 0.96);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-bottom: 2px solid rgba(255, 204, 0, 0.3);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    z-index: 10;
  }
  
  header .container {
    width: 100%;
    max-width: none;
    margin: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    font-size: clamp(1.8rem, 3vw, 2.5rem);
    margin: 0;
    color: var(--highlight-color);
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  /* Desktop navigation - enhanced spacing and interaction */
  .desktop-nav {
    display: block;
  }
  
  .controls {
    display: flex;
    gap: clamp(8px, 1.5vw, 16px);
    align-items: center;
    flex-wrap: wrap;
  }

  button {
    padding: clamp(12px, 1.5vw, 18px) clamp(16px, 2vw, 24px);
    font-size: clamp(14px, 1.2vw, 16px);
    min-width: clamp(48px, 6vw, 60px);
    min-height: clamp(48px, 6vw, 60px);
    border-radius: 12px;
    transition: all 0.3s ease;
    font-weight: 600;
    border: 2px solid rgba(255, 204, 0, 0.3);
  }

  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 204, 0, 0.25);
    border-color: var(--highlight-color);
  }
  
  /* Main content - HORIZONTAL LAYOUT for better desktop space utilization */
  main {
    flex: 1;
    display: flex;
    flex-direction: row;
    align-items: stretch;
    justify-content: center;
    padding: var(--desktop-padding);
    gap: var(--desktop-content-gap);
    min-height: 0;
    overflow: hidden;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
    box-sizing: border-box;
  }

  /* Desktop score container - SIDEBAR layout for efficient space usage */
  #score-container {
    width: var(--desktop-score-width);
    min-width: var(--desktop-score-width);
    max-width: var(--desktop-score-width);
    height: auto;
    font-size: clamp(1rem, 1.1vw, 1.2rem);
    padding: clamp(16px, 2vw, 24px);
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 204, 0, 0.4);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    flex-shrink: 0;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    margin: 0;
    order: 2;
    align-self: flex-start;
    position: sticky;
    top: 0;
  }

  #score-container ul {
    display: flex;
    flex-direction: column;
    gap: clamp(16px, 2vh, 24px);
    justify-content: flex-start;
    align-items: stretch;
    margin: 0;
    padding: 0;
    width: 100%;
    flex-wrap: nowrap;
  }
  
  #score-container li {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    font-size: clamp(0.9rem, 1vw, 1.1rem);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    padding: clamp(8px, 1vh, 12px);
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 204, 0, 0.2);
  }

  #score-container span {
    font-size: clamp(1.2em, 1.3vw, 1.5em);
    font-weight: 800;
    color: var(--highlight-color);
    margin-top: 4px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  /* Game section - MAIN AREA with optimal board positioning */
  .game-section {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 400px;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
    backdrop-filter: none;
    order: 1;
    max-width: calc(100vw - var(--desktop-score-width) - 3 * var(--desktop-padding) - var(--desktop-content-gap));
  }

  /* Desktop board container - OPTIMIZED sizing for horizontal layout */
  #board-container {
    width: min(
      calc(100vw - var(--desktop-score-width) - 4 * var(--desktop-padding) - var(--desktop-content-gap)),
      calc(100vh - var(--desktop-header-height) - 2 * var(--desktop-padding)),
      600px
    );
    height: min(
      calc(100vw - var(--desktop-score-width) - 4 * var(--desktop-padding) - var(--desktop-content-gap)),
      calc(100vh - var(--desktop-header-height) - 2 * var(--desktop-padding)),
      600px
    );
    max-width: min(
      calc(100vw - var(--desktop-score-width) - 4 * var(--desktop-padding) - var(--desktop-content-gap)),
      calc(100vh - var(--desktop-header-height) - 2 * var(--desktop-padding)),
      600px
    );
    max-height: min(
      calc(100vw - var(--desktop-score-width) - 4 * var(--desktop-padding) - var(--desktop-content-gap)),
      calc(100vh - var(--desktop-header-height) - 2 * var(--desktop-padding)),
      600px
    );
    margin: 0;
    flex-shrink: 0;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    border-radius: 16px;
  }
}

/* Ultra-wide desktop screens */
@media (min-width: 1200px) {
  :root {
    /* Larger board sizes for big screens */
    --base-board-size-3x3: min(45vw, 55vh, 520px);
    --base-board-size-4x4: min(50vw, 60vh, 580px);
    --base-board-size-5x5: min(55vw, 65vh, 640px);
    
    /* Enhanced Font Scaling for Ultra-wide Displays */
    --font-scale-4x4-base: clamp(0.65, 0.75, 0.85);
    --font-scale-4x4-large: clamp(0.55, 0.62, 0.70);
    --font-scale-4x4-mega: clamp(0.45, 0.53, 0.60);
    
    --font-scale-5x5-base: clamp(0.53, 0.58, 0.63);
    --font-scale-5x5-large: clamp(0.45, 0.50, 0.53);
    --font-scale-5x5-mega: clamp(0.37, 0.43, 0.45);
  }
}

/* Landscape orientation optimizations */
@media (orientation: landscape) {
  /* Mobile landscape */
  @media (max-width: 768px) {
    :root {
      /* Optimize for landscape mobile - use height more than width */
      --base-board-size-3x3: min(60vh, 85vw, 350px);
      --base-board-size-4x4: min(70vh, 85vw, 400px);
      --base-board-size-5x5: min(75vh, 90vw, 450px);
    }
    
    main {
      flex-direction: row;
      align-items: flex-start;
      padding: 8px;
      gap: 15px;
    }
    
    header {
      flex: 0 0 auto;
      padding: 8px;
    }
    
    header h1 {
      font-size: clamp(1rem, 3vw, 1.4rem);
      margin-bottom: 4px;
    }
    
    .controls {
      flex-direction: column;
      gap: 4px;
      margin: 0;
    }
    
    #score-container {
      writing-mode: horizontal-tb;
      font-size: 0.8rem;
      padding: 6px;
    }
    
    #score-container ul {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
  }
}

/* Portrait orientation optimizations */
@media (orientation: portrait) {
  /* Ensure good use of vertical space in portrait */
  body {
    display: flex;
    flex-direction: column;
  }
  
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
}

/* High pixel density screens */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  /* Crisp rendering on retina displays */
  .tile {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  #board-container {
    border-width: 0.5px;
  }
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .tile {
    transition: none;
    animation: none;
  }
  
  #board-container {
    transition: none;
  }
  
  @keyframes appear {
    from { opacity: 1; transform: scale(1); }
    to { opacity: 1; transform: scale(1); }
  }
  
  @keyframes pop {
    from { transform: scale(1); }
    to { transform: scale(1); }
  }
}

/* Additional ultra-small screen optimizations */
@media (max-width: 360px) {
  :root {
    --mobile-button-size: 38px;
  }
  
  header h1 {
    font-size: clamp(1.2rem, 4vw, 1.6rem);
  }
  
  button {
    padding: 6px 8px;
    font-size: 12px;
  }
}

/* Landscape orientation adjustments for mobile */
@media screen and (orientation: landscape) and (max-height: 500px) {
  .board-size-3 {
    --base-board-size: min(65vh, 65vw, 380px);
    --board-max-size: min(65vh, 65vw, 380px);
  }
  
  .board-size-4 {
    --base-board-size: min(70vh, 70vw, 420px);
    --board-max-size: min(70vh, 70vw, 420px);
  }
  
  .board-size-5 {
    --base-board-size: min(75vh, 75vw, 460px);
    --board-max-size: min(75vh, 75vw, 460px);
  }
  
  .board-size-7 {
    --base-board-size: min(78vh, 78vw, 500px);
    --board-max-size: min(78vh, 78vw, 500px);
  }
  
  .board-size-9 {
    --base-board-size: min(82vh, 82vw, 540px);
    --board-max-size: min(82vh, 82vw, 540px);
  }
  
  body {
    justify-content: center;
  }
  
  header {
    padding: 8px 15px;
  }
  
  header h1 {
    font-size: 1.5rem;
    margin-bottom: 5px;
  }
  
  main {
    padding: 8px;
  }
}

/* Grid size specific optimizations */
:root[style*="--size: 3"] {
  --gap: var(--grid-3-gap);
}

:root[style*="--size: 4"] {
  --gap: var(--grid-4-gap);
}

:root[style*="--size: 5"] {
  --gap: var(--grid-5-gap);
}

/* 3x3 Grid Optimizations - Larger tiles, better spacing */
.board-size-3 {
  --gap-multiplier: 1.5;
  --base-board-size: min(75vw, 75vh, 420px);
  --board-max-size: min(75vw, 75vh, 420px);
  --font-scale-base: 0.5;
  --font-scale-large: 0.4;
  --font-scale-mega: 0.32;
}

/* 4x4 Grid Optimizations (default) - Balanced sizing */
.board-size-4 {
  --gap-multiplier: 1;
  --base-board-size: min(85vw, 85vh, 500px);
  --board-max-size: min(85vw, 85vh, 500px);
  --font-scale-base: 0.35;
  --font-scale-large: 0.28;
  --font-scale-mega: 0.22;
}

/* 5x5 Grid Optimizations - Compact tiles, tighter spacing */
.board-size-5 {
  --gap-multiplier: 0.8;
  --base-board-size: min(92vw, 92vh, 540px);
  --board-max-size: min(92vw, 92vh, 540px);
  --font-scale-base: 0.3;
  --font-scale-large: 0.24;
  --font-scale-mega: 0.18;
}

/* 7x7 Grid Optimizations - Very compact tiles, minimal spacing */
.board-size-7 {
  --gap-multiplier: 0.5;
  --base-board-size: min(94vw, 94vh, 580px);
  --board-max-size: min(94vw, 94vh, 580px);
  --font-scale-base: 0.2;
  --font-scale-large: 0.16;
  --font-scale-mega: 0.12;
}

/* 9x9 Grid Optimizations - Ultra compact tiles, minimal spacing */
.board-size-9 {
  --gap-multiplier: 0.3;
  --base-board-size: min(96vw, 96vh, 620px);
  --board-max-size: min(96vw, 96vh, 620px);
  --font-scale-base: 0.16;
  --font-scale-large: 0.12;
  --font-scale-mega: 0.10;
}

/* Special handling for very small screens - consolidated with main mobile section above */

/* Landscape orientation adjustments for mobile */
@media (max-height: 600px) and (orientation: landscape) {
  :root {
    --board-max-size: min(70vh, 70vw, 350px);
  }
  
  header {
    padding: 10px;
  }
}
  
/* Mobile responsive adjustments for board sizes */
@media (max-width: 480px) {
  /* Hide desktop navigation on mobile */
  .desktop-nav {
    display: none;
  }
  
  .board-size-3 {
    --base-board-size: min(90vw, 85vh, 320px);
    --board-max-size: min(90vw, 85vh, 320px);
    --font-scale-base: 0.45;
    --font-scale-large: 0.36;
    --font-scale-mega: 0.28;
  }
  
  .board-size-4 {
    --base-board-size: min(92vw, 85vh, 340px);
    --board-max-size: min(92vw, 85vh, 340px);
    --font-scale-base: 0.32;
    --font-scale-large: 0.26;
    --font-scale-mega: 0.2;
  }
  
  .board-size-5 {
    --base-board-size: min(95vw, 85vh, 360px);
    --board-max-size: min(95vw, 85vh, 360px);
    --font-scale-base: 0.28;
    --font-scale-large: 0.22;
    --font-scale-mega: 0.16;
  }
  
  .board-size-7 {
    --base-board-size: min(96vw, 85vh, 400px);
    --board-max-size: min(96vw, 85vh, 400px);
    --font-scale-base: 0.18;
    --font-scale-large: 0.14;
    --font-scale-mega: 0.12;
  }
  
  .board-size-9 {
    --base-board-size: min(98vw, 85vh, 440px);
    --board-max-size: min(98vw, 85vh, 440px);
    --font-scale-base: 0.14;
    --font-scale-large: 0.11;
    --font-scale-mega: 0.09;
  }
  
  header h1 {
    font-size: 1.5rem;
    margin-bottom: 10px;
  }
  
  main {
    padding: 10px;
  }
  
  #score-container {
    margin-bottom: 10px;
  }
}

/* Ultra-wide screens */
@media (min-width: 1200px) {
  :root {
    --board-max-size: min(60vw, 60vh, 600px);
  }
}

/* High DPI display optimizations */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  button {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }
  
  .tile {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Pause Overlay Styles */
.pause-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  color: var(--secondary-color);
}

.pause-content {
  text-align: center;
  padding: 2rem;
  background: rgba(50, 50, 50, 0.9);
  border-radius: var(--tile-border-radius);
  border: 1px solid rgba(255, 255, 255, 0.2);
  max-width: 400px;
  width: 90%;
}

.pause-icon {
  font-size: 3rem;
  color: var(--highlight-color);
  margin-bottom: 1rem;
}

.pause-content h2 {
  color: var(--highlight-color);
  margin-bottom: 1rem;
}

.pause-content p {
  margin-bottom: 1.5rem;
  opacity: 0.9;
}

.resume-btn {
  background: var(--highlight-color);
  color: var(--primary-color);
  border: none;
  padding: 0.8rem 2rem;
  border-radius: var(--tile-border-radius);
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.resume-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 204, 0, 0.3);
}

/* Score Popup Animation */
.score-popup {
  position: fixed;
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--highlight-color);
  pointer-events: none;
  z-index: 100;
  animation: score-popup 1s ease-out forwards;
}

@keyframes score-popup {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateY(-50px);
  }
}

/* Color Change Ripple Effect */
.color-change-ripple {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: 100;
}

/* Swipe Indicator */
.swipe-indicator {
  position: fixed;
  font-size: 2rem;
  pointer-events: none;
  z-index: 100;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  body:not(.light-mode) {
    --primary-color: #0a0a0a;
    --secondary-color: #ffffff;
  }
}

/* Light mode adjustments */
@media (prefers-color-scheme: light) {
  body.light-mode {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  }
}

/* Game Over Styles */
#game-over {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  color: white;
  font-size: 2rem;
  font-weight: bold;
}

.hidden {
  display: none !important;
}

/* Footer Styles */
footer {
  margin-top: auto;
  padding: 20px;
  text-align: center;
}

footer button {
  background: var(--button-background);
  color: var(--secondary-color);
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  transition: all var(--transition-duration);
}

footer button:hover {
  background: var(--button-hover-background);
  transform: translateY(-2px);
}

/* Responsive Design */
@media (max-width: 480px) {
  :root {
    --gap: clamp(1px, 1vmin, 4px);
    --board-max-size: min(95vw, 95vh, 400px);
    --mobile-button-size: 40px;
  }
  
  header h1 {
    font-size: clamp(1.5rem, 6vw, 2.5rem);
  }
  
  .controls button {
    width: 40px;
    height: 40px;
    font-size: 0.8rem;
    margin: 2px;
  }
  
  .tile {
    font-size: clamp(0.7rem, 3vmin, 1.2rem) !important;
  }
}

@media (max-width: 768px) {
  :root {
    --board-max-size: min(90vw, 90vh, 450px);
  }
  
  #controls-container {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .controls button {
    margin: 3px;
  }
}

@media (min-width: 1200px) {
  :root {
    --board-max-size: min(80vw, 80vh, 600px);
  }
  
  body {
    padding: 40px 20px;
  }
  
  header {
    padding: 30px 0;
  }
}

/* Print styles */
@media print {
  header nav,
  footer {
    display: none;
  }
  
  body {
    background: white;
    color: black;
  }
}

/* High DPI displays */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .tile {
    border: 0.5px solid rgba(255, 255, 255, 0.1);
  }
}

/* Mobile Toast Messages */
.mobile-pause-toast,
.pause-reminder-toast,
.restoration-toast {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  font-weight: 500;
  letter-spacing: 0.3px;
  user-select: none;
  pointer-events: auto;
  cursor: pointer;
}

/* Enhanced Mobile Resume Toast */
.mobile-pause-toast.enhanced-resume {
  cursor: default;
  min-width: 300px;
  max-width: calc(100vw - 40px);
}

.toast-content-enhanced {
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: space-between;
  width: 100%;
}

.toast-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  flex-shrink: 0;
}

.toast-icon i {
  font-size: 16px;
  color: #ffa726;
}

.toast-text {
  display: flex;
  flex-direction: column;
  flex: 1;
  gap: 2px;
}

.toast-title {
  font-size: 14px;
  font-weight: 600;
  color: #ffffff;
  line-height: 1.2;
}

.toast-subtitle {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.8);
  line-height: 1.2;
}

.mobile-resume-btn {
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
  color: white;
  border: none;
  border-radius: 20px;
  padding: 8px 16px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
  flex-shrink: 0;
  min-width: 70px;
  justify-content: center;
}

.mobile-resume-btn:hover {
  background: linear-gradient(135deg, #45a049 0%, #4CAF50 100%);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
}

.mobile-resume-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(76, 175, 80, 0.3);
}

.mobile-resume-btn i {
  font-size: 12px;
  margin: 0;
}

/* Enhanced User Pause Toast */
.pause-reminder-toast.enhanced-user-pause {
  cursor: default;
}

.pause-reminder-toast.enhanced-user-pause .toast-icon i {
  color: #ff9800;
}

.mobile-pause-toast:active,
.pause-reminder-toast:active {
  transform: translateX(-50%) scale(0.95) !important;
}

.toast-content {
  display: flex;
  align-items: center;
  gap: 8px;
}

.toast-content i {
  flex-shrink: 0;
  opacity: 0.9;
}

/* Mobile Game Over/Win Messages */
.mobile-game-over,
.mobile-win-message {
  background: rgba(0, 0, 0, 0.95);
  border-radius: 20px;
  padding: 30px 25px;
  text-align: center;
  max-width: 300px;
  width: 90%;
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.mobile-game-over .game-over-icon,
.mobile-win-message .win-icon {
  font-size: 3rem;
  margin-bottom: 15px;
  display: block;
}

.mobile-game-over h3,
.mobile-win-message h3 {
  color: var(--highlight-color);
  margin: 0 0 10px 0;
  font-size: 1.5rem;
  font-weight: 600;
}

.mobile-game-over p,
.mobile-win-message p {
  color: rgba(255, 255, 255, 0.8);
  margin: 0 0 20px 0;
  font-size: 0.95rem;
}

.final-stats {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
}

.final-stats .stat {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.9);
}

.button-row,
.win-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.compact-btn {
  padding: 12px 18px;
  border: none;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s ease;
}

.compact-btn.primary {
  background: linear-gradient(45deg, var(--highlight-color), #e6b800);
  color: var(--primary-color);
}

.compact-btn.secondary {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.compact-btn:active {
  transform: scale(0.95);
}

/* Toast Animations */
@keyframes slideInTop {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

@keyframes slideOutTop {
  from {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  to {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
}

@keyframes pulseIn {
  from {
    opacity: 0;
    transform: translateX(-50%) scale(0.8);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) scale(1);
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

@keyframes slideOutUp {
  from {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  to {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
}

/* Mobile-specific responsive adjustments */
@media (max-width: 480px) {
  .mobile-game-over,
  .mobile-win-message {
    padding: 25px 20px;
    max-width: 280px;
  }
  
  .compact-btn {
    padding: 10px 14px;
    font-size: 0.85rem;
  }
  
  .mobile-pause-toast,
  .pause-reminder-toast,
  .restoration-toast {
    font-size: 13px;
    padding: 10px 16px;
  }
}

/* Ensure toasts work well in landscape mobile */
@media (max-height: 500px) and (orientation: landscape) {
  .mobile-pause-toast {
    top: 10px;
  }
  
  .pause-reminder-toast {
    bottom: 60px;
  }
}

/* Enhanced notification system for user feedback */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 10000;
  padding: 12px 20px;
  border-radius: 8px;
  color: white;
  font-weight: bold;
  max-width: 300px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOutRight {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

/* ============================================
   Advanced Performance & Accessibility Optimizations
   ============================================ */

/* Enhanced High Contrast Mode Support */
@media (prefers-contrast: high) {
  :root {
    --primary-color: #000000;
    --text-primary: #ffffff;
    --text-secondary: #ffffff;
    --highlight-color: #ffff00;
    --board-bg: #000000;
    --tile-bg: #333333;
    --background: #000000;
    --overlay-dark: rgba(0, 0, 0, 0.95);
  }
  
  .tile {
    border: 2px solid #ffffff !important;
    font-weight: 900 !important;
    text-shadow: none !important;
  }
  
  button {
    border: 2px solid #ffffff !important;
    font-weight: 700 !important;
  }
}

/* Enhanced Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    transition-delay: 0ms !important;
  }
  
  .tile {
    transform: none !important;
  }
  
  #board-container {
    transform: none !important;
  }
}

/* Advanced Focus Management */
.focus-trap {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Enhanced Error State Styling */
.game-error {
  background: linear-gradient(135deg, #ff6b6b, #ee5a52);
  color: white;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 8px 32px rgba(255, 107, 107, 0.3);
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.game-error h3 {
  margin: 0 0 10px 0;
  font-size: 1.3rem;
}

.game-error button {
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 15px;
  transition: all 0.3s ease;
}

.game-error button:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

/* Loading State Improvements */
.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 200px;
  font-size: 1.1rem;
  color: var(--text-secondary);
}

.loading-spinner {
  width: 32px;
  height: 32px;
  border: 3px solid rgba(255, 204, 0, 0.3);
  border-top: 3px solid var(--highlight-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 12px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Enhanced Performance Mode */
.performance-mode {
  --animation-duration: 0.1s;
  --transition-duration: 0.1s;
}

.performance-mode * {
  animation-duration: var(--animation-duration) !important;
  transition-duration: var(--transition-duration) !important;
}

/* Advanced Color Scheme Support */
@media (prefers-color-scheme: dark) {
  body:not(.light-mode) {
    --text-primary: #f8f9fa;
    --text-secondary: #e9ecef;
    --board-bg: #1a1a1a;
    --tile-bg: #2d3748;
    --background: #121212;
  }
}

@media (prefers-color-scheme: light) {
  body.light-mode {
    --text-primary: #2d3748;
    --text-secondary: #4a5568;
    --board-bg: #f7fafc;
    --tile-bg: #edf2f7;
    --background: #ffffff;
  }
}

/* Enhanced Print Styles */
@media print {
  body {
    background: white !important;
    color: black !important;
  }
  
  button {
    display: none !important;
  }
  
  #board-container {
    border: 2px solid black;
    page-break-inside: avoid;
  }
  
  .tile {
    border: 1px solid black !important;
    color: black !important;
    background: white !important;
  }
  
  #score-container {
    border: 1px solid black;
    background: white;
    color: black;
  }
}

/* Memory-Efficient Animations */
.tile-appear {
  animation: tileAppear 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  will-change: transform, opacity;
}

.tile-merge {
  animation: tileMerge 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  will-change: transform;
}

.tile-slide {
  transition: transform 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  will-change: transform;
}

/* Remove will-change after animations */
.tile:not(.animating) {
  will-change: auto;
}

@keyframes tileAppear {
  0% {
    opacity: 0;
    transform: scale(0);
  }
  50% {
    opacity: 0.5;
    transform: scale(1.1);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes tileMerge {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

/* Enhanced Safe Area Support with Custom Properties */
@supports (padding-top: env(safe-area-inset-top)) {
  .safe-area-aware {
    padding-top: max(8px, env(safe-area-inset-top));
    padding-left: max(8px, env(safe-area-inset-left));
    padding-right: max(8px, env(safe-area-inset-right));
    padding-bottom: max(8px, env(safe-area-inset-bottom));
  }
}

/* Advanced Container Queries (Future-Proof) */
@supports (container-type: inline-size) {
  #board-container {
    container-type: inline-size;
  }
  
  @container (max-width: 300px) {
    .tile {
      font-size: 0.8rem;
    }
  }
  
  @container (min-width: 500px) {
    .tile {
      font-size: 1.2rem;
    }
  }
}

/* Enhanced Mobile Menu and Navigation Visibility Controls */

/* Show navigation on all screen sizes - no more hamburger menu */
@media (max-width: 768px) {
  .desktop-nav {
    display: block !important;
  }
}

/* Desktop navigation always visible */
@media (min-width: 769px) {
  .desktop-nav {
    display: block !important;
  }
}

/* ============================================
   Enhanced Accessibility and Visibility Fixes
   ============================================ */

/* Ensure proper contrast and visibility for all text elements */
.tile {
  /* Enhanced text visibility with stronger contrast */
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7), 
               0 0 1px rgba(0, 0, 0, 0.8);
  font-weight: 900;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Improved visibility for score elements */
#score-container span {
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  font-weight: 800;
}

/* Enhanced button visibility and accessibility */
button {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 204, 0, 0.4);
  font-weight: 600;
  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}

button:hover {
  box-shadow: 0 4px 12px rgba(255, 204, 0, 0.3);
  border-color: var(--highlight-color);
}

/* ============================================
   Safe Area and Modern Device Support  
   ============================================ */

/* Enhanced safe area support for all modern devices */
@supports (padding: env(safe-area-inset-top)) {
  body {
    padding-top: max(env(safe-area-inset-top), 8px);
    padding-left: max(env(safe-area-inset-left), 0px);
    padding-right: max(env(safe-area-inset-right), 0px);
    padding-bottom: max(env(safe-area-inset-bottom), 8px);
  }
  
  @media (max-width: 480px) {
    header {
      padding-top: max(8px, env(safe-area-inset-top) + 8px);
    }
  }
}

/* High-DPI display optimizations for Retina and 4K screens */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .tile {
    /* Enhanced text rendering for high-DPI displays */
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-weight: 900; /* Even bolder on high-DPI for crisp text */
  }
  
  /* Slightly increase font scaling on high-DPI for better readability */
  :root {
    --font-scale-base: calc(var(--font-scale-base) * 1.05);
    --font-scale-large: calc(var(--font-scale-large) * 1.05);
    --font-scale-mega: calc(var(--font-scale-mega) * 1.05);
  }
}

/* Very large 4K+ displays */
@media (min-width: 1920px) {
  :root {
    /* Maximum accessibility font scaling for 4K+ displays */
    --font-scale-4x4-base: clamp(0.70, 0.80, 0.90);
    --font-scale-4x4-large: clamp(0.60, 0.67, 0.75);
    --font-scale-4x4-mega: clamp(0.50, 0.58, 0.65);
    
    --font-scale-5x5-base: clamp(0.58, 0.63, 0.68);
    --font-scale-5x5-large: clamp(0.50, 0.55, 0.58);
    --font-scale-5x5-mega: clamp(0.42, 0.48, 0.50);
    
    --font-scale-7x7-base: clamp(0.45, 0.48, 0.52);
    --font-scale-7x7-large: clamp(0.39, 0.41, 0.45);
    --font-scale-7x7-mega: clamp(0.35, 0.39, 0.41);
    
    --font-scale-9x9-base: clamp(0.36, 0.38, 0.42);
    --font-scale-9x9-large: clamp(0.32, 0.33, 0.36);
    --font-scale-9x9-mega: clamp(0.28, 0.31, 0.32);
  }
}
