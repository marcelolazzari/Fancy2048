<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Console Test - Fancy2048</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: #fff; 
            padding: 20px; 
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #333;
        }
        .pass { border-left-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
        .fail { border-left-color: #f44336; background: rgba(244, 67, 54, 0.1); }
        .warning { border-left-color: #ff9800; background: rgba(255, 152, 0, 0.1); }
        .info { border-left-color: #2196F3; background: rgba(33, 150, 243, 0.1); }
        button {
            background: #ff9900;
            border: none;
            padding: 12px 24px;
            color: white;
            border-radius: 8px;
            margin: 10px 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover { background: #ffb300; }
        .hidden { display: none; }
        .summary {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffcc00;
        }
        .count {
            font-size: 24px;
            font-weight: bold;
            color: #ffcc00;
        }
    </style>
</head>
<body>
    <h1>üêõ Fixed Console Errors Test - Fancy2048</h1>
    <p>Testing the fixes for console errors in the GitHub Pages deployment.</p>
    
    <button onclick="testLocalhost()">üè† Test Localhost Paths</button>
    <button onclick="testGitHubPages()">üåê Test GitHub Pages Paths</button>
    <button onclick="testAllFeatures()">üß™ Test All Features</button>
    <button onclick="clearResults()">üóëÔ∏è Clear Results</button>
    
    <div id="summary" class="summary hidden">
        <h2>Test Summary</h2>
        <div>Errors: <span id="errorCount" class="count">0</span></div>
        <div>Warnings: <span id="warningCount" class="count">0</span></div>
        <div>Successes: <span id="successCount" class="count">0</span></div>
        <div>Info: <span id="infoCount" class="count">0</span></div>
    </div>
    
    <div id="test-results"></div>
    
    <!-- Hidden game elements for testing -->
    <div class="hidden">
        <div id="score-container"><ul><li>Score: <span id="score">0</span></li></ul></div>
        <div id="board-container"></div>
        <div id="best-score">0</div>
        <div id="moves">0</div>
        <div id="time">00:00</div>
        <button id="reset-button">Reset</button>
        <button id="ai-play-button">AI Play</button>
    </div>

    <script>
        const results = document.getElementById('test-results');
        let errorCount = 0;
        let warningCount = 0;
        let successCount = 0;
        let infoCount = 0;
        
        function updateSummary() {
            document.getElementById('errorCount').textContent = errorCount;
            document.getElementById('warningCount').textContent = warningCount;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('infoCount').textContent = infoCount;
            document.getElementById('summary').classList.remove('hidden');
        }
        
        function log(type, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            results.appendChild(div);
            
            switch(type) {
                case 'fail': errorCount++; break;
                case 'warning': warningCount++; break;
                case 'pass': successCount++; break;
                case 'info': infoCount++; break;
            }
            updateSummary();
        }
        
        function clearResults() {
            results.innerHTML = '';
            errorCount = warningCount = successCount = infoCount = 0;
            document.getElementById('summary').classList.add('hidden');
        }
        
        // Override console methods to capture output
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;
        
        console.error = function(...args) {
            log('fail', args.join(' '));
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            log('warning', args.join(' '));
            originalWarn.apply(console, args);
        };
        
        console.log = function(...args) {
            if (args[0] && (args[0].includes('‚úÖ') || args[0].includes('üéÆ') || args[0].includes('üöÄ'))) {
                log('pass', args.join(' '));
            } else {
                log('info', args.join(' '));
            }
            originalLog.apply(console, args);
        };
        
        // Global error handler
        window.addEventListener('error', (event) => {
            log('fail', `JavaScript Error: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`);
        });
        
        // Promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
            log('fail', `Unhandled Promise Rejection: ${event.reason}`);
        });
        
        function testLocalhost() {
            clearResults();
            log('info', 'üè† Testing localhost environment...');
            testEnvironment(false);
        }
        
        function testGitHubPages() {
            clearResults();
            log('info', 'üåê Testing GitHub Pages environment...');
            testEnvironment(true);
        }
        
        async function testEnvironment(simulateGitHubPages) {
            // Mock the hostname for testing
            const originalLocation = window.location;
            if (simulateGitHubPages) {
                Object.defineProperty(window, 'location', {
                    value: { ...originalLocation, hostname: 'marcelolazzari.github.io' },
                    writable: true
                });
            }
            
            try {
                // Test path detection
                const isGitHubPages = window.location.hostname.includes('github.io');
                const basePath = isGitHubPages ? '/Fancy2048' : '..';
                
                log('pass', `‚úÖ Environment detected: ${isGitHubPages ? 'GitHub Pages' : 'Local'}`);
                log('pass', `‚úÖ Base path calculated: ${basePath}`);
                
                // Test localStorage functionality
                try {
                    if (typeof Storage !== 'undefined') {
                        localStorage.setItem('test', 'value');
                        const value = localStorage.getItem('test');
                        if (value === 'value') {
                            log('pass', '‚úÖ localStorage is working');
                            localStorage.removeItem('test');
                        } else {
                            log('warning', '‚ö†Ô∏è localStorage read/write issue');
                        }
                    } else {
                        log('warning', '‚ö†Ô∏è localStorage not available');
                    }
                } catch (error) {
                    log('warning', `‚ö†Ô∏è localStorage error: ${error.message}`);
                }
                
                // Test DOM elements
                const requiredElements = ['board-container', 'score-container', 'score', 'best-score', 'moves', 'time'];
                requiredElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        log('pass', `‚úÖ DOM element found: ${id}`);
                    } else {
                        log('fail', `‚ùå Missing DOM element: ${id}`);
                    }
                });
                
                // Test script loading paths
                const scripts = [
                    `${basePath}/scripts/ai_learning_system.js`,
                    `${basePath}/scripts/advanced_ai_solver.js`, 
                    `${basePath}/scripts/enhanced_ai.js`,
                    `${basePath}/scripts/game.js`
                ];
                
                for (const src of scripts) {
                    await testScriptPath(src);
                }
                
            } finally {
                // Restore original location
                Object.defineProperty(window, 'location', {
                    value: originalLocation,
                    writable: true
                });
            }
        }
        
        async function testScriptPath(src) {
            return new Promise((resolve) => {
                fetch(src, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            log('pass', `‚úÖ Script path accessible: ${src}`);
                        } else {
                            log('fail', `‚ùå Script path not accessible (${response.status}): ${src}`);
                        }
                        resolve();
                    })
                    .catch(error => {
                        log('fail', `‚ùå Script path failed: ${src} - ${error.message}`);
                        resolve();
                    });
            });
        }
        
        async function testAllFeatures() {
            clearResults();
            log('info', 'üß™ Testing all features...');
            
            // Test both environments
            await testEnvironment(false);
            await testEnvironment(true);
            
            // Test error handling features
            log('info', 'Testing error handling improvements...');
            
            try {
                // Test safeStorage (simulated)
                const testStorage = {
                    getItem(key, defaultValue = null) {
                        try {
                            return localStorage.getItem(key) || defaultValue;
                        } catch (error) {
                            return defaultValue;
                        }
                    },
                    setItem(key, value) {
                        try {
                            localStorage.setItem(key, value);
                            return true;
                        } catch (error) {
                            return false;
                        }
                    }
                };
                
                const result1 = testStorage.getItem('nonexistent', 'default');
                if (result1 === 'default') {
                    log('pass', '‚úÖ Safe storage getItem with default works');
                } else {
                    log('fail', '‚ùå Safe storage getItem with default failed');
                }
                
                const result2 = testStorage.setItem('test', 'value');
                if (result2) {
                    log('pass', '‚úÖ Safe storage setItem works');
                } else {
                    log('warning', '‚ö†Ô∏è Safe storage setItem failed (may be quota exceeded)');
                }
                
            } catch (error) {
                log('fail', `‚ùå Storage test failed: ${error.message}`);
            }
            
            log('info', 'Feature testing completed');
        }
        
        // Auto-run basic test when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('info', 'Page loaded, running basic environment detection...');
                const isGitHubPages = window.location.hostname.includes('github.io');
                log('info', `Current environment: ${isGitHubPages ? 'GitHub Pages' : 'Local'}`);
            }, 1000);
        });
    </script>
</body>
</html>
