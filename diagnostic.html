<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy2048 - GitHub Pages Diagnostic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #f2f2f2;
            line-height: 1.6;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .success { background: #2d5a2d; color: #4CAF50; }
        .error { background: #5a2d2d; color: #f44336; }
        .warning { background: #5a522d; color: #FF9800; }
        .info { background: #2d4a5a; color: #2196F3; }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #e6b800; }
    </style>
</head>
<body>
    <h1>üîß Fancy2048 - GitHub Pages Diagnostic</h1>
    
    <p>This page will help diagnose issues with the GitHub Pages deployment.</p>
    
    <div>
        <button onclick="runDiagnostic()">üöÄ Run Full Diagnostic</button>
        <button onclick="testScriptLoading()">üìù Test Script Loading</button>
        <button onclick="testGameInit()">üéÆ Test Game Initialization</button>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
    </div>
    
    <div id="status-container"></div>
    <div id="log" class="log">GitHub Pages Diagnostic Tool Ready...\n</div>
    
    <h2>Manual Tests</h2>
    <ul>
        <li><a href="pages/index.html">Main Game Page</a></li>
        <li><a href="pages/leaderboard.html">Statistics Page</a></li>
        <li><a href="scripts/game.js">Game Script (Direct)</a></li>
        <li><a href="scripts/advanced_ai_solver.js">Advanced AI Script</a></li>
        <li><a href="scripts/enhanced_ai.js">Enhanced AI Script</a></li>
        <li><a href="styles/unified_styles_fixed.css">Main CSS File</a></li>
    </ul>

    <script>
        let logText = '';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'success': '‚úÖ',
                'error': '‚ùå', 
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            };
            
            logText += `[${timestamp}] ${prefix[type]} ${message}\n`;
            document.getElementById('log').textContent = logText;
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
        }
        
        function clearLog() {
            logText = '';
            document.getElementById('log').textContent = '';
        }
        
        function addStatus(message, type) {
            const container = document.getElementById('status-container');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
        
        function runDiagnostic() {
            log('üöÄ Starting comprehensive GitHub Pages diagnostic...', 'info');
            clearStatus();
            
            // Test basic environment
            testEnvironment();
            
            // Test script availability
            setTimeout(() => testScriptLoading(), 100);
            
            // Test game initialization
            setTimeout(() => testGameInit(), 200);
            
            // Test file accessibility
            setTimeout(() => testFileAccess(), 300);
            
            log('üìã Diagnostic completed. Check results above.', 'success');
        }
        
        function clearStatus() {
            document.getElementById('status-container').innerHTML = '';
        }
        
        function testEnvironment() {
            log('Testing environment...', 'info');
            
            // Test current URL
            log(`Current URL: ${window.location.href}`, 'info');
            
            // Test if we're on GitHub Pages
            if (window.location.hostname.includes('github.io')) {
                log('‚úÖ Running on GitHub Pages', 'success');
                addStatus('‚úÖ GitHub Pages Environment Detected', 'success');
            } else {
                log('‚ö†Ô∏è Not on GitHub Pages', 'warning');
                addStatus('‚ö†Ô∏è Not on GitHub Pages', 'warning');
            }
            
            // Test basic JavaScript functionality
            try {
                const testObj = { test: true };
                if (testObj.test) {
                    log('‚úÖ JavaScript basics working', 'success');
                    addStatus('‚úÖ JavaScript Functional', 'success');
                }
            } catch (error) {
                log(`‚ùå JavaScript error: ${error.message}`, 'error');
                addStatus('‚ùå JavaScript Issues', 'error');
            }
            
            // Test local storage
            try {
                localStorage.setItem('test', '123');
                const test = localStorage.getItem('test');
                localStorage.removeItem('test');
                if (test === '123') {
                    log('‚úÖ LocalStorage working', 'success');
                    addStatus('‚úÖ LocalStorage Available', 'success');
                }
            } catch (error) {
                log(`‚ùå LocalStorage error: ${error.message}`, 'error');
                addStatus('‚ùå LocalStorage Issues', 'error');
            }
        }
        
        function testScriptLoading() {
            log('Testing script loading...', 'info');
            
            // Test for script classes
            const scripts = [
                { name: 'Game', class: 'Game', status: typeof Game !== 'undefined' },
                { name: 'AdvancedAI', class: 'AdvancedAI2048Solver', status: typeof AdvancedAI2048Solver !== 'undefined' },
                { name: 'EnhancedAI', class: 'Enhanced2048AI', status: typeof Enhanced2048AI !== 'undefined' }
            ];
            
            scripts.forEach(script => {
                if (script.status) {
                    log(`‚úÖ ${script.name} class loaded`, 'success');
                    addStatus(`‚úÖ ${script.name} Available`, 'success');
                } else {
                    log(`‚ùå ${script.name} class NOT loaded`, 'error');
                    addStatus(`‚ùå ${script.name} Missing`, 'error');
                }
            });
            
            // Test script tags in document
            const scriptTags = document.querySelectorAll('script[src]');
            log(`Found ${scriptTags.length} external script tags`, 'info');
            
            scriptTags.forEach((script, index) => {
                log(`Script ${index + 1}: ${script.src}`, 'info');
            });
        }
        
        function testGameInit() {
            log('Testing game initialization...', 'info');
            
            if (typeof Game === 'undefined') {
                log('‚ùå Cannot test game init - Game class not loaded', 'error');
                addStatus('‚ùå Game Class Not Available', 'error');
                return;
            }
            
            try {
                // Create a test game instance
                const testGame = new Game(4);
                log('‚úÖ Game instance created successfully', 'success');
                addStatus('‚úÖ Game Instance Creation OK', 'success');
                
                // Test if essential methods exist
                const methods = ['initializeUI', 'addRandomTile', 'move', 'reset', 'updateAutoPlayButton', 'debounce'];
                let missingMethods = [];
                
                methods.forEach(method => {
                    if (typeof testGame[method] === 'function') {
                        log(`‚úÖ Method ${method} exists`, 'success');
                    } else {
                        log(`‚ùå Method ${method} MISSING`, 'error');
                        missingMethods.push(method);
                    }
                });
                
                if (missingMethods.length === 0) {
                    addStatus('‚úÖ All Required Methods Present', 'success');
                } else {
                    addStatus(`‚ùå Missing Methods: ${missingMethods.join(', ')}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Game initialization failed: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
                addStatus('‚ùå Game Initialization Failed', 'error');
            }
        }
        
        function testFileAccess() {
            log('Testing file accessibility...', 'info');
            
            const filesToTest = [
                'scripts/game.js',
                'scripts/advanced_ai_solver.js', 
                'scripts/enhanced_ai.js',
                'styles/unified_styles_fixed.css'
            ];
            
            filesToTest.forEach(file => {
                fetch(file, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            log(`‚úÖ File accessible: ${file}`, 'success');
                        } else {
                            log(`‚ùå File not accessible: ${file} (${response.status})`, 'error');
                        }
                    })
                    .catch(error => {
                        log(`‚ùå Error accessing ${file}: ${error.message}`, 'error');
                    });
            });
        }
        
        // Capture any errors
        window.addEventListener('error', (event) => {
            log(`‚ùå Global error: ${event.error?.message || event.message}`, 'error');
            log(`File: ${event.filename}, Line: ${event.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            log(`‚ùå Unhandled promise rejection: ${event.reason}`, 'error');
        });
        
        // Auto-run basic diagnostic on load
        document.addEventListener('DOMContentLoaded', () => {
            log('üìã Diagnostic tool loaded', 'success');
            log('Click "Run Full Diagnostic" to begin testing', 'info');
        });
    </script>
    
    <!-- Try to load the actual game scripts to test them -->
    <script>
        // Log script loading attempts
        console.log('üîç Attempting to load game scripts...');
    </script>
    
    <script src="scripts/advanced_ai_solver.js" 
            onload="console.log('‚úÖ advanced_ai_solver.js loaded')" 
            onerror="console.error('‚ùå Failed to load advanced_ai_solver.js')"></script>
            
    <script src="scripts/enhanced_ai.js" 
            onload="console.log('‚úÖ enhanced_ai.js loaded')" 
            onerror="console.error('‚ùå Failed to load enhanced_ai.js')"></script>
            
    <script src="scripts/game.js" 
            onload="console.log('‚úÖ game.js loaded')" 
            onerror="console.error('‚ùå Failed to load game.js')"></script>
    
    <script>
        // Final verification
        setTimeout(() => {
            console.log('üîç Final script verification:', {
                Game: typeof Game !== 'undefined',
                AdvancedAI: typeof AdvancedAI2048Solver !== 'undefined', 
                EnhancedAI: typeof Enhanced2048AI !== 'undefined'
            });
        }, 1000);
    </script>
</body>
</html>
