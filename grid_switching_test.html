<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Grid Switching Test - Fancy2048</title>
    <link rel="stylesheet" href="../styles/main.css">
    <script src="../scripts/game.js"></script>
</head>
<body>
    <div style="text-align: center; padding: 20px; color: white;">
        <h1>üéÆ Grid Switching Test</h1>
        <p>Test the 3√ó3 and 5√ó5 grid scaling fixes</p>
        
        <div style="margin: 20px;">
            <button onclick="game.setGridSize(3)" style="background: #ffcc00; padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">3√ó3 Grid</button>
            <button onclick="game.setGridSize(4)" style="background: #ffcc00; padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">4√ó4 Grid</button>
            <button onclick="game.setGridSize(5)" style="background: #ffcc00; padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">5√ó5 Grid</button>
            <button onclick="showDebugInfo()" style="background: #ff7f50; padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer;">Debug Info</button>
        </div>
        
        <div id="debug-info" style="background: rgba(76, 175, 80, 0.2); padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px; font-family: monospace; font-size: 12px; text-align: left;">
            Click "Debug Info" to see current settings...
        </div>
    </div>

    <main>
        <header>
            <h1>Fancy2048 <span id="grid-indicator">4√ó4</span></h1>
            <div id="score-container">
                <ul>
                    <li>Score: <strong id="score">0</strong></li>
                    <li>Best: <strong id="best-score">0</strong></li>
                </ul>
            </div>
        </header>

        <div class="controls">
            <button onclick="game.resetGame()">New Game</button>
            <button onclick="game.setGridSize(3)">3√ó3</button>
            <button onclick="game.setGridSize(4)">4√ó4</button>
            <button onclick="game.setGridSize(5)">5√ó5</button>
        </div>

        <div id="board-container" class="board-container" role="grid" aria-label="Game Board" tabindex="0">
        </div>
    </main>

    <script>
        let game;
        
        // Initialize game
        window.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Initializing game...');
                game = new Game();
                window.game = game; // Make globally accessible
                console.log('Game initialized successfully!');
                
                // Update grid indicator
                updateGridIndicator();
            } catch (error) {
                console.error('Failed to initialize game:', error);
                document.getElementById('debug-info').innerHTML = 
                    '<span style="color: red;">‚ùå Game initialization failed:</span><br>' + error.message;
            }
        });
        
        function updateGridIndicator() {
            if (game) {
                document.getElementById('grid-indicator').textContent = `${game.size}√ó${game.size}`;
            }
        }
        
        function showDebugInfo() {
            if (!game) {
                document.getElementById('debug-info').innerHTML = '‚ùå Game not initialized';
                return;
            }
            
            const styles = getComputedStyle(document.documentElement);
            const boardContainer = document.getElementById('board-container');
            const boardStyle = getComputedStyle(boardContainer);
            
            document.getElementById('debug-info').innerHTML = `
                <strong>üéÆ Game State:</strong><br>
                Current Grid Size: ${game.size}√ó${game.size}<br>
                Board State: ${game.gameState}<br>
                Score: ${game.score}<br><br>
                
                <strong>üìê CSS Variables:</strong><br>
                --size: ${styles.getPropertyValue('--size')}<br>
                --board-max-size: ${styles.getPropertyValue('--board-max-size')}<br>
                --tile-size: ${styles.getPropertyValue('--tile-size')}<br>
                --gap: ${styles.getPropertyValue('--gap')}<br>
                --font-scale-base: ${styles.getPropertyValue('--font-scale-base')}<br><br>
                
                <strong>üîç Computed Board Styles:</strong><br>
                Width: ${boardStyle.width}<br>
                Height: ${boardStyle.height}<br>
                Grid Template: ${boardStyle.gridTemplateColumns}<br>
                Gap: ${boardStyle.gap}<br><br>
                
                <strong>üì± Viewport Info:</strong><br>
                Window Size: ${window.innerWidth} √ó ${window.innerHeight}px<br>
                Device Pixel Ratio: ${window.devicePixelRatio}<br>
                User Agent: ${navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'}
            `;
        }
        
        // Override setGridSize to add logging and indicator updates
        const originalSetGridSize = Game.prototype.setGridSize;
        if (originalSetGridSize) {
            Game.prototype.setGridSize = function(newSize) {
                console.log(`üîÑ Switching to ${newSize}√ó${newSize} grid...`);
                const result = originalSetGridSize.call(this, newSize);
                updateGridIndicator();
                setTimeout(showDebugInfo, 500); // Auto-show debug info after switching
                return result;
            };
        }
        
        // Auto-refresh debug info on window resize
        window.addEventListener('resize', () => {
            setTimeout(showDebugInfo, 200);
        });
    </script>
</body>
</html>
