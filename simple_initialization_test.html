<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy2048 - Simple Initialization Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #f2f2f2;
            margin: 0;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .pass {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .fail {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .warn {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }
        
        #board-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            background: #333;
            padding: 15px;
            border-radius: 10px;
        }
        
        .grid-cell {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .tile {
            background: #ffcc00;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border-radius: 5px;
            width: 100%;
            height: 100%;
        }
        
        #score-container {
            text-align: center;
            margin: 20px;
        }
        
        #score-container ul {
            list-style: none;
            padding: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 0;
        }
        
        .test-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            opacity: 0.8;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="color: #ffcc00; text-align: center;">üß™ Fancy2048 - Simple Initialization Test</h1>
        
        <!-- Test Status Section -->
        <div class="test-section">
            <h2>üìã Test Status</h2>
            <div id="test-results"></div>
        </div>
        
        <!-- Required DOM Elements -->
        <div class="test-section">
            <h2>üèóÔ∏è Required DOM Elements</h2>
            <div id="board-container" role="grid" aria-label="Game Board"></div>
            
            <div id="score-container">
                <ul>
                    <li>Score: <span id="score">0</span></li>
                    <li>Best: <span id="best-score">0</span></li>
                    <li>Moves: <span id="moves">0</span></li>
                    <li>Time: <span id="time">00:00</span></li>
                </ul>
            </div>
            
            <div class="test-controls">
                <button id="reset-button">Reset</button>
                <button id="pause-button">Pause</button>
                <button id="autoplay-button">AutoPlay</button>
                <button id="back-button">Undo</button>
                <button id="changeColor-button">Color</button>
                <button id="theme-toggle-button">Theme</button>
                <button id="board-size-button">Size</button>
                <button id="speed-button"><span class="speed-text">1x</span></button>
                <button id="ai-difficulty-button">
                    <span class="button-text">Normal</span>
                </button>
                <button id="leaderboard-button">Stats</button>
            </div>
        </div>
        
        <!-- Game Instance Test -->
        <div class="test-section">
            <h2>‚öôÔ∏è Game Instance</h2>
            <div class="test-controls">
                <button onclick="testCreateGame()">Create Game Instance</button>
                <button onclick="testGameMethods()">Test Game Methods</button>
                <button onclick="testGameMove()">Test Move</button>
                <button onclick="testAI()">Test AI</button>
            </div>
            <div id="game-status"></div>
        </div>
        
        <!-- Log Console -->
        <div class="test-section">
            <h2>üìù Test Log</h2>
            <div class="log-container" id="test-log"></div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script>
        // Test logging
        const testLog = document.getElementById('test-log');
        const testResults = document.getElementById('test-results');
        const gameStatus = document.getElementById('game-status');
        
        let testGame = null;
        let testCount = 0;
        let passCount = 0;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff6b6b' : 
                                  type === 'warn' ? '#ffcc00' : 
                                  type === 'success' ? '#4CAF50' : '#f2f2f2';
            logEntry.textContent = `[${timestamp}] ${message}`;
            testLog.appendChild(logEntry);
            testLog.scrollTop = testLog.scrollHeight;
            console.log(message);
        }
        
        function updateTestStatus(testName, passed, message) {
            testCount++;
            if (passed) passCount++;
            
            const status = document.createElement('div');
            status.className = `status ${passed ? 'pass' : 'fail'}`;
            status.innerHTML = `${passed ? '‚úÖ' : '‚ùå'} ${testName}: ${message}`;
            testResults.appendChild(status);
            
            // Update overall score
            const score = Math.round((passCount / testCount) * 100);
            document.title = `Fancy2048 Test - ${score}% (${passCount}/${testCount})`;
        }
        
        // Pre-load tests
        function runPreLoadTests() {
            log('üöÄ Starting pre-load tests...', 'info');
            
            // Test 1: Check if all required DOM elements exist
            const requiredElements = [
                'board-container', 'score', 'best-score', 'moves', 'time',
                'reset-button', 'pause-button', 'autoplay-button'
            ];
            
            let missingElements = [];
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (!element) {
                    missingElements.push(id);
                }
            });
            
            if (missingElements.length === 0) {
                updateTestStatus('DOM Elements', true, 'All required elements found');
                log('‚úÖ All required DOM elements found', 'success');
            } else {
                updateTestStatus('DOM Elements', false, `Missing: ${missingElements.join(', ')}`);
                log(`‚ùå Missing elements: ${missingElements.join(', ')}`, 'error');
            }
        }
        
        function testCreateGame() {
            log('üéÆ Testing game instance creation...', 'info');
            
            try {
                if (typeof Game === 'undefined') {
                    updateTestStatus('Game Class', false, 'Game class not loaded');
                    log('‚ùå Game class not found', 'error');
                    return;
                }
                
                updateTestStatus('Game Class', true, 'Game class available');
                log('‚úÖ Game class found', 'success');
                
                // Create game instance
                testGame = new Game(4);
                updateTestStatus('Game Instance', true, 'Game instance created successfully');
                log('‚úÖ Game instance created', 'success');
                
                // Check game properties
                if (testGame.board && testGame.board.length === 4) {
                    updateTestStatus('Game Board', true, '4x4 board initialized');
                    log('‚úÖ Game board initialized', 'success');
                } else {
                    updateTestStatus('Game Board', false, 'Board not properly initialized');
                    log('‚ùå Board initialization failed', 'error');
                }
                
                // Update game status display
                gameStatus.innerHTML = `
                    <div class="status pass">
                        <strong>Game Created Successfully</strong><br>
                        Score: ${testGame.score}<br>
                        Board Size: ${testGame.size}x${testGame.size}<br>
                        Initial Tiles: ${testGame.board.flat().filter(x => x !== 0).length}
                    </div>
                `;
                
            } catch (error) {
                updateTestStatus('Game Instance', false, `Error: ${error.message}`);
                log(`‚ùå Game creation failed: ${error.message}`, 'error');
                
                gameStatus.innerHTML = `
                    <div class="status fail">
                        <strong>Game Creation Failed</strong><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
        
        function testGameMethods() {
            if (!testGame) {
                log('‚ö†Ô∏è No game instance to test', 'warn');
                return;
            }
            
            log('üîß Testing game methods...', 'info');
            
            const methods = ['move', 'reset', 'updateUI', 'canMove', 'addRandomTile'];
            let methodsOK = 0;
            
            methods.forEach(method => {
                if (typeof testGame[method] === 'function') {
                    methodsOK++;
                    log(`‚úÖ Method ${method} exists`, 'success');
                } else {
                    log(`‚ùå Method ${method} missing`, 'error');
                }
            });
            
            updateTestStatus('Game Methods', methodsOK === methods.length, 
                `${methodsOK}/${methods.length} methods available`);
        }
        
        function testGameMove() {
            if (!testGame) {
                log('‚ö†Ô∏è No game instance to test', 'warn');
                return;
            }
            
            log('üéØ Testing game move...', 'info');
            
            try {
                const initialScore = testGame.score;
                const moved = testGame.move('up');
                
                if (moved !== undefined) {
                    updateTestStatus('Game Move', true, 'Move method executed');
                    log(`‚úÖ Move executed, result: ${moved}`, 'success');
                    
                    // Update UI
                    testGame.updateUI();
                    
                    gameStatus.innerHTML = `
                        <div class="status pass">
                            <strong>Move Test Successful</strong><br>
                            Initial Score: ${initialScore}<br>
                            Current Score: ${testGame.score}<br>
                            Move Result: ${moved ? 'Valid move' : 'No move possible'}
                        </div>
                    `;
                } else {
                    updateTestStatus('Game Move', false, 'Move method failed');
                    log('‚ùå Move method failed', 'error');
                }
                
            } catch (error) {
                updateTestStatus('Game Move', false, `Error: ${error.message}`);
                log(`‚ùå Move test failed: ${error.message}`, 'error');
            }
        }
        
        function testAI() {
            if (!testGame) {
                log('‚ö†Ô∏è No game instance to test', 'warn');
                return;
            }
            
            log('ü§ñ Testing AI...', 'info');
            
            try {
                const aiMove = testGame.getBestMove();
                
                if (aiMove) {
                    updateTestStatus('AI System', true, `AI suggests: ${aiMove}`);
                    log(`‚úÖ AI working, suggests: ${aiMove}`, 'success');
                } else {
                    updateTestStatus('AI System', false, 'AI returned no move');
                    log('‚ùå AI returned no move', 'error');
                }
                
                // Test AI classes
                if (typeof AdvancedAI2048Solver !== 'undefined') {
                    log('‚úÖ AdvancedAI2048Solver loaded', 'success');
                } else {
                    log('‚ö†Ô∏è AdvancedAI2048Solver not loaded', 'warn');
                }
                
                if (typeof Enhanced2048AI !== 'undefined') {
                    log('‚úÖ Enhanced2048AI loaded', 'success');
                } else {
                    log('‚ö†Ô∏è Enhanced2048AI not loaded', 'warn');
                }
                
            } catch (error) {
                updateTestStatus('AI System', false, `Error: ${error.message}`);
                log(`‚ùå AI test failed: ${error.message}`, 'error');
            }
        }
        
        // Global error handling
        window.addEventListener('error', (event) => {
            log(`üö® Global error: ${event.error.message}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            log(`üö® Unhandled rejection: ${event.reason}`, 'error');
        });
        
        // Run pre-load tests immediately
        runPreLoadTests();
        
        log('üì¶ Loading scripts...', 'info');
    </script>
    
    <!-- Load game scripts -->
    <script src="scripts/advanced_ai_solver.js" 
            onload="log('‚úÖ Advanced AI script loaded', 'success')"
            onerror="log('‚ùå Failed to load advanced_ai_solver.js', 'error')">
    </script>
    
    <script src="scripts/enhanced_ai.js" 
            onload="log('‚úÖ Enhanced AI script loaded', 'success')"
            onerror="log('‚ùå Failed to load enhanced_ai.js', 'error')">
    </script>
    
    <script src="scripts/game.js" 
            onload="log('‚úÖ Game script loaded', 'success')"
            onerror="log('‚ùå Failed to load game.js', 'error')">
    </script>
    
    <script>
        // Post-load tests
        window.addEventListener('load', () => {
            log('üèÅ All scripts loaded', 'info');
            
            // Auto-test basic functionality
            setTimeout(() => {
                log('üîÑ Running automatic tests...', 'info');
                testCreateGame();
                
                setTimeout(() => {
                    testGameMethods();
                    testGameMove();
                    testAI();
                }, 1000);
            }, 500);
        });
    </script>
</body>
</html>
