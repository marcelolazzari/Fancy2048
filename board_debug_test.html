<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Board Debug Test - Fancy2048</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #f2f2f2;
            margin: 0;
            padding: 20px;
        }
        
        .debug-info {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px auto;
            max-width: 600px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .test-controls {
            text-align: center;
            margin: 20px;
        }
        
        .test-controls button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .board-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            padding: 20px;
        }
        
        /* Override to make debugging easier */
        #board-container {
            border: 3px solid #ff0000 !important;
        }
        
        .grid-cell {
            border: 1px solid #00ff00 !important;
        }
        
        .tile {
            border: 2px solid #0000ff !important;
        }
    </style>
</head>
<body>
    <h1>üîç Board Debug Test</h1>
    
    <div class="debug-info" id="debug-info">
        Loading debug information...
    </div>
    
    <div class="test-controls">
        <button onclick="testGrid(3)">Create 3√ó3</button>
        <button onclick="testGrid(4)">Create 4√ó4</button>
        <button onclick="testGrid(5)">Create 5√ó5</button>
        <button onclick="showCSS()">Show CSS Values</button>
        <button onclick="addTestTiles()">Add Test Tiles</button>
    </div>
    
    <div class="board-wrapper">
        <div id="board-container" class="board-container" role="grid" aria-label="Game Board" tabindex="0">
            <!-- Board cells will be created here -->
        </div>
    </div>
    
    <div class="debug-info" id="css-values">
        CSS Variables will be shown here...
    </div>
    
    <script>
        let currentSize = 4;
        
        function updateDebugInfo() {
            const info = document.getElementById('debug-info');
            const boardContainer = document.getElementById('board-container');
            const computedStyle = getComputedStyle(boardContainer);
            
            info.innerHTML = `
                <strong>Board Container Status:</strong><br>
                Element exists: ${boardContainer ? 'YES' : 'NO'}<br>
                Children count: ${boardContainer ? boardContainer.children.length : 0}<br>
                Grid template columns: ${computedStyle.gridTemplateColumns}<br>
                Grid template rows: ${computedStyle.gridTemplateRows}<br>
                Width: ${computedStyle.width}<br>
                Height: ${computedStyle.height}<br>
                Gap: ${computedStyle.gap}<br>
                <br>
                <strong>Window Size:</strong> ${window.innerWidth} √ó ${window.innerHeight}px<br>
                <strong>Current Grid Size:</strong> ${currentSize}√ó${currentSize}
            `;
        }
        
        function showCSS() {
            const cssDiv = document.getElementById('css-values');
            const styles = getComputedStyle(document.documentElement);
            
            cssDiv.innerHTML = `
                <strong>CSS Custom Properties:</strong><br>
                --size: ${styles.getPropertyValue('--size')}<br>
                --board-max-size: ${styles.getPropertyValue('--board-max-size')}<br>
                --tile-size: ${styles.getPropertyValue('--tile-size')}<br>
                --gap: ${styles.getPropertyValue('--gap')}<br>
                --font-scale-base: ${styles.getPropertyValue('--font-scale-base')}<br>
                <br>
                <strong>Base Board Sizes:</strong><br>
                --base-board-size-3x3: ${styles.getPropertyValue('--base-board-size-3x3')}<br>
                --base-board-size-4x4: ${styles.getPropertyValue('--base-board-size-4x4')}<br>
                --base-board-size-5x5: ${styles.getPropertyValue('--base-board-size-5x5')}<br>
                <br>
                <strong>Gap Sizes:</strong><br>
                --gap-3x3: ${styles.getPropertyValue('--gap-3x3')}<br>
                --gap-4x4: ${styles.getPropertyValue('--gap-4x4')}<br>
                --gap-5x5: ${styles.getPropertyValue('--gap-5x5')}<br>
            `;
        }
        
        function testGrid(size) {
            currentSize = size;
            const boardContainer = document.getElementById('board-container');
            
            // Clear existing content
            boardContainer.innerHTML = '';
            
            // Set CSS variables like the game would
            document.documentElement.style.setProperty('--size', size);
            
            // Update responsive variables (simplified version of game logic)
            updateResponsiveVars(size);
            
            // Create grid cells
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const gridCell = document.createElement('div');
                    gridCell.className = 'grid-cell';
                    gridCell.setAttribute('data-row', i);
                    gridCell.setAttribute('data-col', j);
                    gridCell.textContent = `${i},${j}`;
                    gridCell.style.fontSize = '10px';
                    boardContainer.appendChild(gridCell);
                }
            }
            
            updateDebugInfo();
            console.log(`Created ${size}√ó${size} grid with ${size * size} cells`);
        }
        
        function updateResponsiveVars(size) {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const isMobile = vw <= 768;
            const isPortrait = vh > vw;
            
            let maxBoardSize, gapMultiplier;
            
            // Replicate the game's responsive logic
            switch (size) {
                case 3:
                    gapMultiplier = 1.6;
                    if (isMobile) {
                        maxBoardSize = isPortrait ? 
                            Math.min(vw * 0.92, vh * 0.50, 320) :
                            Math.min(vw * 0.55, vh * 0.75, 350);
                    } else {
                        maxBoardSize = Math.min(vw * 0.45, vh * 0.55, 400);
                    }
                    break;
                case 4:
                    gapMultiplier = 1.0;
                    if (isMobile) {
                        maxBoardSize = isPortrait ? 
                            Math.min(vw * 0.95, vh * 0.55, 360) :
                            Math.min(vw * 0.60, vh * 0.80, 380);
                    } else {
                        maxBoardSize = Math.min(vw * 0.50, vh * 0.60, 480);
                    }
                    break;
                case 5:
                    gapMultiplier = 0.6;
                    if (isMobile) {
                        maxBoardSize = isPortrait ? 
                            Math.min(vw * 0.98, vh * 0.60, 400) :
                            Math.min(vw * 0.65, vh * 0.85, 420);
                    } else {
                        maxBoardSize = Math.min(vw * 0.55, vh * 0.65, 550);
                    }
                    break;
            }
            
            const baseGap = isMobile ? 
                Math.max(2, Math.min(8, Math.min(vw, vh) * 0.012)) :
                Math.max(6, Math.min(14, Math.min(vw, vh) * 0.018));
            const gap = baseGap * gapMultiplier;
            
            const tileSize = (maxBoardSize - gap * (size + 1)) / size;
            const minTileSize = isMobile ? 35 : 50;
            const adjustedTileSize = Math.max(minTileSize, tileSize);
            const adjustedBoardSize = adjustedTileSize * size + gap * (size + 1);
            
            // Update CSS variables
            document.documentElement.style.setProperty('--board-max-size', `${adjustedBoardSize}px`);
            document.documentElement.style.setProperty('--gap', `${gap}px`);
            document.documentElement.style.setProperty('--tile-size', `${adjustedTileSize}px`);
        }
        
        function addTestTiles() {
            const cells = document.querySelectorAll('.grid-cell');
            cells.forEach((cell, index) => {
                if (index < 3) { // Add tiles to first 3 cells
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.setAttribute('data-value', Math.pow(2, index + 1));
                    tile.textContent = Math.pow(2, index + 1);
                    tile.style.position = 'absolute';
                    tile.style.width = '100%';
                    tile.style.height = '100%';
                    tile.style.top = '0';
                    tile.style.left = '0';
                    cell.style.position = 'relative';
                    cell.appendChild(tile);
                }
            });
            updateDebugInfo();
        }
        
        // Initialize
        testGrid(4);
        showCSS();
        
        // Update on resize
        window.addEventListener('resize', () => {
            updateResponsiveVars(currentSize);
            updateDebugInfo();
            showCSS();
        });
    </script>
</body>
</html>
