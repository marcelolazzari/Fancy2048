<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Final Grid Scaling Test - Fancy2048</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="scripts/game.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #f2f2f2;
            margin: 0;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .test-controls button {
            background: #ffcc00;
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-controls button.active {
            background: #ff7f50;
            color: white;
        }
        
        .test-info {
            background: rgba(76, 175, 80, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 15px auto;
            max-width: 600px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
            padding: 20px;
        }
        
        .viewport-debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px;
            border-radius: 5px;
            font-size: 11px;
            font-family: monospace;
            z-index: 1000;
        }
        
        @media (max-width: 768px) {
            .test-controls {
                gap: 5px;
            }
            
            .test-controls button {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .game-container {
                padding: 10px;
                min-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="viewport-debug" id="viewport-debug">
        Loading...
    </div>
    
    <div class="test-header">
        <h1>ðŸŽ® Final Grid Scaling Test</h1>
        <p>Testing improved 3Ã—3 and 5Ã—5 grid scaling and fitting</p>
    </div>
    
    <div class="test-controls">
        <button onclick="switchToGrid(3)" id="btn-3x3">3Ã—3 Grid</button>
        <button onclick="switchToGrid(4)" id="btn-4x4" class="active">4Ã—4 Grid (Default)</button>
        <button onclick="switchToGrid(5)" id="btn-5x5">5Ã—5 Grid</button>
        <button onclick="testResponsiveness()">Test Responsiveness</button>
        <button onclick="resetGame()">New Game</button>
    </div>
    
    <div class="test-info" id="test-info">
        <strong>Current Status:</strong> Loading game engine...<br>
        <strong>Instructions:</strong> Switch between grid sizes to test scaling improvements
    </div>
    
    <div class="game-container">
        <main>
            <header>
                <h1>Fancy2048 <span id="grid-indicator">4Ã—4</span></h1>
                <div id="score-container">
                    <ul>
                        <li>Score: <strong id="score">0</strong></li>
                        <li>Best: <strong id="best-score">0</strong></li>
                    </ul>
                </div>
            </header>
            
            <div class="controls">
                <button onclick="resetGame()">New Game</button>
                <button onclick="switchToGrid(3)">3Ã—3</button>
                <button onclick="switchToGrid(4)">4Ã—4</button>
                <button onclick="switchToGrid(5)">5Ã—5</button>
            </div>
            
            <div id="board-container">
                <div id="board"></div>
            </div>
        </main>
    </div>
    
    <script>
        let game;
        let currentGridSize = 4;
        
        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', function() {
            try {
                game = new Game();
                updateTestInfo();
                updateViewportDebug();
                console.log('Game initialized successfully');
            } catch (error) {
                console.error('Failed to initialize game:', error);
                document.getElementById('test-info').innerHTML = 
                    '<strong style="color: red;">Error:</strong> Failed to initialize game engine<br>' +
                    '<strong>Details:</strong> ' + error.message;
            }
        });
        
        function switchToGrid(size) {
            if (!game) {
                console.error('Game not initialized');
                return;
            }
            
            try {
                currentGridSize = size;
                
                // Update active button
                document.querySelectorAll('.test-controls button').forEach(btn => 
                    btn.classList.remove('active'));
                document.getElementById(`btn-${size}x${size}`).classList.add('active');
                
                // Update grid indicator
                document.getElementById('grid-indicator').textContent = `${size}Ã—${size}`;
                
                // Switch game grid size
                game.setGridSize(size);
                game.resetGame();
                
                updateTestInfo();
                console.log(`Switched to ${size}Ã—${size} grid`);
            } catch (error) {
                console.error('Failed to switch grid size:', error);
                document.getElementById('test-info').innerHTML = 
                    `<strong style="color: red;">Error:</strong> Failed to switch to ${size}Ã—${size} grid<br>` +
                    '<strong>Details:</strong> ' + error.message;
            }
        }
        
        function resetGame() {
            if (!game) return;
            
            try {
                game.resetGame();
                updateTestInfo();
                console.log('Game reset');
            } catch (error) {
                console.error('Failed to reset game:', error);
            }
        }
        
        function testResponsiveness() {
            if (!game) return;
            
            try {
                // Force responsive variable update
                game.updateResponsiveVariables();
                updateTestInfo();
                console.log('Responsiveness test completed');
            } catch (error) {
                console.error('Failed to test responsiveness:', error);
            }
        }
        
        function updateTestInfo() {
            const styles = getComputedStyle(document.documentElement);
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const deviceType = vw <= 480 ? 'Mobile' : vw <= 768 ? 'Tablet' : 'Desktop';
            const orientation = vh > vw ? 'Portrait' : 'Landscape';
            
            const info = document.getElementById('test-info');
            info.innerHTML = `
                <strong>Current Grid:</strong> ${currentGridSize}Ã—${currentGridSize}<br>
                <strong>Device Type:</strong> ${deviceType} (${orientation})<br>
                <strong>Viewport:</strong> ${vw} Ã— ${vh}px<br>
                <strong>Board Size:</strong> ${styles.getPropertyValue('--board-max-size')}<br>
                <strong>Tile Size:</strong> ${styles.getPropertyValue('--tile-size')}<br>
                <strong>Gap:</strong> ${styles.getPropertyValue('--gap')}<br>
                <strong>Font Scale:</strong> ${styles.getPropertyValue('--font-scale-base')}<br>
                <strong>Status:</strong> Grid scaling and responsiveness active âœ…
            `;
        }
        
        function updateViewportDebug() {
            const debug = document.getElementById('viewport-debug');
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const ratio = window.devicePixelRatio || 1;
            const orientation = vh > vw ? 'Portrait' : 'Landscape';
            
            debug.innerHTML = `
                ${vw}Ã—${vh}px<br>
                ${orientation}<br>
                ${currentGridSize}Ã—${currentGridSize}<br>
                ${ratio}x DPR
            `;
        }
        
        // Update on resize
        window.addEventListener('resize', () => {
            updateTestInfo();
            updateViewportDebug();
            if (game && game.updateResponsiveVariables) {
                game.updateResponsiveVariables();
            }
        });
        
        // Update viewport debug periodically
        setInterval(updateViewportDebug, 1000);
    </script>
</body>
</html>
