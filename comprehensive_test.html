<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy2048 - Comprehensive Auto-Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .test-console { background: #000; color: #0f0; padding: 20px; font-family: monospace; margin: 20px 0; border-radius: 5px; }
        .error { color: #f44; }
        .success { color: #4f4; }
        .warning { color: #ff4; }
        .info { color: #4ff; }
        button { margin: 5px; padding: 10px 15px; background: #333; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>🧪 Fancy2048 Comprehensive Auto-Test</h1>
    
    <div>
        <button onclick="runGameEngineTests()">Test Game Engine</button>
        <button onclick="runAITests()">Test AI Systems</button>
        <button onclick="runUITests()">Test UI Components</button>
        <button onclick="runIntegrationTests()">Integration Tests</button>
        <button onclick="runAllTests()">🚀 Run All Tests</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <div id="test-console" class="test-console">
        <div>🤖 Fancy2048 Auto-Test Console Ready</div>
        <div>═══════════════════════════════════════════</div>
    </div>
    
    <!-- Hidden game elements for testing -->
    <div style="position: absolute; left: -9999px;">
        <div id="score-container"><ul><li>Score: <span id="score">0</span></li></ul></div>
        <div id="board-container"></div>
        <button id="reset-button">Reset</button>
        <button id="ai-play-button">AI Play</button>
        <button id="pause-button">Pause</button>
    </div>

    <script>
        let game = null;
        let testResults = {};
        
        function log(message, type = 'info') {
            const console = document.getElementById('test-console');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }
        
        function clearConsole() {
            const console = document.getElementById('test-console');
            console.innerHTML = '<div>🤖 Console Cleared</div><div>═══════════════════════════════════════════</div>';
        }
        
        async function loadRequiredScripts() {
            const scripts = [
                'scripts/ai_learning_system.js',
                'scripts/enhanced_ai.js',
                'scripts/advanced_ai_solver.js',
                'scripts/game.js'
            ];
            
            log('📦 Loading required scripts...');
            
            for (let script of scripts) {
                try {
                    await new Promise((resolve, reject) => {
                        if (document.querySelector(`script[src="${script}"]`)) {
                            resolve();
                            return;
                        }
                        
                        const scriptTag = document.createElement('script');
                        scriptTag.src = script;
                        scriptTag.onload = () => {
                            log(`✅ Loaded: ${script}`, 'success');
                            resolve();
                        };
                        scriptTag.onerror = () => {
                            log(`❌ Failed to load: ${script}`, 'error');
                            reject(new Error(`Failed to load ${script}`));
                        };
                        document.head.appendChild(scriptTag);
                    });
                } catch (error) {
                    log(`❌ Script loading error: ${error.message}`, 'error');
                    testResults[`script_${script}`] = false;
                }
            }
        }
        
        async function runGameEngineTests() {
            log('🎮 Starting Game Engine Tests...', 'info');
            
            try {
                if (typeof Game === 'undefined') {
                    await loadRequiredScripts();
                }
                
                // Test 1: Game class instantiation
                if (typeof Game !== 'undefined') {
                    game = new Game(4);
                    log('✅ Game class instantiated successfully', 'success');
                    testResults.game_instantiation = true;
                } else {
                    throw new Error('Game class not available');
                }
                
                // Test 2: Board creation
                if (typeof game.createEmptyBoard === 'function') {
                    game.createEmptyBoard();
                    if (game.board && game.board.length === 4) {
                        log('✅ 4x4 board created successfully', 'success');
                        testResults.board_creation = true;
                    } else {
                        throw new Error('Board not created with correct dimensions');
                    }
                } else {
                    throw new Error('createEmptyBoard method not found');
                }
                
                // Test 3: Game initialization
                if (typeof game.initializeGame === 'function') {
                    game.initializeGame();
                    log('✅ Game initialized successfully', 'success');
                    testResults.game_initialization = true;
                } else {
                    log('⚠️  initializeGame method not found', 'warning');
                    testResults.game_initialization = false;
                }
                
                // Test 4: Move functionality
                if (typeof game.move === 'function') {
                    const moves = ['up', 'down', 'left', 'right'];
                    let moveTests = 0;
                    
                    for (let move of moves) {
                        try {
                            game.move(move);
                            moveTests++;
                        } catch (error) {
                            log(`⚠️  Move ${move} failed: ${error.message}`, 'warning');
                        }
                    }
                    
                    if (moveTests > 0) {
                        log(`✅ Move functionality working (${moveTests}/4 moves tested)`, 'success');
                        testResults.move_functionality = true;
                    } else {
                        throw new Error('No moves working');
                    }
                } else {
                    throw new Error('move method not found');
                }
                
                log('🎮 Game Engine Tests Completed', 'success');
                
            } catch (error) {
                log(`❌ Game Engine Test Failed: ${error.message}`, 'error');
                testResults.game_engine = false;
            }
        }
        
        async function runAITests() {
            log('🤖 Starting AI System Tests...', 'info');
            
            try {
                const aiClasses = [
                    { name: 'Enhanced AI', class: 'Enhanced2048AI' },
                    { name: 'Advanced AI Solver', class: 'AdvancedAI2048Solver' },
                    { name: 'AI Learning System', class: 'AILearningSystem' }
                ];
                
                for (let aiClass of aiClasses) {
                    if (typeof window[aiClass.class] !== 'undefined') {
                        try {
                            const ai = new window[aiClass.class](game);
                            
                            if (typeof ai.getBestMove === 'function') {
                                log(`✅ ${aiClass.name} loaded and functional`, 'success');
                                testResults[`ai_${aiClass.class}`] = true;
                                
                                // Test AI move generation
                                if (game && game.board) {
                                    try {
                                        const move = ai.getBestMove();
                                        log(`✅ ${aiClass.name} generated move: ${move}`, 'success');
                                    } catch (error) {
                                        log(`⚠️  ${aiClass.name} move generation failed: ${error.message}`, 'warning');
                                    }
                                }
                            } else {
                                log(`⚠️  ${aiClass.name} missing getBestMove method`, 'warning');
                                testResults[`ai_${aiClass.class}`] = false;
                            }
                        } catch (error) {
                            log(`❌ ${aiClass.name} instantiation failed: ${error.message}`, 'error');
                            testResults[`ai_${aiClass.class}`] = false;
                        }
                    } else {
                        log(`❌ ${aiClass.name} class not available`, 'error');
                        testResults[`ai_${aiClass.class}`] = false;
                    }
                }
                
                log('🤖 AI System Tests Completed', 'success');
                
            } catch (error) {
                log(`❌ AI Tests Failed: ${error.message}`, 'error');
            }
        }
        
        async function runUITests() {
            log('🖥️  Starting UI Component Tests...', 'info');
            
            const requiredElements = [
                'score-container',
                'board-container', 
                'reset-button'
            ];
            
            let uiTestsPassed = 0;
            
            for (let elementId of requiredElements) {
                const element = document.getElementById(elementId);
                if (element) {
                    log(`✅ UI Element found: ${elementId}`, 'success');
                    uiTestsPassed++;
                } else {
                    log(`❌ UI Element missing: ${elementId}`, 'error');
                }
            }
            
            testResults.ui_elements = uiTestsPassed === requiredElements.length;
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (value === 'value') {
                    log('✅ LocalStorage working correctly', 'success');
                    testResults.localStorage = true;
                } else {
                    log('❌ LocalStorage not functioning', 'error');
                    testResults.localStorage = false;
                }
            } catch (error) {
                log(`❌ LocalStorage error: ${error.message}`, 'error');
                testResults.localStorage = false;
            }
            
            log('🖥️  UI Component Tests Completed', 'success');
        }
        
        async function runIntegrationTests() {
            log('🔗 Starting Integration Tests...', 'info');
            
            try {
                if (!game) {
                    await runGameEngineTests();
                }
                
                // Test full game flow
                if (game) {
                    // Reset and start fresh
                    game.resetGame();
                    log('✅ Game reset successful', 'success');
                    
                    // Test multiple moves
                    const testSequence = ['right', 'up', 'left', 'down'];
                    for (let move of testSequence) {
                        game.move(move);
                    }
                    log('✅ Move sequence completed', 'success');
                    
                    // Test score tracking
                    if (game.score !== undefined) {
                        log(`✅ Score tracking active: ${game.score}`, 'success');
                        testResults.score_tracking = true;
                    } else {
                        log('⚠️  Score tracking not found', 'warning');
                        testResults.score_tracking = false;
                    }
                    
                    testResults.integration = true;
                } else {
                    throw new Error('Game not available for integration testing');
                }
                
                log('🔗 Integration Tests Completed', 'success');
                
            } catch (error) {
                log(`❌ Integration Test Failed: ${error.message}`, 'error');
                testResults.integration = false;
            }
        }
        
        async function runAllTests() {
            clearConsole();
            log('🚀 Starting Comprehensive Test Suite', 'info');
            
            const startTime = Date.now();
            
            await loadRequiredScripts();
            await runGameEngineTests();
            await runAITests();
            await runUITests();
            await runIntegrationTests();
            
            const endTime = Date.now();
            const duration = ((endTime - startTime) / 1000).toFixed(2);
            
            // Generate summary
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(r => r === true).length;
            const failedTests = totalTests - passedTests;
            
            log('═══════════════════════════════════════════', 'info');
            log(`📊 TEST SUMMARY`, 'info');
            log(`Total Tests: ${totalTests}`, 'info');
            log(`Passed: ${passedTests}`, 'success');
            log(`Failed: ${failedTests}`, failedTests > 0 ? 'error' : 'success');
            log(`Duration: ${duration}s`, 'info');
            log('═══════════════════════════════════════════', 'info');
            
            if (failedTests === 0) {
                log('🎉 ALL TESTS PASSED! Game is fully functional.', 'success');
            } else {
                log(`⚠️  ${failedTests} test(s) failed. Check logs above for details.`, 'warning');
            }
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('🎮 Fancy2048 Auto-Test System Ready');
                log('Click "Run All Tests" to begin comprehensive testing');
            }, 1000);
        });
    </script>
</body>
</html>