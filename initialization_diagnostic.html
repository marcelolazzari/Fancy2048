<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy2048 - Initialization Diagnostic</title>
    <link rel="stylesheet" href="styles/unified_styles_fixed.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .diagnostic-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: var(--primary-color);
            color: var(--secondary-color);
            min-height: 100vh;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-result {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .test-result.pass {
            background: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
        }
        
        .test-result.fail {
            background: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #f44336;
        }
        
        .test-result.warn {
            background: rgba(255, 152, 0, 0.2);
            border-left: 4px solid #FF9800;
        }
        
        .status-icon {
            width: 20px;
            text-align: center;
        }
        
        .game-preview {
            background: var(--board-bg);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        #mini-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 20px auto;
            background: var(--grid-cell-bg);
            padding: 15px;
            border-radius: 8px;
        }
        
        .mini-cell {
            aspect-ratio: 1;
            background: var(--empty-cell-bg);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .mini-tile {
            background: var(--tile-2-bg);
            color: var(--tile-2-text);
        }
        
        .controls-test {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .test-button {
            background: var(--highlight-color);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-button:hover {
            opacity: 0.8;
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--highlight-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <header style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: var(--highlight-color); margin-bottom: 10px;">
                <i class="fas fa-tools"></i> Fancy2048 Initialization Diagnostic
            </h1>
            <p>Comprehensive system check for game initialization issues</p>
        </header>

        <!-- Summary Statistics -->
        <div class="test-section">
            <h2><i class="fas fa-chart-line"></i> Summary Statistics</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="passed-tests">0</div>
                    <div class="stat-label">Tests Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failed-tests">0</div>
                    <div class="stat-label">Tests Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="warnings">0</div>
                    <div class="stat-label">Warnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="overall-score">0%</div>
                    <div class="stat-label">Overall Score</div>
                </div>
            </div>
        </div>

        <!-- DOM Elements Check -->
        <div class="test-section">
            <h2><i class="fas fa-code"></i> DOM Elements Verification</h2>
            <div id="dom-tests"></div>
        </div>

        <!-- CSS Styles Check -->
        <div class="test-section">
            <h2><i class="fas fa-palette"></i> CSS Styles Check</h2>
            <div id="css-tests"></div>
        </div>

        <!-- JavaScript Classes Check -->
        <div class="test-section">
            <h2><i class="fas fa-cog"></i> JavaScript Classes Check</h2>
            <div id="js-tests"></div>
        </div>

        <!-- Game Initialization Test -->
        <div class="test-section">
            <h2><i class="fas fa-play-circle"></i> Game Initialization Test</h2>
            <div id="game-init-tests"></div>
            
            <div class="game-preview">
                <h3>Game Preview</h3>
                <div id="mini-board"></div>
                <div class="controls-test">
                    <button class="test-button" onclick="testGameMove('up')">
                        <i class="fas fa-arrow-up"></i> Up
                    </button>
                    <button class="test-button" onclick="testGameMove('down')">
                        <i class="fas fa-arrow-down"></i> Down
                    </button>
                    <button class="test-button" onclick="testGameMove('left')">
                        <i class="fas fa-arrow-left"></i> Left
                    </button>
                    <button class="test-button" onclick="testGameMove('right')">
                        <i class="fas fa-arrow-right"></i> Right
                    </button>
                </div>
                <div id="game-status"></div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="test-section">
            <h2><i class="fas fa-tachometer-alt"></i> Performance Metrics</h2>
            <div id="performance-tests"></div>
        </div>

        <!-- Error Console -->
        <div class="test-section">
            <h2><i class="fas fa-bug"></i> Error Console</h2>
            <div class="code-block" id="error-console">
                No errors detected.
            </div>
        </div>

        <!-- Recommendations -->
        <div class="test-section">
            <h2><i class="fas fa-lightbulb"></i> Recommendations</h2>
            <div id="recommendations"></div>
        </div>
    </div>

    <!-- Load scripts -->
    <script src="scripts/advanced_ai_solver.js"></script>
    <script src="scripts/enhanced_ai.js"></script>
    <script src="scripts/game.js"></script>

    <script>
        // Diagnostic test suite
        let testResults = {
            passed: 0,
            failed: 0,
            warnings: 0,
            errors: []
        };

        function addTestResult(container, testName, status, message, details = '') {
            testResults[status === 'pass' ? 'passed' : status === 'fail' ? 'failed' : 'warnings']++;
            
            const result = document.createElement('div');
            result.className = `test-result ${status}`;
            
            const icon = status === 'pass' ? '✅' : status === 'fail' ? '❌' : '⚠️';
            
            result.innerHTML = `
                <span class="status-icon">${icon}</span>
                <div>
                    <strong>${testName}</strong>
                    <div style="font-size: 0.9rem; opacity: 0.8;">${message}</div>
                    ${details ? `<div class="code-block">${details}</div>` : ''}
                </div>
            `;
            
            container.appendChild(result);
        }

        function updateSummaryStats() {
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
            document.getElementById('warnings').textContent = testResults.warnings;
            
            const total = testResults.passed + testResults.failed + testResults.warnings;
            const score = total > 0 ? Math.round((testResults.passed / total) * 100) : 0;
            document.getElementById('overall-score').textContent = score + '%';
        }

        // DOM Elements Test
        function testDOMElements() {
            const container = document.getElementById('dom-tests');
            const requiredElements = [
                'board-container',
                'score',
                'best-score', 
                'moves',
                'time',
                'reset-button',
                'pause-button',
                'autoplay-button'
            ];

            requiredElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    addTestResult(container, `Element: ${elementId}`, 'pass', 
                        `Found with tag: ${element.tagName.toLowerCase()}`);
                } else {
                    addTestResult(container, `Element: ${elementId}`, 'fail', 
                        'Required element not found in DOM');
                    testResults.errors.push(`Missing element: ${elementId}`);
                }
            });
        }

        // CSS Styles Test
        function testCSSStyles() {
            const container = document.getElementById('css-tests');
            const testElement = document.createElement('div');
            testElement.style.display = 'none';
            document.body.appendChild(testElement);

            try {
                const cssVariables = [
                    '--size',
                    '--tile-size',
                    '--gap',
                    '--highlight-color',
                    '--board-bg'
                ];

                cssVariables.forEach(variable => {
                    const value = getComputedStyle(document.documentElement).getPropertyValue(variable);
                    if (value.trim()) {
                        addTestResult(container, `CSS Variable: ${variable}`, 'pass', 
                            `Value: ${value.trim()}`);
                    } else {
                        addTestResult(container, `CSS Variable: ${variable}`, 'warn', 
                            'CSS variable not defined or empty');
                    }
                });

                // Test CSS loading
                const boardContainer = document.getElementById('board-container');
                if (boardContainer) {
                    const computedStyle = getComputedStyle(boardContainer);
                    const display = computedStyle.display;
                    
                    if (display === 'grid') {
                        addTestResult(container, 'CSS Grid Layout', 'pass', 
                            'Board container has proper grid display');
                    } else {
                        addTestResult(container, 'CSS Grid Layout', 'fail', 
                            `Expected grid, got: ${display}`);
                    }
                }

            } finally {
                document.body.removeChild(testElement);
            }
        }

        // JavaScript Classes Test
        function testJavaScriptClasses() {
            const container = document.getElementById('js-tests');

            // Test Game class
            if (typeof Game !== 'undefined') {
                addTestResult(container, 'Game Class', 'pass', 
                    'Game class loaded successfully');
                
                // Test Game constructor
                try {
                    // Create minimal DOM elements for testing
                    const testBoard = document.createElement('div');
                    testBoard.id = 'test-board-container';
                    document.body.appendChild(testBoard);
                    
                    addTestResult(container, 'Game Constructor', 'pass', 
                        'Game constructor accessible');
                        
                    document.body.removeChild(testBoard);
                } catch (e) {
                    addTestResult(container, 'Game Constructor', 'fail', 
                        `Constructor error: ${e.message}`);
                }
            } else {
                addTestResult(container, 'Game Class', 'fail', 
                    'Game class not loaded');
                testResults.errors.push('Game class missing');
            }

            // Test AI classes
            if (typeof AdvancedAI2048Solver !== 'undefined') {
                addTestResult(container, 'Advanced AI Class', 'pass', 
                    'AdvancedAI2048Solver loaded successfully');
            } else {
                addTestResult(container, 'Advanced AI Class', 'warn', 
                    'AdvancedAI2048Solver not loaded (optional)');
            }

            if (typeof Enhanced2048AI !== 'undefined') {
                addTestResult(container, 'Enhanced AI Class', 'pass', 
                    'Enhanced2048AI loaded successfully');
            } else {
                addTestResult(container, 'Enhanced AI Class', 'warn', 
                    'Enhanced2048AI not loaded (optional)');
            }
        }

        // Game Initialization Test
        function testGameInitialization() {
            const container = document.getElementById('game-init-tests');

            try {
                // Create test game instance
                const testGame = new Game(4);
                
                addTestResult(container, 'Game Instance Creation', 'pass', 
                    'Game instance created successfully');

                // Test board initialization
                if (testGame.board && testGame.board.length === 4) {
                    addTestResult(container, 'Board Initialization', 'pass', 
                        `4x4 board created with ${testGame.board.length} rows`);
                } else {
                    addTestResult(container, 'Board Initialization', 'fail', 
                        'Board not properly initialized');
                }

                // Test initial tiles
                const nonZeroTiles = testGame.board.flat().filter(tile => tile !== 0).length;
                if (nonZeroTiles >= 2) {
                    addTestResult(container, 'Initial Tiles', 'pass', 
                        `${nonZeroTiles} initial tiles placed`);
                } else {
                    addTestResult(container, 'Initial Tiles', 'fail', 
                        `Only ${nonZeroTiles} initial tiles found`);
                }

                // Test game methods
                const methods = ['move', 'reset', 'updateUI', 'canMove'];
                methods.forEach(method => {
                    if (typeof testGame[method] === 'function') {
                        addTestResult(container, `Method: ${method}`, 'pass', 
                            'Method exists and is callable');
                    } else {
                        addTestResult(container, `Method: ${method}`, 'fail', 
                            'Required method missing');
                    }
                });

                // Update mini board display
                updateMiniBoard(testGame.board);
                
                // Store test game globally
                window.testGame = testGame;

            } catch (error) {
                addTestResult(container, 'Game Instance Creation', 'fail', 
                    `Error: ${error.message}`, error.stack);
                testResults.errors.push(`Game initialization error: ${error.message}`);
            }
        }

        // Performance Tests
        function testPerformance() {
            const container = document.getElementById('performance-tests');
            
            // Test script load timing
            const startTime = performance.now();
            const loadTime = startTime; // This would be set when scripts started loading
            
            addTestResult(container, 'Page Load Time', 'pass', 
                `Page loaded in ${loadTime.toFixed(2)}ms`);

            // Test memory usage (if available)
            if (performance.memory) {
                const memory = performance.memory;
                const memoryMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                
                if (memory.usedJSHeapSize < 50 * 1024 * 1024) { // Less than 50MB
                    addTestResult(container, 'Memory Usage', 'pass', 
                        `${memoryMB} MB used`);
                } else {
                    addTestResult(container, 'Memory Usage', 'warn', 
                        `${memoryMB} MB used (high memory usage)`);
                }
            } else {
                addTestResult(container, 'Memory Usage', 'warn', 
                    'Memory API not available');
            }

            // Test AI performance if available
            if (window.testGame && window.testGame.getBestMove) {
                const aiStartTime = performance.now();
                const move = window.testGame.getBestMove();
                const aiEndTime = performance.now();
                const aiTime = aiEndTime - aiStartTime;
                
                if (aiTime < 100) {
                    addTestResult(container, 'AI Performance', 'pass', 
                        `AI move calculated in ${aiTime.toFixed(2)}ms`);
                } else {
                    addTestResult(container, 'AI Performance', 'warn', 
                        `AI move took ${aiTime.toFixed(2)}ms (slow)`);
                }
            }
        }

        function updateMiniBoard(board) {
            const miniBoard = document.getElementById('mini-board');
            miniBoard.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'mini-cell';
                    
                    if (board[i][j] !== 0) {
                        cell.classList.add('mini-tile');
                        cell.textContent = board[i][j];
                        cell.style.background = `hsl(${Math.log2(board[i][j]) * 20}, 70%, 60%)`;
                    }
                    
                    miniBoard.appendChild(cell);
                }
            }
        }

        function testGameMove(direction) {
            if (!window.testGame) {
                document.getElementById('game-status').innerHTML = 
                    '<span style="color: #ff6b6b;">❌ Test game not initialized</span>';
                return;
            }

            try {
                const moved = window.testGame.move(direction);
                if (moved) {
                    updateMiniBoard(window.testGame.board);
                    document.getElementById('game-status').innerHTML = 
                        `<span style="color: #4CAF50;">✅ Move ${direction} successful - Score: ${window.testGame.score}</span>`;
                } else {
                    document.getElementById('game-status').innerHTML = 
                        `<span style="color: #FF9800;">⚠️ Move ${direction} not possible</span>`;
                }
            } catch (error) {
                document.getElementById('game-status').innerHTML = 
                    `<span style="color: #ff6b6b;">❌ Move error: ${error.message}</span>`;
            }
        }

        function generateRecommendations() {
            const container = document.getElementById('recommendations');
            
            if (testResults.errors.length === 0 && testResults.failed === 0) {
                container.innerHTML = `
                    <div class="test-result pass">
                        <span class="status-icon">🎉</span>
                        <div>
                            <strong>All Systems Operational!</strong>
                            <div style="font-size: 0.9rem; opacity: 0.8;">
                                Your Fancy2048 game is properly initialized and ready to play.
                            </div>
                        </div>
                    </div>
                `;
            } else {
                let recommendations = '<h4>Recommended Actions:</h4><ul>';
                
                testResults.errors.forEach(error => {
                    if (error.includes('Missing element')) {
                        recommendations += '<li>Check HTML structure for missing DOM elements</li>';
                    } else if (error.includes('Game class')) {
                        recommendations += '<li>Verify game.js script is loading properly</li>';
                    } else if (error.includes('CSS')) {
                        recommendations += '<li>Check CSS file loading and variable definitions</li>';
                    }
                });
                
                recommendations += '</ul>';
                container.innerHTML = recommendations;
            }
        }

        // Error capture
        window.addEventListener('error', (event) => {
            testResults.errors.push(`${event.error.name}: ${event.error.message}`);
            const errorConsole = document.getElementById('error-console');
            errorConsole.innerHTML += `<div style="color: #ff6b6b;">[${new Date().toLocaleTimeString()}] ${event.error.name}: ${event.error.message}</div>`;
        });

        // Run all tests when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🧪 Running initialization diagnostic tests...');
            
            setTimeout(() => {
                testDOMElements();
                testCSSStyles();
                testJavaScriptClasses();
                testGameInitialization();
                testPerformance();
                generateRecommendations();
                updateSummaryStats();
                
                console.log('✅ Diagnostic tests completed');
            }, 500);
        });
    </script>
</body>
</html>
